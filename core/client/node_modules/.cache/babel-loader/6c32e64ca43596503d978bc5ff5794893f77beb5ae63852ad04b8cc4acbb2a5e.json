{"ast":null,"code":"var _jsxFileName = \"D:\\\\XM\\\\AI-Sphere-Butler\\\\core\\\\client\\\\src\\\\components\\\\ButlersContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useState, useContext, useEffect } from 'react';\n\n// 创建Context\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ButlerContext = /*#__PURE__*/createContext({\n  activeButlerId: null,\n  setActiveButlerId: () => {},\n  butlers: [],\n  addButler: () => {}\n});\n\n// Provider组件\nexport function ButlerProvider({\n  children\n}) {\n  _s();\n  const [butlers, setButlers] = useState([]);\n  const [activeButlerId, setActiveButlerId] = useState(null);\n\n  // 动态添加管家方法，支持替换\n  function addButler(newButler, replaceButlerId = null) {\n    setButlers(prevButlers => {\n      let newButlers;\n      if (replaceButlerId) {\n        newButlers = prevButlers.filter(b => b.id !== replaceButlerId);\n        newButlers.push(newButler);\n      } else {\n        const existsIndex = prevButlers.findIndex(b => b.id === newButler.id);\n        if (existsIndex !== -1) {\n          newButlers = [...prevButlers];\n          newButlers[existsIndex] = newButler;\n        } else {\n          newButlers = [...prevButlers, newButler];\n        }\n      }\n      return newButlers;\n    });\n    if (replaceButlerId) {\n      setActiveButlerId(newButler.id);\n    }\n  }\n\n  // 从后端加载管家数据\n  useEffect(() => {\n    const fetchButlers = async () => {\n      try {\n        const response = await fetch('/api/butlers');\n        if (!response.ok) throw new Error(`HTTP错误: ${response.status}`);\n        const data = await response.json();\n        if (data.success) {\n          console.log('[ButlerProvider] 从后端加载管家数据成功:', data);\n          setButlers(data.butlers || []);\n          setActiveButlerId(data.activeButlerId);\n        } else {\n          console.error('[ButlerProvider] 加载管家数据失败:', data.error);\n        }\n      } catch (err) {\n        console.error('[ButlerProvider] 加载管家数据异常:', err);\n      }\n    };\n    fetchButlers();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(ButlerContext.Provider, {\n    value: {\n      activeButlerId,\n      setActiveButlerId,\n      butlers,\n      addButler\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, this);\n}\n\n// 自定义hook\n_s(ButlerProvider, \"jT2r+gJYg5r9CcN1E/jeErHOWxE=\");\n_c = ButlerProvider;\nexport function useButler() {\n  _s2();\n  return useContext(ButlerContext);\n}\n_s2(useButler, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"ButlerProvider\");","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","jsxDEV","_jsxDEV","ButlerContext","activeButlerId","setActiveButlerId","butlers","addButler","ButlerProvider","children","_s","setButlers","newButler","replaceButlerId","prevButlers","newButlers","filter","b","id","push","existsIndex","findIndex","fetchButlers","response","fetch","ok","Error","status","data","json","success","console","log","error","err","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useButler","_s2","$RefreshReg$"],"sources":["D:/XM/AI-Sphere-Butler/core/client/src/components/ButlersContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\n\r\n// 创建Context\r\nconst ButlerContext = createContext({\r\n  activeButlerId: null,\r\n  setActiveButlerId: () => {},\r\n  butlers: [],\r\n  addButler: () => {},\r\n});\r\n\r\n// Provider组件\r\nexport function ButlerProvider({ children }) {\r\n  const [butlers, setButlers] = useState([]);\r\n  const [activeButlerId, setActiveButlerId] = useState(null);\r\n\r\n  // 动态添加管家方法，支持替换\r\n  function addButler(newButler, replaceButlerId = null) {\r\n    setButlers(prevButlers => {\r\n      let newButlers;\r\n      if (replaceButlerId) {\r\n        newButlers = prevButlers.filter(b => b.id !== replaceButlerId);\r\n        newButlers.push(newButler);\r\n      } else {\r\n        const existsIndex = prevButlers.findIndex(b => b.id === newButler.id);\r\n        if (existsIndex !== -1) {\r\n          newButlers = [...prevButlers];\r\n          newButlers[existsIndex] = newButler;\r\n        } else {\r\n          newButlers = [...prevButlers, newButler];\r\n        }\r\n      }\r\n      return newButlers;\r\n    });\r\n\r\n    if (replaceButlerId) {\r\n      setActiveButlerId(newButler.id);\r\n    }\r\n  }\r\n\r\n  // 从后端加载管家数据\r\n  useEffect(() => {\r\n    const fetchButlers = async () => {\r\n      try {\r\n        const response = await fetch('/api/butlers');\r\n        if (!response.ok) throw new Error(`HTTP错误: ${response.status}`);\r\n        \r\n        const data = await response.json();\r\n        if (data.success) {\r\n          console.log('[ButlerProvider] 从后端加载管家数据成功:', data);\r\n          setButlers(data.butlers || []);\r\n          setActiveButlerId(data.activeButlerId);\r\n        } else {\r\n          console.error('[ButlerProvider] 加载管家数据失败:', data.error);\r\n        }\r\n      } catch (err) {\r\n        console.error('[ButlerProvider] 加载管家数据异常:', err);\r\n      }\r\n    };\r\n\r\n    fetchButlers();\r\n  }, []);\r\n\r\n  return (\r\n    <ButlerContext.Provider value={{ activeButlerId, setActiveButlerId, butlers, addButler }}>\r\n      {children}\r\n    </ButlerContext.Provider>\r\n  );\r\n}\r\n\r\n// 自定义hook\r\nexport function useButler() {\r\n  return useContext(ButlerContext);\r\n}"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,QAAQ,EAAEC,UAAU,EAAEC,SAAS,QAAQ,OAAO;;AAE7E;AAAA,SAAAC,MAAA,IAAAC,OAAA;AACA,MAAMC,aAAa,gBAAGN,aAAa,CAAC;EAClCO,cAAc,EAAE,IAAI;EACpBC,iBAAiB,EAAEA,CAAA,KAAM,CAAC,CAAC;EAC3BC,OAAO,EAAE,EAAE;EACXC,SAAS,EAAEA,CAAA,KAAM,CAAC;AACpB,CAAC,CAAC;;AAEF;AACA,OAAO,SAASC,cAAcA,CAAC;EAAEC;AAAS,CAAC,EAAE;EAAAC,EAAA;EAC3C,MAAM,CAACJ,OAAO,EAAEK,UAAU,CAAC,GAAGb,QAAQ,CAAC,EAAE,CAAC;EAC1C,MAAM,CAACM,cAAc,EAAEC,iBAAiB,CAAC,GAAGP,QAAQ,CAAC,IAAI,CAAC;;EAE1D;EACA,SAASS,SAASA,CAACK,SAAS,EAAEC,eAAe,GAAG,IAAI,EAAE;IACpDF,UAAU,CAACG,WAAW,IAAI;MACxB,IAAIC,UAAU;MACd,IAAIF,eAAe,EAAE;QACnBE,UAAU,GAAGD,WAAW,CAACE,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACC,EAAE,KAAKL,eAAe,CAAC;QAC9DE,UAAU,CAACI,IAAI,CAACP,SAAS,CAAC;MAC5B,CAAC,MAAM;QACL,MAAMQ,WAAW,GAAGN,WAAW,CAACO,SAAS,CAACJ,CAAC,IAAIA,CAAC,CAACC,EAAE,KAAKN,SAAS,CAACM,EAAE,CAAC;QACrE,IAAIE,WAAW,KAAK,CAAC,CAAC,EAAE;UACtBL,UAAU,GAAG,CAAC,GAAGD,WAAW,CAAC;UAC7BC,UAAU,CAACK,WAAW,CAAC,GAAGR,SAAS;QACrC,CAAC,MAAM;UACLG,UAAU,GAAG,CAAC,GAAGD,WAAW,EAAEF,SAAS,CAAC;QAC1C;MACF;MACA,OAAOG,UAAU;IACnB,CAAC,CAAC;IAEF,IAAIF,eAAe,EAAE;MACnBR,iBAAiB,CAACO,SAAS,CAACM,EAAE,CAAC;IACjC;EACF;;EAEA;EACAlB,SAAS,CAAC,MAAM;IACd,MAAMsB,YAAY,GAAG,MAAAA,CAAA,KAAY;MAC/B,IAAI;QACF,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,cAAc,CAAC;QAC5C,IAAI,CAACD,QAAQ,CAACE,EAAE,EAAE,MAAM,IAAIC,KAAK,CAAC,WAAWH,QAAQ,CAACI,MAAM,EAAE,CAAC;QAE/D,MAAMC,IAAI,GAAG,MAAML,QAAQ,CAACM,IAAI,CAAC,CAAC;QAClC,IAAID,IAAI,CAACE,OAAO,EAAE;UAChBC,OAAO,CAACC,GAAG,CAAC,+BAA+B,EAAEJ,IAAI,CAAC;UAClDjB,UAAU,CAACiB,IAAI,CAACtB,OAAO,IAAI,EAAE,CAAC;UAC9BD,iBAAiB,CAACuB,IAAI,CAACxB,cAAc,CAAC;QACxC,CAAC,MAAM;UACL2B,OAAO,CAACE,KAAK,CAAC,4BAA4B,EAAEL,IAAI,CAACK,KAAK,CAAC;QACzD;MACF,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZH,OAAO,CAACE,KAAK,CAAC,4BAA4B,EAAEC,GAAG,CAAC;MAClD;IACF,CAAC;IAEDZ,YAAY,CAAC,CAAC;EAChB,CAAC,EAAE,EAAE,CAAC;EAEN,oBACEpB,OAAA,CAACC,aAAa,CAACgC,QAAQ;IAACC,KAAK,EAAE;MAAEhC,cAAc;MAAEC,iBAAiB;MAAEC,OAAO;MAAEC;IAAU,CAAE;IAAAE,QAAA,EACtFA;EAAQ;IAAA4B,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACa,CAAC;AAE7B;;AAEA;AAAA9B,EAAA,CA1DgBF,cAAc;AAAAiC,EAAA,GAAdjC,cAAc;AA2D9B,OAAO,SAASkC,SAASA,CAAA,EAAG;EAAAC,GAAA;EAC1B,OAAO5C,UAAU,CAACI,aAAa,CAAC;AAClC;AAACwC,GAAA,CAFeD,SAAS;AAAA,IAAAD,EAAA;AAAAG,YAAA,CAAAH,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}