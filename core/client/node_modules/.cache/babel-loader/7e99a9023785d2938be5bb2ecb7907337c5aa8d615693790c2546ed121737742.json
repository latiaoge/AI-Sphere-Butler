{"ast":null,"code":"import React,{useState,useRef,useEffect}from'react';import{useButler}from'./ButlersContext';import{useRecorderContext}from'../contexts/RecorderProvider';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const activateSoundSrc='/core/client/ai-butler/sounds/activate.mp3';// 将 BACKEND_URL 用于上传接口地址，避免未使用警告\nconst BACKEND_URL=process.env.REACT_APP_BACKEND_URL||'http://localhost:6010';export default function ButlerShowcase(){const{activeButlerId,butlers,addButler,setActiveButlerId,setButlers}=useButler();const{activateButler}=useRecorderContext();const videoRefs=useRef({});const activateAudioRef=useRef(null);const[hoveredId,setHoveredId]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);// 管家创建相关状态\nconst[butlerName,setButlerName]=useState('');const[selectedFile,setSelectedFile]=useState(null);const[uploadProgress,setUploadProgress]=useState(0);const[statusMessage,setStatusMessage]=useState('');const[isProcessing,setIsProcessing]=useState(false);const[refreshKey,setRefreshKey]=useState(0);// 用于强制刷新组件的key\n// 替换管家的管家ID状态\nconst[replaceButlerId,setReplaceButlerId]=useState('');// ===== 增强：添加ID匹配调试日志 =====\nuseEffect(()=>{console.log('[ButlerShowcase] 激活状态检查:');console.log('  当前activeButlerId:',activeButlerId);console.log('  管家列表IDs:',butlers.map(b=>b.id));// 查找匹配的激活管家\nconst matchedButler=butlers.find(b=>b.id===activeButlerId);if(matchedButler){console.log('  匹配成功:',matchedButler.name);// 强制激活视频播放\nconst video=videoRefs.current[activeButlerId];if(video){video.style.filter='none';video.muted=false;video.load();video.play().catch(e=>console.warn('激活视频播放失败:',e));}}else{console.warn('  未找到匹配的激活管家ID');// 当没有匹配时，自动选择第一个管家\nif(butlers.length>0&&activeButlerId!==butlers[0].id){console.log('  自动切换到第一个管家:',butlers[0].id);setActiveButlerId(butlers[0].id);// 同步到后端\nfetch(\"\".concat(BACKEND_URL,\"/api/butlers/active\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({activeButlerId:butlers[0].id})}).catch(e=>console.error('同步激活状态失败:',e));}}},[activeButlerId,butlers,setActiveButlerId]);// 页面初始化时加载管家列表和激活状态\nuseEffect(()=>{const fetchButlers=async()=>{try{console.log('[ButlerShowcase] 初始化加载管家列表...');const response=await fetch(\"\".concat(BACKEND_URL,\"/api/butlers\"));if(!response.ok)throw new Error(\"HTTP\\u9519\\u8BEF: \".concat(response.status));const data=await response.json();if(data.success){console.log('[ButlerShowcase] 成功加载管家列表:',data);// 更新上下文状态\nif(typeof setButlers==='function'){setButlers(data.butlers||[]);}if(typeof setActiveButlerId==='function'&&data.activeButlerId){setActiveButlerId(data.activeButlerId);}}else{console.error('[ButlerShowcase] 加载管家列表失败:',data.error);setError(\"\\u52A0\\u8F7D\\u7BA1\\u5BB6\\u5217\\u8868\\u5931\\u8D25: \".concat(data.error||'未知错误'));}}catch(err){console.error('[ButlerShowcase] 加载管家列表异常:',err);setError(\"\\u52A0\\u8F7D\\u7BA1\\u5BB6\\u5217\\u8868\\u5F02\\u5E38: \".concat(err.message));}};fetchButlers();},[setButlers,setActiveButlerId,refreshKey]);// 全局状态更新时刷新视频\nuseEffect(()=>{console.log('[ButlerShowcase] 全局activeButlerId更新为:',activeButlerId);const activeVideo=videoRefs.current[activeButlerId];if(activeVideo){activeVideo.load();activeVideo.play().catch(e=>console.warn(\"\\u64AD\\u653E\\u89C6\\u9891 \".concat(activeButlerId,\" \\u5931\\u8D25\"),e));}},[activeButlerId]);// 初始化视频状态及激活亮灯动画控制\nuseEffect(()=>{butlers.forEach(_ref=>{let{id,src}=_ref;const video=videoRefs.current[id];if(!video)return;const isActive=id===activeButlerId;if(isActive){video.style.filter='none';video.muted=false;// 避免重复设置src，增加路径绝对化判断\nconst videoSrcAbsolute=new URL(src,window.location.origin).href;if(video.src!==videoSrcAbsolute){video.src=videoSrcAbsolute;}}else{video.pause();video.currentTime=0;video.style.filter='grayscale(100%) brightness(65%)';}});},[activeButlerId,butlers]);// 处理视频播放暂停并控制激活亮灯动画\nuseEffect(()=>{butlers.forEach(_ref2=>{let{id}=_ref2;const isActive=id===activeButlerId;const isHovered=id===hoveredId;const video=videoRefs.current[id];if(!video)return;// 强制设置样式确保状态正确\nif(isActive||isHovered){video.style.filter='none';video.style.boxShadow='0 0 24px rgba(0, 229, 255, 1)';if(video.paused){video.play().catch(()=>{});}}else{video.style.filter='grayscale(100%) brightness(65%)';video.style.boxShadow='none';if(!video.paused){video.pause();video.currentTime=0;}}video.style.transition='filter 0.3s ease, box-shadow 0.3s ease';});},[hoveredId,activeButlerId,butlers]);// 双击切换管家处理\nasync function handleDoubleClick(id){if(id===activeButlerId){console.log('[ButlerShowcase] 已激活该管家，无需切换');return;}if(loading)return;setLoading(true);setError(null);console.log('[ButlerShowcase] 尝试切换到管家:',id);try{// 1. 调用后端接口更新激活状态\nconsole.log('[ButlerShowcase] 同步后端激活状态:',id);const response=await fetch(\"\".concat(BACKEND_URL,\"/api/butlers/active\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({activeButlerId:id})});const result=await response.json();if(!result.success){throw new Error(\"\\u66F4\\u65B0\\u6FC0\\u6D3B\\u72B6\\u6001\\u5931\\u8D25: \".concat(result.error||'未知错误'));}// 2. 调用原有激活逻辑\nif(typeof activateButler==='function'){await activateButler(id);}// 3. 更新本地状态\nif(typeof setActiveButlerId==='function'){setActiveButlerId(id);}const audio=activateAudioRef.current;if(audio){audio.currentTime=0;audio.play().catch(()=>{});}}catch(err){console.error('[ButlerShowcase] 切换失败:',err);setError(err.message||'切换失败，请重试');}finally{setLoading(false);}}// 处理文件选择\nconst handleFileChange=e=>{const file=e.target.files[0];if(file){console.log('选中文件:',file.name,'大小:',file.size);if(file.type!=='video/mp4'||file.size===0){setStatusMessage('请选择有效的MP4格式视频文件');setSelectedFile(null);return;}setSelectedFile(file);setStatusMessage(\"\\u5DF2\\u9009\\u62E9\\u6587\\u4EF6: \".concat(file.name));}};// 上传处理函数\nconst handleSubmit=async e=>{e.preventDefault();if(!butlerName.trim()){setStatusMessage('请输入管家名称');return;}if(!selectedFile){setStatusMessage('请选择视频文件');return;}setIsProcessing(true);setStatusMessage('正在上传并制作管家形象...');setUploadProgress(0);try{const formData=new FormData();formData.append('name',butlerName.trim());formData.append('video',selectedFile);if(replaceButlerId){formData.append('replace_butler_id',replaceButlerId);}const uploadUrl=\"\".concat(BACKEND_URL.replace(/\\/$/,''),\"/api/make_human?make_now=true\");await new Promise((resolve,reject)=>{const xhr=new XMLHttpRequest();xhr.open('POST',uploadUrl,true);xhr.upload.onprogress=event=>{if(event.lengthComputable){const percentCompleted=Math.round(event.loaded*100/event.total);setUploadProgress(percentCompleted);}};xhr.onload=()=>{console.log('上传完成，状态码:',xhr.status);console.log('响应:',xhr.responseText);if(xhr.status>=200&&xhr.status<300){try{const result=JSON.parse(xhr.responseText);if(result.success){setStatusMessage(\"\\u5236\\u4F5C\\u6210\\u529F\\uFF01\\u7BA1\\u5BB6\\u540D\\u79F0: \".concat(butlerName));// 上传成功后强制刷新管家列表\nrefreshButlers();// 重置表单\nsetTimeout(()=>{setButlerName('');setSelectedFile(null);setUploadProgress(0);setReplaceButlerId('');},3000);resolve();}else{setStatusMessage(\"\\u5236\\u4F5C\\u5931\\u8D25: \".concat(result.error||result.message||'未知错误'));reject(new Error(result.error||result.message||'未知错误'));}}catch(err){setStatusMessage('返回数据解析失败');reject(err);}}else{setStatusMessage(\"\\u4E0A\\u4F20\\u5931\\u8D25\\uFF0C\\u72B6\\u6001\\u7801: \".concat(xhr.status));reject(new Error(\"\\u4E0A\\u4F20\\u5931\\u8D25\\uFF0C\\u72B6\\u6001\\u7801: \".concat(xhr.status)));}};xhr.onerror=()=>{console.error('上传请求失败');setStatusMessage('上传失败，请检查网络连接');reject(new Error('上传请求失败'));};xhr.send(formData);});}catch(error){console.error('上传失败',error);if(!statusMessage.includes('失败')){setStatusMessage(\"\\u8BF7\\u6C42\\u5931\\u8D25: \".concat(error.message));}}finally{setIsProcessing(false);}};// 强制刷新管家列表的函数\nconst refreshButlers=async()=>{try{// 先清空现有管家，确保UI更新\nif(typeof setButlers==='function'){setButlers([]);}// 添加短暂延迟，确保后端有时间处理\nawait new Promise(resolve=>setTimeout(resolve,500));// 重新获取管家列表\nconst butlersResponse=await fetch(\"\".concat(BACKEND_URL,\"/api/butlers\"));const butlersData=await butlersResponse.json();if(butlersData.success){console.log('[ButlerShowcase] 上传后刷新管家列表成功:',butlersData.butlers);// 强制更新状态，确保组件重新渲染\nsetRefreshKey(prev=>prev+1);// 更新管家列表和激活状态\nif(typeof setButlers==='function'){setButlers(butlersData.butlers||[]);}if(typeof setActiveButlerId==='function'&&butlersData.activeButlerId){setActiveButlerId(butlersData.activeButlerId);}}else{console.error('[ButlerShowcase] 上传后刷新管家列表失败:',butlersData.error);setError(\"\\u5237\\u65B0\\u7BA1\\u5BB6\\u5217\\u8868\\u5931\\u8D25: \".concat(butlersData.error||'未知错误'));}}catch(err){console.error('[ButlerShowcase] 上传后刷新管家列表异常:',err);setError(\"\\u5237\\u65B0\\u7BA1\\u5BB6\\u5217\\u8868\\u5F02\\u5E38: \".concat(err.message));}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"audio\",{ref:activateAudioRef,src:activateSoundSrc,preload:\"auto\"}),error&&/*#__PURE__*/_jsx(\"div\",{style:{color:'red',textAlign:'center',padding:10,backgroundColor:'rgba(255,0,0,0.1)',borderRadius:4,marginBottom:20,maxWidth:600,marginLeft:'auto',marginRight:'auto'},children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"steward-gallery\",style:{fontFamily:'Arial, sans-serif',backgroundColor:'transparent',padding:40,minHeight:'100vh',userSelect:'none'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"display-case\",style:{position:'relative',maxWidth:1000,margin:'0 auto',borderRadius:8,overflow:'visible',backgroundColor:'transparent',boxShadow:'none'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"case-top\",style:{height:20,backgroundColor:'transparent',boxShadow:'none'}}),/*#__PURE__*/_jsx(\"div\",{className:\"case-bottom\",style:{height:20,backgroundColor:'transparent',boxShadow:'none'}}),/*#__PURE__*/_jsx(\"div\",{className:\"stewards-container\",style:{display:'flex',justifyContent:'center',backgroundColor:'transparent',padding:'30px 0',gap:0},children:butlers.map((_ref3,index)=>{let{id,name,type,src}=_ref3;const isActive=id===activeButlerId;const isHovered=id===hoveredId;return/*#__PURE__*/_jsxs(\"div\",{className:\"steward \".concat(isActive?'active':'',\" \").concat(isHovered?'hovered':''),onMouseEnter:()=>{console.log(\"[\\u60AC\\u505C] \\u7BA1\\u5BB6 \".concat(name,\" (\").concat(id,\")\"));setHoveredId(id);},onMouseLeave:()=>{setHoveredId(null);},onDoubleClick:()=>{if(!loading){console.log(\"[\\u53CC\\u51FB] \\u6FC0\\u6D3B\\u7BA1\\u5BB6 \".concat(name,\" (\").concat(id,\")\"));handleDoubleClick(id);}},style:{position:'relative',width:240,height:480,display:'flex',flexDirection:'column',alignItems:'center',cursor:loading&&id!==activeButlerId?'not-allowed':'pointer',transition:'transform 0.3s ease',transform:isHovered?'translateY(-10px)':'translateY(0)',userSelect:'none',marginRight:index!==butlers.length-1?0:0,zIndex:1,opacity:loading&&id!==activeButlerId?0.7:1,pointerEvents:'auto'// 保证事件总是能触发\n},title:isActive?\"\\u5F53\\u524D\\u6FC0\\u6D3B\\u7BA1\\u5BB6\\uFF1A\".concat(name):\"\\u53CC\\u51FB\\u5207\\u6362\\u5230\\u7BA1\\u5BB6 \".concat(name),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"glass-panel\",style:{width:180,height:340,borderRadius:28,position:'relative',padding:2,background:'linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.03) 100%)',boxShadow:isActive?'0 8px 50px rgba(0, 229, 255, 0.6), inset 0 0 80px rgba(255, 255, 255, 0.2)':'0 8px 50px rgba(0, 229, 255, 0.4), inset 0 0 80px rgba(255, 255, 255, 0.15)',backdropFilter:'blur(20px)',WebkitBackdropFilter:'blur(20px)',border:'3px solid rgba(255, 255, 255, 0.45)',overflow:'hidden',userSelect:'none',filter:isActive?'drop-shadow(0 0 35px rgba(0,229,255,1))':'grayscale(100%) brightness(70%)',transition:'all 0.3s ease',zIndex:1},children:[/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',inset:0,pointerEvents:'none',borderRadius:28,backgroundImage:'radial-gradient(rgba(255,255,255,0.15) 1.5px, transparent 1.5px)',backgroundSize:'7px 7px',mixBlendMode:'overlay',zIndex:5,opacity:0.22}}),/*#__PURE__*/_jsx(\"div\",{className:\"glossy-edge\",style:{position:'absolute',top:-40,left:-40,width:260,height:420,borderRadius:40,pointerEvents:'none',background:'radial-gradient(circle at 15% 30%, rgba(255,255,255,0.5), transparent 65%),'+'radial-gradient(circle at 85% 70%, rgba(255,255,255,0.35), transparent 70%)',filter:'blur(18px)',opacity:0.7,animation:'glossyFlow 5.5s linear infinite',zIndex:6}}),type==='image'?/*#__PURE__*/_jsx(\"img\",{src:src,alt:name,draggable:false,style:{width:'100%',height:'100%',objectFit:'cover',borderRadius:20,position:'relative',zIndex:10,boxShadow:isActive?'0 0 24px rgba(0, 229, 255, 1)':'none',transition:'box-shadow 0.3s ease',userSelect:'none'}}):/*#__PURE__*/_jsx(\"video\",{ref:el=>{if(el){videoRefs.current[id]=el;console.log(\"[\\u89C6\\u9891\\u7ED1\\u5B9A] \\u7BA1\\u5BB6 \".concat(name,\" (\").concat(id,\") \\u89C6\\u9891\\u5143\\u7D20\\u5DF2\\u7ED1\\u5B9A\"),el);}},src:src,autoPlay:false,loop:true,muted:true,playsInline:true,preload:\"auto\",onError:()=>{console.error(\"[\\u89C6\\u9891\\u9519\\u8BEF] \\u7BA1\\u5BB6 \".concat(name,\" (\").concat(id,\") \\u89C6\\u9891\\u52A0\\u8F7D\\u5931\\u8D25\\uFF0Csrc: \").concat(src));setStatusMessage(\"\\u7BA1\\u5BB6\\u3010\".concat(name,\"\\u3011\\u89C6\\u9891\\u52A0\\u8F7D\\u5931\\u8D25\\uFF0C\\u8BF7\\u68C0\\u67E5\\u89C6\\u9891\\u8DEF\\u5F84\\u6216\\u7F51\\u7EDC\\u3002\"));},onPlay:()=>{console.log(\"[\\u89C6\\u9891\\u64AD\\u653E] \\u7BA1\\u5BB6 \".concat(name,\" (\").concat(id,\") \\u89C6\\u9891\\u5F00\\u59CB\\u64AD\\u653E\"));},style:{width:'100%',height:'100%',objectFit:'cover',borderRadius:20,position:'relative',zIndex:10,userSelect:'none',pointerEvents:'none',// 让事件穿透父元素\nfilter:isActive||isHovered?'none':'grayscale(100%) brightness(65%)',transition:'filter 0.3s ease',boxShadow:isActive||isHovered?'0 0 24px rgba(0, 229, 255, 1)':'none'}},id)]}),/*#__PURE__*/_jsx(\"div\",{style:{width:120,height:6,borderRadius:3,backgroundColor:isActive||isHovered?'#00e5ff':'#666',boxShadow:isActive||isHovered?'0 0 12px #00e5ff':'none',marginBottom:6,transition:'background-color 0.3s, box-shadow 0.3s',zIndex:1}}),/*#__PURE__*/_jsx(\"div\",{className:\"indicator-light\",style:{width:20,height:20,borderRadius:'50%',backgroundColor:isActive||isHovered?'#00e5ff':'#555',boxShadow:isActive||isHovered?'0 0 20px #00e5ff':'none',marginTop:6,transition:'background-color 0.3s, box-shadow 0.3s',zIndex:1}}),/*#__PURE__*/_jsx(\"div\",{style:{color:isActive?'#0ff':'#ccc',fontWeight:'bold',textAlign:'center',userSelect:'none',textShadow:isActive?'0 0 8px #0ff':'none',whiteSpace:'nowrap',fontSize:18,marginTop:12,zIndex:1},children:name})]},id);})})]}),/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:800,margin:'50px auto 0',padding:25,borderRadius:12,background:'transparent',backdropFilter:'blur(10px)',WebkitBackdropFilter:'blur(10px)',border:'1px solid rgba(0, 229, 255, 0.3)',boxShadow:'0 4px 30px rgba(0, 229, 255, 0.1)'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{color:'#00e5ff',marginBottom:20,fontSize:22,textAlign:'center',textShadow:'0 0 10px rgba(0, 229, 255, 0.5)'},children:\"\\u521B\\u5EFA\\u65B0\\u7BA1\\u5BB6\\u5F62\\u8C61\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,style:{display:'flex',flexDirection:'column',gap:18},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'white',display:'block',marginBottom:8,fontSize:16},children:\"\\u7BA1\\u5BB6\\u540D\\u79F0:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:butlerName,onChange:e=>setButlerName(e.target.value),placeholder:\"\\u8BF7\\u8F93\\u5165\\u7BA1\\u5BB6\\u540D\\u79F0\",style:{width:'100%',padding:12,borderRadius:6,border:'1px solid rgba(0, 229, 255, 0.5)',backgroundColor:'rgba(255, 255, 255, 0.05)',color:'white',fontSize:16,outline:'none',transition:'border-color 0.3s'},disabled:isProcessing,\"aria-required\":\"true\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'white',display:'block',marginBottom:8,fontSize:16},children:\"\\u4E0A\\u4F20MP4\\u89C6\\u9891:\"}),/*#__PURE__*/_jsxs(\"div\",{style:{border:'2px dashed rgba(0, 229, 255, 0.5)',borderRadius:6,padding:20,textAlign:'center',cursor:isProcessing?'not-allowed':'pointer',transition:'border-color 0.3s',position:'relative'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"video/mp4\",onChange:handleFileChange,style:{position:'absolute',top:0,left:0,width:'100%',height:'100%',opacity:0,cursor:isProcessing?'not-allowed':'pointer'},disabled:isProcessing,\"aria-required\":\"true\"}),/*#__PURE__*/_jsxs(\"div\",{style:{pointerEvents:'none'},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-upload\",style:{fontSize:24,color:'#00e5ff',marginBottom:10}}),/*#__PURE__*/_jsx(\"p\",{style:{color:'white',margin:0},children:selectedFile?\"\\u5DF2\\u9009\\u62E9: \".concat(selectedFile.name):'点击或拖拽MP4格式视频文件到此处'}),/*#__PURE__*/_jsx(\"p\",{style:{color:'rgba(255, 255, 255, 0.6)',fontSize:14,marginTop:5},children:\"\\u89C6\\u9891\\u683C\\u5F0F: MP4, \\u5EFA\\u8BAE\\u5206\\u8FA8\\u7387: 720x1280\"})]})]})]}),butlers.length>=4&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'white',display:'block',marginBottom:8,fontSize:16},children:\"\\u7BA1\\u5BB6\\u6570\\u91CF\\u5DF2\\u6EE14\\u4E2A\\uFF0C\\u60A8\\u53EF\\u4EE5\\u70B9\\u51FB\\u9009\\u62E9\\u66FF\\u6362\\u73B0\\u6709\\u7BA1\\u5BB6:\"}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',gap:12,flexWrap:'wrap'},children:butlers.map(_ref4=>{let{id,name}=_ref4;return/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>{if(!isProcessing)setReplaceButlerId(id);},disabled:isProcessing,style:{flex:'1 1 120px',padding:'10px 14px',borderRadius:6,border:id===replaceButlerId?'2px solid #00e5ff':'1px solid rgba(0, 229, 255, 0.5)',backgroundColor:id===replaceButlerId?'rgba(0, 229, 255, 0.3)':'transparent',color:'white',fontWeight:id===replaceButlerId?'bold':'normal',cursor:isProcessing?'not-allowed':'pointer',transition:'all 0.3s',userSelect:'none'},title:\"\\u70B9\\u51FB\\u66FF\\u6362\\u7BA1\\u5BB6 \".concat(name),children:[name,\" (\",id,\")\"]},id);})}),/*#__PURE__*/_jsx(\"p\",{style:{color:'rgba(255, 255, 255, 0.6)',fontSize:14,marginTop:5},children:\"\\u9009\\u62E9\\u540E\\u4E0A\\u4F20\\u5C06\\u66FF\\u6362\\u6B64\\u7BA1\\u5BB6\\uFF0C\\u672A\\u9009\\u62E9\\u5219\\u65B0\\u589E\\u7BA1\\u5BB6\\uFF08\\u7BA1\\u5BB6\\u6570\\u672A\\u6EE1\\u65F6\\u6709\\u6548\\uFF09\"})]}),uploadProgress>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{color:'white',marginBottom:5,fontSize:16},children:[\"\\u4E0A\\u4F20\\u8FDB\\u5EA6: \",uploadProgress,\"%\"]}),/*#__PURE__*/_jsx(\"div\",{style:{height:8,backgroundColor:'rgba(255, 255, 255, 0.1)',borderRadius:4,overflow:'hidden'},children:/*#__PURE__*/_jsx(\"div\",{style:{width:\"\".concat(uploadProgress,\"%\"),height:'100%',backgroundColor:'#00e5ff',transition:'width 0.3s ease',borderRadius:4}})})]}),statusMessage&&/*#__PURE__*/_jsx(\"div\",{style:{padding:12,borderRadius:6,backgroundColor:isProcessing?'rgba(0, 229, 255, 0.15)':statusMessage.includes('成功')?'rgba(40, 167, 69, 0.15)':'rgba(220, 53, 69, 0.15)',color:isProcessing?'#00e5ff':statusMessage.includes('成功')?'#28a745':'#dc3545',fontSize:16,lineHeight:1.5},children:statusMessage}),/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",style:{padding:'14px 20px',backgroundColor:'transparent',color:'white',border:'none',borderRadius:6,fontSize:18,fontWeight:'bold',cursor:isProcessing?'not-allowed':'pointer',transition:'all 0.3s',boxShadow:'0 0 15px rgba(0, 229, 255, 0.5)',position:'relative',overflow:'hidden'},disabled:isProcessing,children:[isProcessing?/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center'},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-spinner fa-spin\",style:{marginRight:10}}),\"\\u6B63\\u5728\\u5236\\u4F5C...\"]}):'开始制作管家形象',/*#__PURE__*/_jsx(\"span\",{style:{position:'absolute',top:'50%',left:'50%',width:300,height:300,backgroundColor:'rgba(255, 255, 255, 0.2)',borderRadius:'50%',transform:'translate(-50%, -50%) scale(0)',transition:'transform 0.5s ease',pointerEvents:'none'},className:isProcessing?'':'button-hover-effect'})]})]})]})]}),/*#__PURE__*/_jsx(\"style\",{children:\"\\n        @keyframes glossyFlow {\\n          0% {\\n            background-position: 0% 0%, 100% 100%;\\n          }\\n          100% {\\n            background-position: 100% 100%, 0% 0%;\\n          }\\n        }\\n        \\n        /* \\u6309\\u94AE\\u60AC\\u505C\\u6548\\u679C\\u52A8\\u753B */\\n        .button-hover-effect:hover {\\n          transform: translate(-50%, -50%) scale(1);\\n          opacity: 0;\\n        }\\n      \"})]});}","map":{"version":3,"names":["React","useState","useRef","useEffect","useButler","useRecorderContext","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","activateSoundSrc","BACKEND_URL","process","env","REACT_APP_BACKEND_URL","ButlerShowcase","activeButlerId","butlers","addButler","setActiveButlerId","setButlers","activateButler","videoRefs","activateAudioRef","hoveredId","setHoveredId","loading","setLoading","error","setError","butlerName","setButlerName","selectedFile","setSelectedFile","uploadProgress","setUploadProgress","statusMessage","setStatusMessage","isProcessing","setIsProcessing","refreshKey","setRefreshKey","replaceButlerId","setReplaceButlerId","console","log","map","b","id","matchedButler","find","name","video","current","style","filter","muted","load","play","catch","e","warn","length","fetch","concat","method","headers","body","JSON","stringify","fetchButlers","response","ok","Error","status","data","json","success","err","message","activeVideo","forEach","_ref","src","isActive","videoSrcAbsolute","URL","window","location","origin","href","pause","currentTime","_ref2","isHovered","boxShadow","paused","transition","handleDoubleClick","result","audio","handleFileChange","file","target","files","size","type","handleSubmit","preventDefault","trim","formData","FormData","append","uploadUrl","replace","Promise","resolve","reject","xhr","XMLHttpRequest","open","upload","onprogress","event","lengthComputable","percentCompleted","Math","round","loaded","total","onload","responseText","parse","refreshButlers","setTimeout","onerror","send","includes","butlersResponse","butlersData","prev","children","ref","preload","color","textAlign","padding","backgroundColor","borderRadius","marginBottom","maxWidth","marginLeft","marginRight","className","fontFamily","minHeight","userSelect","position","margin","overflow","height","display","justifyContent","gap","_ref3","index","onMouseEnter","onMouseLeave","onDoubleClick","width","flexDirection","alignItems","cursor","transform","zIndex","opacity","pointerEvents","title","background","backdropFilter","WebkitBackdropFilter","border","inset","backgroundImage","backgroundSize","mixBlendMode","top","left","animation","alt","draggable","objectFit","el","autoPlay","loop","playsInline","onError","onPlay","marginTop","fontWeight","textShadow","whiteSpace","fontSize","onSubmit","value","onChange","placeholder","outline","disabled","accept","flexWrap","_ref4","onClick","flex","lineHeight"],"sources":["D:/XM/AI-Sphere-Butler/core/client/src/components/ButlerShowcase.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { useButler } from './ButlersContext';\r\nimport { useRecorderContext } from '../contexts/RecorderProvider';\r\n\r\nconst activateSoundSrc = '/core/client/ai-butler/sounds/activate.mp3';\r\n\r\n// 将 BACKEND_URL 用于上传接口地址，避免未使用警告\r\nconst BACKEND_URL = process.env.REACT_APP_BACKEND_URL || 'http://localhost:6010';\r\n\r\nexport default function ButlerShowcase() {\r\n  const { activeButlerId, butlers, addButler, setActiveButlerId, setButlers } = useButler();\r\n  const { activateButler } = useRecorderContext();\r\n  const videoRefs = useRef({});\r\n  const activateAudioRef = useRef(null);\r\n  const [hoveredId, setHoveredId] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  \r\n  // 管家创建相关状态\r\n  const [butlerName, setButlerName] = useState('');\r\n  const [selectedFile, setSelectedFile] = useState(null);\r\n  const [uploadProgress, setUploadProgress] = useState(0);\r\n  const [statusMessage, setStatusMessage] = useState('');\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [refreshKey, setRefreshKey] = useState(0); // 用于强制刷新组件的key\r\n\r\n  // 替换管家的管家ID状态\r\n  const [replaceButlerId, setReplaceButlerId] = useState('');\r\n\r\n  // ===== 增强：添加ID匹配调试日志 =====\r\n  useEffect(() => {\r\n    console.log('[ButlerShowcase] 激活状态检查:');\r\n    console.log('  当前activeButlerId:', activeButlerId);\r\n    console.log('  管家列表IDs:', butlers.map(b => b.id));\r\n    \r\n    // 查找匹配的激活管家\r\n    const matchedButler = butlers.find(b => b.id === activeButlerId);\r\n    if (matchedButler) {\r\n      console.log('  匹配成功:', matchedButler.name);\r\n      // 强制激活视频播放\r\n      const video = videoRefs.current[activeButlerId];\r\n      if (video) {\r\n        video.style.filter = 'none';\r\n        video.muted = false;\r\n        video.load();\r\n        video.play().catch(e => console.warn('激活视频播放失败:', e));\r\n      }\r\n    } else {\r\n      console.warn('  未找到匹配的激活管家ID');\r\n      // 当没有匹配时，自动选择第一个管家\r\n      if (butlers.length > 0 && activeButlerId !== butlers[0].id) {\r\n        console.log('  自动切换到第一个管家:', butlers[0].id);\r\n        setActiveButlerId(butlers[0].id);\r\n        // 同步到后端\r\n        fetch(`${BACKEND_URL}/api/butlers/active`, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ activeButlerId: butlers[0].id })\r\n        }).catch(e => console.error('同步激活状态失败:', e));\r\n      }\r\n    }\r\n  }, [activeButlerId, butlers, setActiveButlerId]);\r\n\r\n  // 页面初始化时加载管家列表和激活状态\r\n  useEffect(() => {\r\n    const fetchButlers = async () => {\r\n      try {\r\n        console.log('[ButlerShowcase] 初始化加载管家列表...');\r\n        const response = await fetch(`${BACKEND_URL}/api/butlers`);\r\n        if (!response.ok) throw new Error(`HTTP错误: ${response.status}`);\r\n        \r\n        const data = await response.json();\r\n        if (data.success) {\r\n          console.log('[ButlerShowcase] 成功加载管家列表:', data);\r\n          // 更新上下文状态\r\n          if (typeof setButlers === 'function') {\r\n            setButlers(data.butlers || []);\r\n          }\r\n          if (typeof setActiveButlerId === 'function' && data.activeButlerId) {\r\n            setActiveButlerId(data.activeButlerId);\r\n          }\r\n        } else {\r\n          console.error('[ButlerShowcase] 加载管家列表失败:', data.error);\r\n          setError(`加载管家列表失败: ${data.error || '未知错误'}`);\r\n        }\r\n      } catch (err) {\r\n        console.error('[ButlerShowcase] 加载管家列表异常:', err);\r\n        setError(`加载管家列表异常: ${err.message}`);\r\n      }\r\n    };\r\n\r\n    fetchButlers();\r\n  }, [setButlers, setActiveButlerId, refreshKey]);\r\n\r\n  // 全局状态更新时刷新视频\r\n  useEffect(() => {\r\n    console.log('[ButlerShowcase] 全局activeButlerId更新为:', activeButlerId);\r\n    const activeVideo = videoRefs.current[activeButlerId];\r\n    if (activeVideo) {\r\n      activeVideo.load();\r\n      activeVideo.play().catch(e => \r\n        console.warn(`播放视频 ${activeButlerId} 失败`, e)\r\n      );\r\n    }\r\n  }, [activeButlerId]);\r\n\r\n  // 初始化视频状态及激活亮灯动画控制\r\n  useEffect(() => {\r\n    butlers.forEach(({ id, src }) => {\r\n      const video = videoRefs.current[id];\r\n      if (!video) return;\r\n      const isActive = id === activeButlerId;\r\n\r\n      if (isActive) {\r\n        video.style.filter = 'none';\r\n        video.muted = false;\r\n        // 避免重复设置src，增加路径绝对化判断\r\n        const videoSrcAbsolute = new URL(src, window.location.origin).href;\r\n        if (video.src !== videoSrcAbsolute) {\r\n          video.src = videoSrcAbsolute;\r\n        }\r\n      } else {\r\n        video.pause();\r\n        video.currentTime = 0;\r\n        video.style.filter = 'grayscale(100%) brightness(65%)';\r\n      }\r\n    });\r\n  }, [activeButlerId, butlers]);\r\n\r\n  // 处理视频播放暂停并控制激活亮灯动画\r\n  useEffect(() => {\r\n    butlers.forEach(({ id }) => {\r\n      const isActive = id === activeButlerId;\r\n      const isHovered = id === hoveredId;\r\n      const video = videoRefs.current[id];\r\n      if (!video) return;\r\n      \r\n      // 强制设置样式确保状态正确\r\n      if (isActive || isHovered) {\r\n        video.style.filter = 'none';\r\n        video.style.boxShadow = '0 0 24px rgba(0, 229, 255, 1)';\r\n        if (video.paused) {\r\n          video.play().catch(() => {});\r\n        }\r\n      } else {\r\n        video.style.filter = 'grayscale(100%) brightness(65%)';\r\n        video.style.boxShadow = 'none';\r\n        if (!video.paused) {\r\n          video.pause();\r\n          video.currentTime = 0;\r\n        }\r\n      }\r\n      video.style.transition = 'filter 0.3s ease, box-shadow 0.3s ease';\r\n    });\r\n  }, [hoveredId, activeButlerId, butlers]);\r\n\r\n  // 双击切换管家处理\r\n  async function handleDoubleClick(id) {\r\n    if (id === activeButlerId) {\r\n      console.log('[ButlerShowcase] 已激活该管家，无需切换');\r\n      return;\r\n    }\r\n    if (loading) return;\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n    console.log('[ButlerShowcase] 尝试切换到管家:', id);\r\n\r\n    try {\r\n      // 1. 调用后端接口更新激活状态\r\n      console.log('[ButlerShowcase] 同步后端激活状态:', id);\r\n      const response = await fetch(`${BACKEND_URL}/api/butlers/active`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ activeButlerId: id })\r\n      });\r\n\r\n      const result = await response.json();\r\n      if (!result.success) {\r\n        throw new Error(`更新激活状态失败: ${result.error || '未知错误'}`);\r\n      }\r\n\r\n      // 2. 调用原有激活逻辑\r\n      if (typeof activateButler === 'function') {\r\n        await activateButler(id);\r\n      }\r\n\r\n      // 3. 更新本地状态\r\n      if (typeof setActiveButlerId === 'function') {\r\n        setActiveButlerId(id);\r\n      }\r\n      \r\n      const audio = activateAudioRef.current;\r\n      if (audio) {\r\n        audio.currentTime = 0;\r\n        audio.play().catch(() => {});\r\n      }\r\n    } catch (err) {\r\n      console.error('[ButlerShowcase] 切换失败:', err);\r\n      setError(err.message || '切换失败，请重试');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  // 处理文件选择\r\n  const handleFileChange = (e) => {\r\n    const file = e.target.files[0];\r\n    if (file) {\r\n      console.log('选中文件:', file.name, '大小:', file.size);\r\n      if (file.type !== 'video/mp4' || file.size === 0) {\r\n        setStatusMessage('请选择有效的MP4格式视频文件');\r\n        setSelectedFile(null);\r\n        return;\r\n      }\r\n      setSelectedFile(file);\r\n      setStatusMessage(`已选择文件: ${file.name}`);\r\n    }\r\n  };\r\n  \r\n  // 上传处理函数\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n  \r\n    if (!butlerName.trim()) {\r\n      setStatusMessage('请输入管家名称');\r\n      return;\r\n    }\r\n    if (!selectedFile) {\r\n      setStatusMessage('请选择视频文件');\r\n      return;\r\n    }\r\n  \r\n    setIsProcessing(true);\r\n    setStatusMessage('正在上传并制作管家形象...');\r\n    setUploadProgress(0);\r\n  \r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('name', butlerName.trim());\r\n      formData.append('video', selectedFile);\r\n  \r\n      if (replaceButlerId) {\r\n        formData.append('replace_butler_id', replaceButlerId);\r\n      }\r\n  \r\n      const uploadUrl = `${BACKEND_URL.replace(/\\/$/, '')}/api/make_human?make_now=true`;\r\n  \r\n      await new Promise((resolve, reject) => {\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open('POST', uploadUrl, true);\r\n  \r\n        xhr.upload.onprogress = (event) => {\r\n          if (event.lengthComputable) {\r\n            const percentCompleted = Math.round((event.loaded * 100) / event.total);\r\n            setUploadProgress(percentCompleted);\r\n          }\r\n        };\r\n  \r\n        xhr.onload = () => {\r\n          console.log('上传完成，状态码:', xhr.status);\r\n          console.log('响应:', xhr.responseText);\r\n          if (xhr.status >= 200 && xhr.status < 300) {\r\n            try {\r\n              const result = JSON.parse(xhr.responseText);\r\n              if (result.success) {\r\n                setStatusMessage(`制作成功！管家名称: ${butlerName}`);\r\n                \r\n                // 上传成功后强制刷新管家列表\r\n                refreshButlers();\r\n                \r\n                // 重置表单\r\n                setTimeout(() => {\r\n                  setButlerName('');\r\n                  setSelectedFile(null);\r\n                  setUploadProgress(0);\r\n                  setReplaceButlerId('');\r\n                }, 3000);\r\n                resolve();\r\n              } else {\r\n                setStatusMessage(`制作失败: ${result.error || result.message || '未知错误'}`);\r\n                reject(new Error(result.error || result.message || '未知错误'));\r\n              }\r\n            } catch (err) {\r\n              setStatusMessage('返回数据解析失败');\r\n              reject(err);\r\n            }\r\n          } else {\r\n            setStatusMessage(`上传失败，状态码: ${xhr.status}`);\r\n            reject(new Error(`上传失败，状态码: ${xhr.status}`));\r\n          }\r\n        };\r\n  \r\n        xhr.onerror = () => {\r\n          console.error('上传请求失败');\r\n          setStatusMessage('上传失败，请检查网络连接');\r\n          reject(new Error('上传请求失败'));\r\n        };\r\n  \r\n        xhr.send(formData);\r\n      });\r\n    } catch (error) {\r\n      console.error('上传失败', error);\r\n      if (!statusMessage.includes('失败')) {\r\n        setStatusMessage(`请求失败: ${error.message}`);\r\n      }\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n  \r\n  // 强制刷新管家列表的函数\r\n  const refreshButlers = async () => {\r\n    try {\r\n      // 先清空现有管家，确保UI更新\r\n      if (typeof setButlers === 'function') {\r\n        setButlers([]);\r\n      }\r\n      \r\n      // 添加短暂延迟，确保后端有时间处理\r\n      await new Promise(resolve => setTimeout(resolve, 500));\r\n      \r\n      // 重新获取管家列表\r\n      const butlersResponse = await fetch(`${BACKEND_URL}/api/butlers`);\r\n      const butlersData = await butlersResponse.json();\r\n      \r\n      if (butlersData.success) {\r\n        console.log('[ButlerShowcase] 上传后刷新管家列表成功:', butlersData.butlers);\r\n        \r\n        // 强制更新状态，确保组件重新渲染\r\n        setRefreshKey(prev => prev + 1);\r\n        \r\n        // 更新管家列表和激活状态\r\n        if (typeof setButlers === 'function') {\r\n          setButlers(butlersData.butlers || []);\r\n        }\r\n        if (typeof setActiveButlerId === 'function' && butlersData.activeButlerId) {\r\n          setActiveButlerId(butlersData.activeButlerId);\r\n        }\r\n      } else {\r\n        console.error('[ButlerShowcase] 上传后刷新管家列表失败:', butlersData.error);\r\n        setError(`刷新管家列表失败: ${butlersData.error || '未知错误'}`);\r\n      }\r\n    } catch (err) {\r\n      console.error('[ButlerShowcase] 上传后刷新管家列表异常:', err);\r\n      setError(`刷新管家列表异常: ${err.message}`);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <audio ref={activateAudioRef} src={activateSoundSrc} preload=\"auto\" />\r\n      \r\n      {/* 错误提示 */}\r\n      {error && (\r\n        <div style={{\r\n          color: 'red',\r\n          textAlign: 'center',\r\n          padding: 10,\r\n          backgroundColor: 'rgba(255,0,0,0.1)',\r\n          borderRadius: 4,\r\n          marginBottom: 20,\r\n          maxWidth: 600,\r\n          marginLeft: 'auto',\r\n          marginRight: 'auto',\r\n        }}>\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      <div\r\n        className=\"steward-gallery\"\r\n        style={{\r\n          fontFamily: 'Arial, sans-serif',\r\n          backgroundColor: 'transparent',\r\n          padding: 40,\r\n          minHeight: '100vh',\r\n          userSelect: 'none',\r\n        }}\r\n      >\r\n        <div\r\n          className=\"display-case\"\r\n          style={{\r\n            position: 'relative',\r\n            maxWidth: 1000,\r\n            margin: '0 auto',\r\n            borderRadius: 8,\r\n            overflow: 'visible',\r\n            backgroundColor: 'transparent',\r\n            boxShadow: 'none',\r\n          }}\r\n        >\r\n          <div\r\n            className=\"case-top\"\r\n            style={{ height: 20, backgroundColor: 'transparent', boxShadow: 'none' }}\r\n          />\r\n          <div\r\n            className=\"case-bottom\"\r\n            style={{ height: 20, backgroundColor: 'transparent', boxShadow: 'none' }}\r\n          />\r\n\r\n          <div\r\n            className=\"stewards-container\"\r\n            style={{\r\n              display: 'flex',\r\n              justifyContent: 'center',\r\n              backgroundColor: 'transparent',\r\n              padding: '30px 0',\r\n              gap: 0,\r\n            }}\r\n          >\r\n            {butlers.map(({ id, name, type, src }, index) => {\r\n              const isActive = id === activeButlerId;\r\n              const isHovered = id === hoveredId;\r\n\r\n              return (\r\n                <div\r\n                  key={id}\r\n                  className={`steward ${isActive ? 'active' : ''} ${isHovered ? 'hovered' : ''}`}\r\n                  onMouseEnter={() => {\r\n                    console.log(`[悬停] 管家 ${name} (${id})`);\r\n                    setHoveredId(id);\r\n                  }}\r\n                  onMouseLeave={() => {\r\n                    setHoveredId(null);\r\n                  }}\r\n                  onDoubleClick={() => {\r\n                    if (!loading) {\r\n                      console.log(`[双击] 激活管家 ${name} (${id})`);\r\n                      handleDoubleClick(id);\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    position: 'relative',\r\n                    width: 240,\r\n                    height: 480,\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    alignItems: 'center',\r\n                    cursor: loading && id !== activeButlerId ? 'not-allowed' : 'pointer',\r\n                    transition: 'transform 0.3s ease',\r\n                    transform: isHovered ? 'translateY(-10px)' : 'translateY(0)',\r\n                    userSelect: 'none',\r\n                    marginRight: index !== butlers.length - 1 ? 0 : 0,\r\n                    zIndex: 1,\r\n                    opacity: loading && id !== activeButlerId ? 0.7 : 1,\r\n                    pointerEvents: 'auto',  // 保证事件总是能触发\r\n                  }}\r\n                  title={isActive ? `当前激活管家：${name}` : `双击切换到管家 ${name}`}\r\n                >\r\n                  <div\r\n                    className=\"glass-panel\"\r\n                    style={{\r\n                      width: 180,\r\n                      height: 340,\r\n                      borderRadius: 28,\r\n                      position: 'relative',\r\n                      padding: 2,\r\n                      background:\r\n                        'linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.03) 100%)',\r\n                      boxShadow: isActive \r\n                        ? '0 8px 50px rgba(0, 229, 255, 0.6), inset 0 0 80px rgba(255, 255, 255, 0.2)'\r\n                        : '0 8px 50px rgba(0, 229, 255, 0.4), inset 0 0 80px rgba(255, 255, 255, 0.15)',\r\n                      backdropFilter: 'blur(20px)',\r\n                      WebkitBackdropFilter: 'blur(20px)',\r\n                      border: '3px solid rgba(255, 255, 255, 0.45)',\r\n                      overflow: 'hidden',\r\n                      userSelect: 'none',\r\n                      filter: isActive\r\n                        ? 'drop-shadow(0 0 35px rgba(0,229,255,1))'\r\n                        : 'grayscale(100%) brightness(70%)',\r\n                      transition: 'all 0.3s ease',\r\n                      zIndex: 1,\r\n                    }}\r\n                  >\r\n                    <div\r\n                      style={{\r\n                        position: 'absolute',\r\n                        inset: 0,\r\n                        pointerEvents: 'none',\r\n                        borderRadius: 28,\r\n                        backgroundImage:\r\n                          'radial-gradient(rgba(255,255,255,0.15) 1.5px, transparent 1.5px)',\r\n                        backgroundSize: '7px 7px',\r\n                        mixBlendMode: 'overlay',\r\n                        zIndex: 5,\r\n                        opacity: 0.22,\r\n                      }}\r\n                    />\r\n                    <div\r\n                      className=\"glossy-edge\"\r\n                      style={{\r\n                        position: 'absolute',\r\n                        top: -40,\r\n                        left: -40,\r\n                        width: 260,\r\n                        height: 420,\r\n                        borderRadius: 40,\r\n                        pointerEvents: 'none',\r\n                        background:\r\n                          'radial-gradient(circle at 15% 30%, rgba(255,255,255,0.5), transparent 65%),' +\r\n                          'radial-gradient(circle at 85% 70%, rgba(255,255,255,0.35), transparent 70%)',\r\n                        filter: 'blur(18px)',\r\n                        opacity: 0.7,\r\n                        animation: 'glossyFlow 5.5s linear infinite',\r\n                        zIndex: 6,\r\n                      }}\r\n                    />\r\n\r\n                    {type === 'image' ? (\r\n                      <img\r\n                        src={src}\r\n                        alt={name}\r\n                        draggable={false}\r\n                        style={{\r\n                          width: '100%',\r\n                          height: '100%',\r\n                          objectFit: 'cover',\r\n                          borderRadius: 20,\r\n                          position: 'relative',\r\n                          zIndex: 10,\r\n                          boxShadow: isActive\r\n                            ? '0 0 24px rgba(0, 229, 255, 1)'\r\n                            : 'none',\r\n                          transition: 'box-shadow 0.3s ease',\r\n                          userSelect: 'none',\r\n                        }}\r\n                      />\r\n                    ) : (\r\n                      <video\r\n                        key={id}\r\n                        ref={(el) => {\r\n                          if (el) {\r\n                            videoRefs.current[id] = el;\r\n                            console.log(`[视频绑定] 管家 ${name} (${id}) 视频元素已绑定`, el);\r\n                          }\r\n                        }}\r\n                        src={src}\r\n                        autoPlay={false}\r\n                        loop\r\n                        muted\r\n                        playsInline\r\n                        preload=\"auto\"\r\n                        onError={() => {\r\n                          console.error(`[视频错误] 管家 ${name} (${id}) 视频加载失败，src: ${src}`);\r\n                          setStatusMessage(`管家【${name}】视频加载失败，请检查视频路径或网络。`);\r\n                        }}\r\n                        onPlay={() => {\r\n                          console.log(`[视频播放] 管家 ${name} (${id}) 视频开始播放`);\r\n                        }}\r\n                        style={{\r\n                          width: '100%',\r\n                          height: '100%',\r\n                          objectFit: 'cover',\r\n                          borderRadius: 20,\r\n                          position: 'relative',\r\n                          zIndex: 10,\r\n                          userSelect: 'none',\r\n                          pointerEvents: 'none', // 让事件穿透父元素\r\n                          filter: isActive || isHovered\r\n                            ? 'none'\r\n                            : 'grayscale(100%) brightness(65%)',\r\n                          transition: 'filter 0.3s ease',\r\n                          boxShadow: isActive || isHovered\r\n                            ? '0 0 24px rgba(0, 229, 255, 1)'\r\n                            : 'none',\r\n                        }}\r\n                      />\r\n                    )}\r\n                  </div>\r\n\r\n                  <div\r\n                    style={{\r\n                      width: 120,\r\n                      height: 6,\r\n                      borderRadius: 3,\r\n                      backgroundColor:\r\n                        isActive || isHovered ? '#00e5ff' : '#666',\r\n                      boxShadow:\r\n                        isActive || isHovered\r\n                          ? '0 0 12px #00e5ff'\r\n                          : 'none',\r\n                      marginBottom: 6,\r\n                      transition: 'background-color 0.3s, box-shadow 0.3s',\r\n                      zIndex: 1,\r\n                    }}\r\n                  />\r\n\r\n                  <div\r\n                    className=\"indicator-light\"\r\n                    style={{\r\n                      width: 20,\r\n                      height: 20,\r\n                      borderRadius: '50%',\r\n                      backgroundColor:\r\n                        isActive || isHovered ? '#00e5ff' : '#555',\r\n                      boxShadow:\r\n                        isActive || isHovered\r\n                          ? '0 0 20px #00e5ff'\r\n                          : 'none',\r\n                      marginTop: 6,\r\n                      transition: 'background-color 0.3s, box-shadow 0.3s',\r\n                      zIndex: 1,\r\n                    }}\r\n                  />\r\n\r\n                  <div\r\n                    style={{\r\n                      color: isActive ? '#0ff' : '#ccc',\r\n                      fontWeight: 'bold',\r\n                      textAlign: 'center',\r\n                      userSelect: 'none',\r\n                      textShadow: isActive ? '0 0 8px #0ff' : 'none',\r\n                      whiteSpace: 'nowrap',\r\n                      fontSize: 18,\r\n                      marginTop: 12,\r\n                      zIndex: 1,\r\n                    }}\r\n                  >\r\n                    {name}\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n\r\n        {/* 管家形象制作表单 */}\r\n        <div style={{\r\n          maxWidth: 800,\r\n          margin: '50px auto 0',\r\n          padding: 25,\r\n          borderRadius: 12,\r\n          background: 'transparent',\r\n          backdropFilter: 'blur(10px)',\r\n          WebkitBackdropFilter: 'blur(10px)',\r\n          border: '1px solid rgba(0, 229, 255, 0.3)',\r\n          boxShadow: '0 4px 30px rgba(0, 229, 255, 0.1)',\r\n        }}>\r\n          <h3 style={{ \r\n            color: '#00e5ff', \r\n            marginBottom: 20, \r\n            fontSize: 22, \r\n            textAlign: 'center',\r\n            textShadow: '0 0 10px rgba(0, 229, 255, 0.5)'\r\n          }}>创建新管家形象</h3>\r\n          \r\n          <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: 18 }}>\r\n            <div>\r\n              <label style={{ color: 'white', display: 'block', marginBottom: 8, fontSize: 16 }}>\r\n                管家名称:\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={butlerName}\r\n                onChange={(e) => setButlerName(e.target.value)}\r\n                placeholder=\"请输入管家名称\"\r\n                style={{\r\n                  width: '100%',\r\n                  padding: 12,\r\n                  borderRadius: 6,\r\n                  border: '1px solid rgba(0, 229, 255, 0.5)',\r\n                  backgroundColor: 'rgba(255, 255, 255, 0.05)',\r\n                  color: 'white',\r\n                  fontSize: 16,\r\n                  outline: 'none',\r\n                  transition: 'border-color 0.3s',\r\n                }}\r\n                disabled={isProcessing}\r\n                aria-required=\"true\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label style={{ color: 'white', display: 'block', marginBottom: 8, fontSize: 16 }}>\r\n                上传MP4视频:\r\n              </label>\r\n              <div style={{\r\n                border: '2px dashed rgba(0, 229, 255, 0.5)',\r\n                borderRadius: 6,\r\n                padding: 20,\r\n                textAlign: 'center',\r\n                cursor: isProcessing ? 'not-allowed' : 'pointer',\r\n                transition: 'border-color 0.3s',\r\n                position: 'relative',\r\n              }}>\r\n                <input\r\n                  type=\"file\"\r\n                  accept=\"video/mp4\"\r\n                  onChange={handleFileChange}\r\n                  style={{ \r\n                    position: 'absolute', \r\n                    top: 0, \r\n                    left: 0, \r\n                    width: '100%', \r\n                    height: '100%', \r\n                    opacity: 0, \r\n                    cursor: isProcessing ? 'not-allowed' : 'pointer' \r\n                  }}\r\n                  disabled={isProcessing}\r\n                  aria-required=\"true\"\r\n                />\r\n                <div style={{ pointerEvents: 'none' }}>\r\n                  <i className=\"fa fa-upload\" style={{ fontSize: 24, color: '#00e5ff', marginBottom: 10 }} />\r\n                  <p style={{ color: 'white', margin: 0 }}>\r\n                    {selectedFile \r\n                      ? `已选择: ${selectedFile.name}` \r\n                      : '点击或拖拽MP4格式视频文件到此处'}\r\n                  </p>\r\n                  <p style={{ color: 'rgba(255, 255, 255, 0.6)', fontSize: 14, marginTop: 5 }}>\r\n                    视频格式: MP4, 建议分辨率: 720x1280\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* 替换已有管家选择 */}\r\n            {butlers.length >= 4 && (\r\n            <div>\r\n              <label style={{ color: 'white', display: 'block', marginBottom: 8, fontSize: 16 }}>\r\n                管家数量已满4个，您可以点击选择替换现有管家:\r\n              </label>\r\n              <div style={{\r\n                display: 'flex',\r\n                gap: 12,\r\n                flexWrap: 'wrap',\r\n              }}>\r\n                {butlers.map(({ id, name }) => (\r\n                  <button\r\n                    key={id}\r\n                    type=\"button\"\r\n                    onClick={() => { if (!isProcessing) setReplaceButlerId(id); }}\r\n                    disabled={isProcessing}\r\n                    style={{\r\n                      flex: '1 1 120px',\r\n                      padding: '10px 14px',\r\n                      borderRadius: 6,\r\n                      border: id === replaceButlerId ? '2px solid #00e5ff' : '1px solid rgba(0, 229, 255, 0.5)',\r\n                      backgroundColor: id === replaceButlerId ? 'rgba(0, 229, 255, 0.3)' : 'transparent',\r\n                      color: 'white',\r\n                      fontWeight: id === replaceButlerId ? 'bold' : 'normal',\r\n                      cursor: isProcessing ? 'not-allowed' : 'pointer',\r\n                      transition: 'all 0.3s',\r\n                      userSelect: 'none',\r\n                    }}\r\n                    title={`点击替换管家 ${name}`}\r\n                  >\r\n                    {name} ({id})\r\n                  </button>\r\n                ))}\r\n              </div>\r\n              <p style={{ color: 'rgba(255, 255, 255, 0.6)', fontSize: 14, marginTop: 5 }}>\r\n                选择后上传将替换此管家，未选择则新增管家（管家数未满时有效）\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n            {/* 上传进度条 */}\r\n            {uploadProgress > 0 && (\r\n              <div>\r\n                <div style={{ color: 'white', marginBottom: 5, fontSize: 16 }}>\r\n                  上传进度: {uploadProgress}%\r\n                </div>\r\n                <div style={{\r\n                  height: 8,\r\n                  backgroundColor: 'rgba(255, 255, 255, 0.1)',\r\n                  borderRadius: 4,\r\n                  overflow: 'hidden'\r\n                }}>\r\n                  <div\r\n                    style={{\r\n                      width: `${uploadProgress}%`,\r\n                      height: '100%',\r\n                      backgroundColor: '#00e5ff',\r\n                      transition: 'width 0.3s ease',\r\n                      borderRadius: 4,\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* 状态消息 */}\r\n            {statusMessage && (\r\n              <div style={{\r\n                padding: 12,\r\n                borderRadius: 6,\r\n                backgroundColor: isProcessing \r\n                  ? 'rgba(0, 229, 255, 0.15)' \r\n                  : statusMessage.includes('成功')\r\n                    ? 'rgba(40, 167, 69, 0.15)'\r\n                    : 'rgba(220, 53, 69, 0.15)',\r\n                color: isProcessing ? '#00e5ff' : statusMessage.includes('成功') ? '#28a745' : '#dc3545',\r\n                fontSize: 16,\r\n                lineHeight: 1.5,\r\n              }}>\r\n                {statusMessage}\r\n              </div>\r\n            )}\r\n\r\n            {/* 提交按钮 */}\r\n            <button\r\n              type=\"submit\"\r\n              style={{\r\n                padding: '14px 20px',\r\n                backgroundColor: 'transparent',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: 6,\r\n                fontSize: 18,\r\n                fontWeight: 'bold',\r\n                cursor: isProcessing ? 'not-allowed' : 'pointer',\r\n                transition: 'all 0.3s',\r\n                boxShadow: '0 0 15px rgba(0, 229, 255, 0.5)',\r\n                position: 'relative',\r\n                overflow: 'hidden',\r\n              }}\r\n              disabled={isProcessing}\r\n            >\r\n              {isProcessing \r\n                ? <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                    <i className=\"fa fa-spinner fa-spin\" style={{ marginRight: 10 }} />\r\n                    正在制作...\r\n                  </div>\r\n                : '开始制作管家形象'}\r\n              \r\n              <span style={{\r\n                position: 'absolute',\r\n                top: '50%',\r\n                left: '50%',\r\n                width: 300,\r\n                height: 300,\r\n                backgroundColor: 'rgba(255, 255, 255, 0.2)',\r\n                borderRadius: '50%',\r\n                transform: 'translate(-50%, -50%) scale(0)',\r\n                transition: 'transform 0.5s ease',\r\n                pointerEvents: 'none',\r\n              }} \r\n              className={isProcessing ? '' : 'button-hover-effect'} />\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n\r\n      <style>{`\r\n        @keyframes glossyFlow {\r\n          0% {\r\n            background-position: 0% 0%, 100% 100%;\r\n          }\r\n          100% {\r\n            background-position: 100% 100%, 0% 0%;\r\n          }\r\n        }\r\n        \r\n        /* 按钮悬停效果动画 */\r\n        .button-hover-effect:hover {\r\n          transform: translate(-50%, -50%) scale(1);\r\n          opacity: 0;\r\n        }\r\n      `}</style>\r\n    </>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}