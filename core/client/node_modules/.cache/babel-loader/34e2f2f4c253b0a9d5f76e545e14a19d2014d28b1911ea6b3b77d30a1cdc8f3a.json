{"ast":null,"code":"var _jsxFileName = \"D:\\\\XM\\\\AI-Sphere-Butler\\\\core\\\\client\\\\src\\\\components\\\\OldWebRTC.jsx\",\n  _s = $RefreshSig$();\n// src/components/OldWebRTC.jsx\nimport React, { useEffect, useRef, useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function OldWebRTC() {\n  _s();\n  const videoRef = useRef(null);\n  const audioRef = useRef(null);\n  const pcRef = useRef(null);\n  const containerRef = useRef(null); // 父容器引用，用于范围限制\n\n  const [useStun, setUseStun] = useState(false);\n  const [started, setStarted] = useState(false);\n  const [zoomWidth, setZoomWidth] = useState(600);\n\n  // 视频初始宽高\n  const initialWidth = 600;\n  const initialHeight = 450; // 按你代码比例\n\n  // 信令服务器地址（根据你实际后端调整）\n  const SIGNALING_URL = '/offer'; // POST 地址\n\n  // 视频缩放比例\n  const zoomStep = 50;\n\n  // 维护聊天框位置状态，默认位置距父容器左上角20px,20px\n  const [chatPos, setChatPos] = useState(() => {\n    try {\n      const saved = localStorage.getItem('chatbox-position');\n      if (saved) {\n        const pos = JSON.parse(saved);\n        if (typeof pos.left === 'number' && typeof pos.top === 'number') {\n          return pos;\n        }\n      }\n    } catch {}\n    return {\n      left: 20,\n      top: 20\n    };\n  });\n\n  // 拖拽相关状态\n  const draggingRef = useRef(false);\n  const dragOffsetRef = useRef({\n    x: 0,\n    y: 0\n  });\n\n  // 拖拽事件处理\n  function onDragStart(e) {\n    draggingRef.current = true;\n    const targetRect = e.currentTarget.getBoundingClientRect();\n    if (e.type === 'touchstart' && e.touches && e.touches[0]) {\n      dragOffsetRef.current = {\n        x: e.touches[0].clientX - targetRect.left,\n        y: e.touches[0].clientY - targetRect.top\n      };\n    } else {\n      dragOffsetRef.current = {\n        x: e.clientX - targetRect.left,\n        y: e.clientY - targetRect.top\n      };\n    }\n    e.preventDefault();\n    e.stopPropagation();\n  }\n  function onDragMove(e) {\n    if (!draggingRef.current) return;\n    let clientX, clientY;\n    if (e.type === 'touchmove' && e.touches && e.touches[0]) {\n      clientX = e.touches[0].clientX;\n      clientY = e.touches[0].clientY;\n    } else if (e.type === 'mousemove') {\n      clientX = e.clientX;\n      clientY = e.clientY;\n    } else {\n      return;\n    }\n    if (!containerRef.current) return;\n    const containerRect = containerRef.current.getBoundingClientRect();\n\n    // 计算相对于父容器左上角的新位置\n    let newLeft = clientX - containerRect.left - dragOffsetRef.current.x;\n    let newTop = clientY - containerRect.top - dragOffsetRef.current.y;\n\n    // 限制拖拽范围在父容器内\n    const chatWidth = 320;\n    const chatHeight = 260;\n    newLeft = Math.min(Math.max(0, newLeft), containerRect.width - chatWidth);\n    newTop = Math.min(Math.max(0, newTop), containerRect.height - chatHeight);\n    setChatPos({\n      left: newLeft,\n      top: newTop\n    });\n    e.preventDefault();\n    e.stopPropagation();\n  }\n  function onDragEnd(e) {\n    if (draggingRef.current) {\n      draggingRef.current = false;\n      // 保存位置\n      localStorage.setItem('chatbox-position', JSON.stringify(chatPos));\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }\n\n  // 创建并协商 WebRTC 连接\n  async function negotiate() {\n    const pc = pcRef.current;\n    if (!pc) return;\n    pc.addTransceiver('video', {\n      direction: 'recvonly'\n    });\n    pc.addTransceiver('audio', {\n      direction: 'recvonly'\n    });\n    try {\n      const offer = await pc.createOffer();\n      await pc.setLocalDescription(offer);\n\n      // 等待 ICE gathering 完成\n      await new Promise(resolve => {\n        if (pc.iceGatheringState === 'complete') {\n          resolve();\n        } else {\n          const checkState = () => {\n            if (pc.iceGatheringState === 'complete') {\n              pc.removeEventListener('icegatheringstatechange', checkState);\n              resolve();\n            }\n          };\n          pc.addEventListener('icegatheringstatechange', checkState);\n        }\n      });\n\n      // 发送本地 SDP offer 到服务器，等待答复 SDP answer\n      const response = await fetch(SIGNALING_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          sdp: pc.localDescription.sdp,\n          type: pc.localDescription.type\n        })\n      });\n      const answer = await response.json();\n\n      // 设置远端 SDP\n      await pc.setRemoteDescription(answer);\n\n      // 你原来页面有 sessionid 字段，这里不展示，需要的话可以自行扩展\n    } catch (e) {\n      alert('协商失败: ' + e.message);\n    }\n  }\n  function start() {\n    if (started) return;\n    const config = {\n      sdpSemantics: 'unified-plan'\n    };\n    // 注释掉 STUN 服务器配置，禁用 stun 功能\n    /*\r\n    if (useStun) {\r\n      config.iceServers = [{ urls: ['stun:stun.l.google.com:19302'] }];\r\n    }\r\n    */\n\n    const pc = new RTCPeerConnection(config);\n    pcRef.current = pc;\n\n    // 监听远端 track，绑定到 video/audio 标签\n    pc.addEventListener('track', evt => {\n      if (evt.track.kind === 'video') {\n        if (videoRef.current) {\n          videoRef.current.srcObject = evt.streams[0];\n        }\n      } else if (evt.track.kind === 'audio') {\n        if (audioRef.current) {\n          audioRef.current.srcObject = evt.streams[0];\n        }\n      }\n    });\n    setStarted(true);\n    negotiate();\n\n    // 初始化视频缩放（首次设置）\n    setZoomWidth(initialWidth);\n  }\n  function stop() {\n    if (!started) return;\n    setStarted(false);\n\n    // 注意：根据需求，这里不关闭 pc 连接，不停止流，保持后台推流不中断\n    // 如果你想真正停止，请取消下面注释\n    /*\r\n    setTimeout(() => {\r\n      if (pcRef.current) {\r\n        pcRef.current.close();\r\n        pcRef.current = null;\r\n      }\r\n    }, 500);\r\n      if (videoRef.current && videoRef.current.srcObject) {\r\n      videoRef.current.srcObject.getTracks().forEach((t) => t.stop());\r\n      videoRef.current.srcObject = null;\r\n    }\r\n    if (audioRef.current && audioRef.current.srcObject) {\r\n      audioRef.current.srcObject.getTracks().forEach((t) => t.stop());\r\n      audioRef.current.srcObject = null;\r\n    }\r\n    */\n  }\n\n  // 缩放视频\n  function zoomIn() {\n    setZoomWidth(w => w + zoomStep);\n  }\n  function zoomOut() {\n    setZoomWidth(w => w - zoomStep > 0 ? w - zoomStep : w);\n  }\n\n  // 文本框输入状态\n  const [message, setMessage] = useState('');\n  // 图片文件状态\n  const [imageFile, setImageFile] = useState(null);\n\n  // 发送文本消息函数，发送到 LLM 服务\n  const sendTextMessage = async () => {\n    if (!message.trim()) return;\n    try {\n      const response = await fetch('https://192.168.1.70:6010/qwener', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          text: message\n        })\n      });\n      if (!response.ok) {\n        throw new Error('网络响应失败，状态码: ' + response.status);\n      }\n      const data = await response.json();\n      console.log('文本发送成功，服务器返回：', data);\n    } catch (error) {\n      console.error('文本发送失败：', error);\n    }\n  };\n\n  // 发送图片+文本消息函数，发送到多模态服务\n  const sendMultiModal = async () => {\n    if (!imageFile) return;\n    try {\n      const reader = new FileReader();\n      reader.onloadend = async () => {\n        const base64data = reader.result;\n        const payload = {\n          text: message.trim(),\n          // 文字\n          image: base64data // 图片 base64\n        };\n        const response = await fetch('https://192.168.1.70:6010/multimodal', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(payload)\n        });\n        if (!response.ok) {\n          throw new Error('网络响应失败，状态码: ' + response.status);\n        }\n        const data = await response.json();\n        console.log('多模态发送成功，服务器返回：', data);\n        setImageFile(null); // 清空图片\n        setMessage(''); // 清空文本\n      };\n      reader.readAsDataURL(imageFile);\n    } catch (error) {\n      console.error('多模态发送失败：', error);\n    }\n  };\n\n  // 表单提交处理\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (imageFile) {\n      // 有图片时，文本和图片一起发送到多模态服务\n      await sendMultiModal();\n    } else {\n      // 仅文本时，发送到 LLM 服务\n      await sendTextMessage();\n      setMessage(''); // 清空文本\n    }\n  };\n\n  // 选择图片处理\n  const handleImageChange = e => {\n    const file = e.target.files[0];\n    setImageFile(file || null);\n  };\n\n  // 组件挂载时，重新绑定已有远端流到 video/audio 标签，防止切换回来黑屏\n  useEffect(() => {\n    if (pcRef.current && videoRef.current && audioRef.current) {\n      const pc = pcRef.current;\n\n      // 视频流绑定\n      let remoteVideoStream = null;\n      pc.getReceivers().forEach(receiver => {\n        if (receiver.track && receiver.track.kind === 'video') {\n          if (receiver.track.readyState === 'live') {\n            if (receiver.track.streams && receiver.track.streams[0]) {\n              remoteVideoStream = receiver.track.streams[0];\n            }\n          }\n        }\n      });\n      if (remoteVideoStream) {\n        videoRef.current.srcObject = remoteVideoStream;\n      }\n\n      // 音频流绑定\n      let remoteAudioStream = null;\n      pc.getReceivers().forEach(receiver => {\n        if (receiver.track && receiver.track.kind === 'audio') {\n          if (receiver.track.readyState === 'live') {\n            if (receiver.track.streams && receiver.track.streams[0]) {\n              remoteAudioStream = receiver.track.streams[0];\n            }\n          }\n        }\n      });\n      if (remoteAudioStream) {\n        audioRef.current.srcObject = remoteAudioStream;\n      }\n    }\n  }, []); // 仅挂载时执行一次\n\n  // 通用磨砂玻璃按钮样式（纯 CSS 磨砂玻璃效果）\n  const frostedGlassBtnStyle = {\n    backgroundColor: 'rgba(255, 255, 255, 0.1)',\n    // 半透明背景\n    border: '1px solid rgba(255, 255, 255, 0.3)',\n    // 半透明边框\n    color: 'white',\n    fontWeight: 'bold',\n    padding: '8px 16px',\n    cursor: 'pointer',\n    borderRadius: 4,\n    outline: 'none',\n    transition: 'background-color 0.3s, color 0.3s, box-shadow 0.3s, transform 0.3s',\n    fontSize: 14,\n    lineHeight: '1.2',\n    backdropFilter: 'blur(10px)',\n    // 磨砂玻璃模糊\n    WebkitBackdropFilter: 'blur(10px)',\n    boxShadow: '0 4px 10px rgba(255, 255, 255, 0.15)'\n  };\n\n  // 按钮禁用样式\n  const disabledBtnStyle = {\n    ...frostedGlassBtnStyle,\n    opacity: 0.4,\n    cursor: 'not-allowed',\n    boxShadow: 'none'\n  };\n\n  // 按钮 hover 效果内联样式函数\n  const getBtnHoverStyle = disabled => {\n    if (disabled) return {};\n    return {\n      backgroundColor: 'rgba(255, 255, 255, 0.2)',\n      boxShadow: '0 6px 20px rgba(255, 255, 255, 0.3)',\n      transform: 'scale(1.05)'\n    };\n  };\n\n  // 本组件内部按钮 hover 状态管理\n  const [startBtnHover, setStartBtnHover] = useState(false);\n  const [stopBtnHover, setStopBtnHover] = useState(false);\n  const [zoomInHover, setZoomInHover] = useState(false);\n  const [zoomOutHover, setZoomOutHover] = useState(false);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: containerRef,\n    style: {\n      maxWidth: 1280,\n      position: 'relative'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"option\",\n      style: {\n        marginBottom: 8\n      },\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        id: \"use-stun\",\n        type: \"checkbox\",\n        checked: useStun,\n        onChange: e => setUseStun(e.target.checked),\n        style: {\n          accentColor: 'white'\n        },\n        disabled: started // 连接启动后禁用切换，避免状态不一致\n        // 注释掉STUN功能，禁用选择\n        ,\n        hidden: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 388,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 387,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: 8\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: zoomIn,\n        style: {\n          ...frostedGlassBtnStyle,\n          marginRight: 8,\n          ...(zoomInHover ? getBtnHoverStyle(false) : {})\n        },\n        onMouseEnter: () => setZoomInHover(true),\n        onMouseLeave: () => setZoomInHover(false),\n        type: \"button\",\n        children: \"\\u653E\\u5927\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 405,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: zoomOut,\n        style: {\n          ...frostedGlassBtnStyle,\n          ...(zoomOutHover ? getBtnHoverStyle(false) : {})\n        },\n        onMouseEnter: () => setZoomOutHover(true),\n        onMouseLeave: () => setZoomOutHover(false),\n        type: \"button\",\n        children: \"Zoom Out\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 418,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 404,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: start,\n      disabled: started,\n      style: {\n        ...(started ? disabledBtnStyle : frostedGlassBtnStyle),\n        ...(startBtnHover && !started ? getBtnHoverStyle(false) : {}),\n        marginRight: 8\n      },\n      onMouseEnter: () => setStartBtnHover(true),\n      onMouseLeave: () => setStartBtnHover(false),\n      type: \"button\",\n      children: \"Start\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 432,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: stop,\n      disabled: !started,\n      style: {\n        ...(!started ? disabledBtnStyle : frostedGlassBtnStyle),\n        ...(stopBtnHover && started ? getBtnHoverStyle(false) : {})\n      },\n      onMouseEnter: () => setStopBtnHover(true),\n      onMouseLeave: () => setStopBtnHover(false),\n      type: \"button\",\n      children: \"Stop\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 446,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"media\",\n      style: {\n        marginTop: 20\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        style: {\n          color: 'white'\n        },\n        children: \"\\u7BA1\\u5BB6\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 462,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"audio\", {\n        ref: audioRef,\n        autoPlay: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 464,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n        ref: videoRef,\n        style: {\n          width: zoomWidth,\n          height: zoomWidth * initialHeight / initialWidth,\n          display: 'block'\n        },\n        autoPlay: true,\n        playsInline: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 465,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 461,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        left: chatPos.left,\n        top: chatPos.top,\n        width: 320,\n        // 去掉背景色，保持透明\n        borderRadius: 8,\n        padding: 12,\n        // 去掉阴影，保持无背景\n        color: 'white',\n        userSelect: 'none',\n        cursor: draggingRef.current ? 'grabbing' : 'grab',\n        zIndex: 9999\n      },\n      onMouseDown: onDragStart,\n      onMouseMove: onDragMove,\n      onMouseUp: onDragEnd,\n      onMouseLeave: onDragEnd,\n      onTouchStart: onDragStart,\n      onTouchMove: onDragMove,\n      onTouchEnd: onDragEnd,\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        id: \"echo-form\",\n        onSubmit: handleSubmit,\n        style: {\n          display: 'flex',\n          flexDirection: 'column',\n          gap: 8\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"message\",\n          style: {\n            fontWeight: 'bold',\n            color: '#ccc'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 507,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          id: \"message\",\n          value: message,\n          onChange: e => setMessage(e.target.value),\n          rows: 3,\n          style: {\n            width: '100%',\n            resize: 'vertical',\n            fontSize: 14,\n            padding: 8,\n            borderRadius: 8,\n            border: '1px solid rgba(255, 255, 255, 0.3)',\n            backgroundColor: 'rgba(255, 255, 255, 0.1)',\n            // 半透明白色\n            backdropFilter: 'blur(10px)',\n            // 磨砂玻璃效果\n            WebkitBackdropFilter: 'blur(10px)',\n            // Safari 支持\n            color: 'white',\n            fontFamily: 'inherit',\n            outline: 'none',\n            transition: 'border-color 0.3s'\n          },\n          placeholder: \"\\u8BF7\\u8F93\\u5165\\u8981\\u53D1\\u9001\\u7ED9\\u7BA1\\u5BB6\\u6587\\u672C...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 510,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            justifyContent: 'flex-end',\n            alignItems: 'center',\n            gap: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"image-upload\",\n            style: {\n              ...frostedGlassBtnStyle,\n              display: 'inline-flex',\n              alignItems: 'center',\n              cursor: 'pointer',\n              padding: '6px 12px',\n              userSelect: 'none',\n              fontSize: 14,\n              lineHeight: '1.2'\n            },\n            title: \"\\u4E0A\\u4F20\\u56FE\\u7247\",\n            children: \"\\u4E0A\\u4F20\\u56FE\\u7247\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 541,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            id: \"image-upload\",\n            type: \"file\",\n            accept: \"image/*\",\n            style: {\n              display: 'none'\n            },\n            onChange: handleImageChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 557,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            style: {\n              ...frostedGlassBtnStyle,\n              padding: '6px 16px',\n              fontSize: 14,\n              lineHeight: '1.2'\n            },\n            children: \"\\u53D1\\u9001\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 565,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 532,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 498,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 474,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 386,\n    columnNumber: 5\n  }, this);\n}\n_s(OldWebRTC, \"tueJI1/udGIYCbtJE9I0SWSmNTg=\");\n_c = OldWebRTC;\nvar _c;\n$RefreshReg$(_c, \"OldWebRTC\");","map":{"version":3,"names":["React","useEffect","useRef","useState","jsxDEV","_jsxDEV","OldWebRTC","_s","videoRef","audioRef","pcRef","containerRef","useStun","setUseStun","started","setStarted","zoomWidth","setZoomWidth","initialWidth","initialHeight","SIGNALING_URL","zoomStep","chatPos","setChatPos","saved","localStorage","getItem","pos","JSON","parse","left","top","draggingRef","dragOffsetRef","x","y","onDragStart","e","current","targetRect","currentTarget","getBoundingClientRect","type","touches","clientX","clientY","preventDefault","stopPropagation","onDragMove","containerRect","newLeft","newTop","chatWidth","chatHeight","Math","min","max","width","height","onDragEnd","setItem","stringify","negotiate","pc","addTransceiver","direction","offer","createOffer","setLocalDescription","Promise","resolve","iceGatheringState","checkState","removeEventListener","addEventListener","response","fetch","method","headers","body","sdp","localDescription","answer","json","setRemoteDescription","alert","message","start","config","sdpSemantics","RTCPeerConnection","evt","track","kind","srcObject","streams","stop","zoomIn","w","zoomOut","setMessage","imageFile","setImageFile","sendTextMessage","trim","text","ok","Error","status","data","console","log","error","sendMultiModal","reader","FileReader","onloadend","base64data","result","payload","image","readAsDataURL","handleSubmit","handleImageChange","file","target","files","remoteVideoStream","getReceivers","forEach","receiver","readyState","remoteAudioStream","frostedGlassBtnStyle","backgroundColor","border","color","fontWeight","padding","cursor","borderRadius","outline","transition","fontSize","lineHeight","backdropFilter","WebkitBackdropFilter","boxShadow","disabledBtnStyle","opacity","getBtnHoverStyle","disabled","transform","startBtnHover","setStartBtnHover","stopBtnHover","setStopBtnHover","zoomInHover","setZoomInHover","zoomOutHover","setZoomOutHover","ref","style","maxWidth","position","children","className","marginBottom","id","checked","onChange","accentColor","hidden","fileName","_jsxFileName","lineNumber","columnNumber","onClick","marginRight","onMouseEnter","onMouseLeave","marginTop","autoPlay","display","playsInline","userSelect","zIndex","onMouseDown","onMouseMove","onMouseUp","onTouchStart","onTouchMove","onTouchEnd","onSubmit","flexDirection","gap","htmlFor","value","rows","resize","fontFamily","placeholder","justifyContent","alignItems","title","accept","_c","$RefreshReg$"],"sources":["D:/XM/AI-Sphere-Butler/core/client/src/components/OldWebRTC.jsx"],"sourcesContent":["// src/components/OldWebRTC.jsx\r\nimport React, { useEffect, useRef, useState } from 'react';\r\n\r\nexport default function OldWebRTC() {\r\n  const videoRef = useRef(null);\r\n  const audioRef = useRef(null);\r\n  const pcRef = useRef(null);\r\n\r\n  const containerRef = useRef(null); // 父容器引用，用于范围限制\r\n\r\n  const [useStun, setUseStun] = useState(false);\r\n  const [started, setStarted] = useState(false);\r\n  const [zoomWidth, setZoomWidth] = useState(600);\r\n\r\n  // 视频初始宽高\r\n  const initialWidth = 600;\r\n  const initialHeight = 450; // 按你代码比例\r\n\r\n  // 信令服务器地址（根据你实际后端调整）\r\n  const SIGNALING_URL = '/offer'; // POST 地址\r\n\r\n  // 视频缩放比例\r\n  const zoomStep = 50;\r\n\r\n  // 维护聊天框位置状态，默认位置距父容器左上角20px,20px\r\n  const [chatPos, setChatPos] = useState(() => {\r\n    try {\r\n      const saved = localStorage.getItem('chatbox-position');\r\n      if (saved) {\r\n        const pos = JSON.parse(saved);\r\n        if (\r\n          typeof pos.left === 'number' &&\r\n          typeof pos.top === 'number'\r\n        ) {\r\n          return pos;\r\n        }\r\n      }\r\n    } catch {}\r\n    return { left: 20, top: 20 };\r\n  });\r\n\r\n  // 拖拽相关状态\r\n  const draggingRef = useRef(false);\r\n  const dragOffsetRef = useRef({ x: 0, y: 0 });\r\n\r\n  // 拖拽事件处理\r\n  function onDragStart(e) {\r\n    draggingRef.current = true;\r\n    const targetRect = e.currentTarget.getBoundingClientRect();\r\n    if (e.type === 'touchstart' && e.touches && e.touches[0]) {\r\n      dragOffsetRef.current = {\r\n        x: e.touches[0].clientX - targetRect.left,\r\n        y: e.touches[0].clientY - targetRect.top,\r\n      };\r\n    } else {\r\n      dragOffsetRef.current = {\r\n        x: e.clientX - targetRect.left,\r\n        y: e.clientY - targetRect.top,\r\n      };\r\n    }\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n\r\n  function onDragMove(e) {\r\n    if (!draggingRef.current) return;\r\n\r\n    let clientX, clientY;\r\n    if (e.type === 'touchmove' && e.touches && e.touches[0]) {\r\n      clientX = e.touches[0].clientX;\r\n      clientY = e.touches[0].clientY;\r\n    } else if (e.type === 'mousemove') {\r\n      clientX = e.clientX;\r\n      clientY = e.clientY;\r\n    } else {\r\n      return;\r\n    }\r\n\r\n    if (!containerRef.current) return;\r\n\r\n    const containerRect = containerRef.current.getBoundingClientRect();\r\n\r\n    // 计算相对于父容器左上角的新位置\r\n    let newLeft = clientX - containerRect.left - dragOffsetRef.current.x;\r\n    let newTop = clientY - containerRect.top - dragOffsetRef.current.y;\r\n\r\n    // 限制拖拽范围在父容器内\r\n    const chatWidth = 320;\r\n    const chatHeight = 260;\r\n\r\n    newLeft = Math.min(Math.max(0, newLeft), containerRect.width - chatWidth);\r\n    newTop = Math.min(Math.max(0, newTop), containerRect.height - chatHeight);\r\n\r\n    setChatPos({ left: newLeft, top: newTop });\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n\r\n  function onDragEnd(e) {\r\n    if (draggingRef.current) {\r\n      draggingRef.current = false;\r\n      // 保存位置\r\n      localStorage.setItem('chatbox-position', JSON.stringify(chatPos));\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  // 创建并协商 WebRTC 连接\r\n  async function negotiate() {\r\n    const pc = pcRef.current;\r\n    if (!pc) return;\r\n\r\n    pc.addTransceiver('video', { direction: 'recvonly' });\r\n    pc.addTransceiver('audio', { direction: 'recvonly' });\r\n\r\n    try {\r\n      const offer = await pc.createOffer();\r\n      await pc.setLocalDescription(offer);\r\n\r\n      // 等待 ICE gathering 完成\r\n      await new Promise((resolve) => {\r\n        if (pc.iceGatheringState === 'complete') {\r\n          resolve();\r\n        } else {\r\n          const checkState = () => {\r\n            if (pc.iceGatheringState === 'complete') {\r\n              pc.removeEventListener('icegatheringstatechange', checkState);\r\n              resolve();\r\n            }\r\n          };\r\n          pc.addEventListener('icegatheringstatechange', checkState);\r\n        }\r\n      });\r\n\r\n      // 发送本地 SDP offer 到服务器，等待答复 SDP answer\r\n      const response = await fetch(SIGNALING_URL, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          sdp: pc.localDescription.sdp,\r\n          type: pc.localDescription.type,\r\n        }),\r\n      });\r\n      const answer = await response.json();\r\n\r\n      // 设置远端 SDP\r\n      await pc.setRemoteDescription(answer);\r\n\r\n      // 你原来页面有 sessionid 字段，这里不展示，需要的话可以自行扩展\r\n    } catch (e) {\r\n      alert('协商失败: ' + e.message);\r\n    }\r\n  }\r\n\r\n  function start() {\r\n    if (started) return;\r\n\r\n    const config = { sdpSemantics: 'unified-plan' };\r\n    // 注释掉 STUN 服务器配置，禁用 stun 功能\r\n    /*\r\n    if (useStun) {\r\n      config.iceServers = [{ urls: ['stun:stun.l.google.com:19302'] }];\r\n    }\r\n    */\r\n\r\n    const pc = new RTCPeerConnection(config);\r\n    pcRef.current = pc;\r\n\r\n    // 监听远端 track，绑定到 video/audio 标签\r\n    pc.addEventListener('track', (evt) => {\r\n      if (evt.track.kind === 'video') {\r\n        if (videoRef.current) {\r\n          videoRef.current.srcObject = evt.streams[0];\r\n        }\r\n      } else if (evt.track.kind === 'audio') {\r\n        if (audioRef.current) {\r\n          audioRef.current.srcObject = evt.streams[0];\r\n        }\r\n      }\r\n    });\r\n\r\n    setStarted(true);\r\n\r\n    negotiate();\r\n\r\n    // 初始化视频缩放（首次设置）\r\n    setZoomWidth(initialWidth);\r\n  }\r\n\r\n  function stop() {\r\n    if (!started) return;\r\n\r\n    setStarted(false);\r\n\r\n    // 注意：根据需求，这里不关闭 pc 连接，不停止流，保持后台推流不中断\r\n    // 如果你想真正停止，请取消下面注释\r\n    /*\r\n    setTimeout(() => {\r\n      if (pcRef.current) {\r\n        pcRef.current.close();\r\n        pcRef.current = null;\r\n      }\r\n    }, 500);\r\n\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      videoRef.current.srcObject.getTracks().forEach((t) => t.stop());\r\n      videoRef.current.srcObject = null;\r\n    }\r\n    if (audioRef.current && audioRef.current.srcObject) {\r\n      audioRef.current.srcObject.getTracks().forEach((t) => t.stop());\r\n      audioRef.current.srcObject = null;\r\n    }\r\n    */\r\n  }\r\n\r\n  // 缩放视频\r\n  function zoomIn() {\r\n    setZoomWidth((w) => w + zoomStep);\r\n  }\r\n  function zoomOut() {\r\n    setZoomWidth((w) => (w - zoomStep > 0 ? w - zoomStep : w));\r\n  }\r\n\r\n  // 文本框输入状态\r\n  const [message, setMessage] = useState('');\r\n  // 图片文件状态\r\n  const [imageFile, setImageFile] = useState(null);\r\n\r\n  // 发送文本消息函数，发送到 LLM 服务\r\n  const sendTextMessage = async () => {\r\n    if (!message.trim()) return;\r\n\r\n    try {\r\n      const response = await fetch('https://192.168.1.70:6010/qwener', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ text: message }),\r\n      });\r\n      if (!response.ok) {\r\n        throw new Error('网络响应失败，状态码: ' + response.status);\r\n      }\r\n      const data = await response.json();\r\n      console.log('文本发送成功，服务器返回：', data);\r\n    } catch (error) {\r\n      console.error('文本发送失败：', error);\r\n    }\r\n  };\r\n\r\n  // 发送图片+文本消息函数，发送到多模态服务\r\n  const sendMultiModal = async () => {\r\n    if (!imageFile) return;\r\n\r\n    try {\r\n      const reader = new FileReader();\r\n      reader.onloadend = async () => {\r\n        const base64data = reader.result;\r\n\r\n        const payload = {\r\n          text: message.trim(), // 文字\r\n          image: base64data,     // 图片 base64\r\n        };\r\n\r\n        const response = await fetch('https://192.168.1.70:6010/multimodal', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(payload),\r\n        });\r\n        if (!response.ok) {\r\n          throw new Error('网络响应失败，状态码: ' + response.status);\r\n        }\r\n        const data = await response.json();\r\n        console.log('多模态发送成功，服务器返回：', data);\r\n        setImageFile(null); // 清空图片\r\n        setMessage(''); // 清空文本\r\n      };\r\n      reader.readAsDataURL(imageFile);\r\n    } catch (error) {\r\n      console.error('多模态发送失败：', error);\r\n    }\r\n  };\r\n\r\n  // 表单提交处理\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (imageFile) {\r\n      // 有图片时，文本和图片一起发送到多模态服务\r\n      await sendMultiModal();\r\n    } else {\r\n      // 仅文本时，发送到 LLM 服务\r\n      await sendTextMessage();\r\n      setMessage(''); // 清空文本\r\n    }\r\n  };\r\n\r\n  // 选择图片处理\r\n  const handleImageChange = (e) => {\r\n    const file = e.target.files[0];\r\n    setImageFile(file || null);\r\n  };\r\n\r\n  // 组件挂载时，重新绑定已有远端流到 video/audio 标签，防止切换回来黑屏\r\n  useEffect(() => {\r\n    if (pcRef.current && videoRef.current && audioRef.current) {\r\n      const pc = pcRef.current;\r\n\r\n      // 视频流绑定\r\n      let remoteVideoStream = null;\r\n      pc.getReceivers().forEach((receiver) => {\r\n        if (receiver.track && receiver.track.kind === 'video') {\r\n          if (receiver.track.readyState === 'live') {\r\n            if (receiver.track.streams && receiver.track.streams[0]) {\r\n              remoteVideoStream = receiver.track.streams[0];\r\n            }\r\n          }\r\n        }\r\n      });\r\n      if (remoteVideoStream) {\r\n        videoRef.current.srcObject = remoteVideoStream;\r\n      }\r\n\r\n      // 音频流绑定\r\n      let remoteAudioStream = null;\r\n      pc.getReceivers().forEach((receiver) => {\r\n        if (receiver.track && receiver.track.kind === 'audio') {\r\n          if (receiver.track.readyState === 'live') {\r\n            if (receiver.track.streams && receiver.track.streams[0]) {\r\n              remoteAudioStream = receiver.track.streams[0];\r\n            }\r\n          }\r\n        }\r\n      });\r\n      if (remoteAudioStream) {\r\n        audioRef.current.srcObject = remoteAudioStream;\r\n      }\r\n    }\r\n  }, []); // 仅挂载时执行一次\r\n\r\n  // 通用磨砂玻璃按钮样式（纯 CSS 磨砂玻璃效果）\r\n  const frostedGlassBtnStyle = {\r\n    backgroundColor: 'rgba(255, 255, 255, 0.1)', // 半透明背景\r\n    border: '1px solid rgba(255, 255, 255, 0.3)', // 半透明边框\r\n    color: 'white',\r\n    fontWeight: 'bold',\r\n    padding: '8px 16px',\r\n    cursor: 'pointer',\r\n    borderRadius: 4,\r\n    outline: 'none',\r\n    transition: 'background-color 0.3s, color 0.3s, box-shadow 0.3s, transform 0.3s',\r\n    fontSize: 14,\r\n    lineHeight: '1.2',\r\n    backdropFilter: 'blur(10px)', // 磨砂玻璃模糊\r\n    WebkitBackdropFilter: 'blur(10px)',\r\n    boxShadow: '0 4px 10px rgba(255, 255, 255, 0.15)',\r\n  };\r\n\r\n  // 按钮禁用样式\r\n  const disabledBtnStyle = {\r\n    ...frostedGlassBtnStyle,\r\n    opacity: 0.4,\r\n    cursor: 'not-allowed',\r\n    boxShadow: 'none',\r\n  };\r\n\r\n  // 按钮 hover 效果内联样式函数\r\n  const getBtnHoverStyle = (disabled) => {\r\n    if (disabled) return {};\r\n    return {\r\n      backgroundColor: 'rgba(255, 255, 255, 0.2)',\r\n      boxShadow: '0 6px 20px rgba(255, 255, 255, 0.3)',\r\n      transform: 'scale(1.05)',\r\n    };\r\n  };\r\n\r\n  // 本组件内部按钮 hover 状态管理\r\n  const [startBtnHover, setStartBtnHover] = useState(false);\r\n  const [stopBtnHover, setStopBtnHover] = useState(false);\r\n  const [zoomInHover, setZoomInHover] = useState(false);\r\n  const [zoomOutHover, setZoomOutHover] = useState(false);\r\n\r\n  return (\r\n    <div ref={containerRef} style={{ maxWidth: 1280, position: 'relative' }}>\r\n      <div className=\"option\" style={{ marginBottom: 8 }}>\r\n        <input\r\n          id=\"use-stun\"\r\n          type=\"checkbox\"\r\n          checked={useStun}\r\n          onChange={(e) => setUseStun(e.target.checked)}\r\n          style={{ accentColor: 'white' }}\r\n          disabled={started} // 连接启动后禁用切换，避免状态不一致\r\n          // 注释掉STUN功能，禁用选择\r\n          hidden\r\n        />\r\n        {/* <label htmlFor=\"use-stun\" style={{ marginLeft: 4, color: 'white' }}>\r\n          Use STUN server\r\n        </label> */}\r\n      </div>\r\n\r\n      {/* 将 Zoom 按钮放到 Start、Stop 上面 */}\r\n      <div style={{ marginBottom: 8 }}>\r\n        <button\r\n          onClick={zoomIn}\r\n          style={{\r\n            ...frostedGlassBtnStyle,\r\n            marginRight: 8,\r\n            ...(zoomInHover ? getBtnHoverStyle(false) : {}),\r\n          }}\r\n          onMouseEnter={() => setZoomInHover(true)}\r\n          onMouseLeave={() => setZoomInHover(false)}\r\n          type=\"button\"\r\n        >\r\n          放大\r\n        </button>\r\n        <button\r\n          onClick={zoomOut}\r\n          style={{\r\n            ...frostedGlassBtnStyle,\r\n            ...(zoomOutHover ? getBtnHoverStyle(false) : {}),\r\n          }}\r\n          onMouseEnter={() => setZoomOutHover(true)}\r\n          onMouseLeave={() => setZoomOutHover(false)}\r\n          type=\"button\"\r\n        >\r\n          Zoom Out\r\n        </button>\r\n      </div>\r\n\r\n      <button\r\n        onClick={start}\r\n        disabled={started}\r\n        style={{\r\n          ...(started ? disabledBtnStyle : frostedGlassBtnStyle),\r\n          ...(startBtnHover && !started ? getBtnHoverStyle(false) : {}),\r\n          marginRight: 8,\r\n        }}\r\n        onMouseEnter={() => setStartBtnHover(true)}\r\n        onMouseLeave={() => setStartBtnHover(false)}\r\n        type=\"button\"\r\n      >\r\n        Start\r\n      </button>\r\n      <button\r\n        onClick={stop}\r\n        disabled={!started}\r\n        style={{\r\n          ...(!started ? disabledBtnStyle : frostedGlassBtnStyle),\r\n          ...(stopBtnHover && started ? getBtnHoverStyle(false) : {}),\r\n        }}\r\n        onMouseEnter={() => setStopBtnHover(true)}\r\n        onMouseLeave={() => setStopBtnHover(false)}\r\n        type=\"button\"\r\n      >\r\n        Stop\r\n      </button>\r\n\r\n      {/* 视频区域 */}\r\n      <div id=\"media\" style={{ marginTop: 20 }}>\r\n        <h2 style={{ color: 'white' }}>管家</h2>\r\n\r\n        <audio ref={audioRef} autoPlay />\r\n        <video\r\n          ref={videoRef}\r\n          style={{ width: zoomWidth, height: (zoomWidth * initialHeight) / initialWidth, display: 'block' }}\r\n          autoPlay\r\n          playsInline\r\n        />\r\n      </div>\r\n\r\n      {/* 可拖拽的聊天对话框容器 */}\r\n      <div\r\n        style={{\r\n          position: 'absolute',\r\n          left: chatPos.left,\r\n          top: chatPos.top,\r\n          width: 320,\r\n          // 去掉背景色，保持透明\r\n          borderRadius: 8,\r\n          padding: 12,\r\n          // 去掉阴影，保持无背景\r\n          color: 'white',\r\n          userSelect: 'none',\r\n          cursor: draggingRef.current ? 'grabbing' : 'grab',\r\n          zIndex: 9999,\r\n        }}\r\n        onMouseDown={onDragStart}\r\n        onMouseMove={onDragMove}\r\n        onMouseUp={onDragEnd}\r\n        onMouseLeave={onDragEnd}\r\n        onTouchStart={onDragStart}\r\n        onTouchMove={onDragMove}\r\n        onTouchEnd={onDragEnd}\r\n      >\r\n        {/* 文本发送表单，放在聊天框内 */}\r\n        <form\r\n          id=\"echo-form\"\r\n          onSubmit={handleSubmit}\r\n          style={{\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            gap: 8,\r\n          }}\r\n        >\r\n          <label htmlFor=\"message\" style={{ fontWeight: 'bold', color: '#ccc' }}>\r\n            {/* 可自定义标签内容 */}\r\n          </label>\r\n          <textarea\r\n            id=\"message\"\r\n            value={message}\r\n            onChange={(e) => setMessage(e.target.value)}\r\n            rows={3}\r\n            style={{\r\n              width: '100%',\r\n              resize: 'vertical',\r\n              fontSize: 14,\r\n              padding: 8,\r\n              borderRadius: 8,\r\n              border: '1px solid rgba(255, 255, 255, 0.3)',\r\n              backgroundColor: 'rgba(255, 255, 255, 0.1)', // 半透明白色\r\n              backdropFilter: 'blur(10px)', // 磨砂玻璃效果\r\n              WebkitBackdropFilter: 'blur(10px)', // Safari 支持\r\n              color: 'white',\r\n              fontFamily: 'inherit',\r\n              outline: 'none',\r\n              transition: 'border-color 0.3s',\r\n            }}\r\n            placeholder=\"请输入要发送给管家文本...\"\r\n          />\r\n          <div\r\n            style={{\r\n              display: 'flex',\r\n              justifyContent: 'flex-end',\r\n              alignItems: 'center',\r\n              gap: 8,\r\n            }}\r\n          >\r\n            {/* 上传图片按钮 */}\r\n            <label\r\n              htmlFor=\"image-upload\"\r\n              style={{\r\n                ...frostedGlassBtnStyle,\r\n                display: 'inline-flex',\r\n                alignItems: 'center',\r\n                cursor: 'pointer',\r\n                padding: '6px 12px',\r\n                userSelect: 'none',\r\n                fontSize: 14,\r\n                lineHeight: '1.2',\r\n              }}\r\n              title=\"上传图片\"\r\n            >\r\n              上传图片\r\n            </label>\r\n            <input\r\n              id=\"image-upload\"\r\n              type=\"file\"\r\n              accept=\"image/*\"\r\n              style={{ display: 'none' }}\r\n              onChange={handleImageChange}\r\n            />\r\n\r\n            <button\r\n              type=\"submit\"\r\n              style={{\r\n                ...frostedGlassBtnStyle,\r\n                padding: '6px 16px',\r\n                fontSize: 14,\r\n                lineHeight: '1.2',\r\n              }}\r\n            >\r\n              发送\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}