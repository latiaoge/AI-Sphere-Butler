{"ast":null,"code":"import _objectSpread from\"D:/XM/AI-Sphere-Butler/core/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// components/WallpaperManager.jsx\nimport React,{useState,useEffect}from'react';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";export const menuWallpapers={home:'/core/client/ai-butler/image/bg-home.jpeg',// 这里仍留图片作为备用\nbutler:'/core/client/ai-butler/image/bg-butler.jpeg',car:'/core/client/ai-butler/image/bg-car.jpeg',homeassistant:'/core/client/ai-butler/image/bg-homeassistant.jpeg',ops:'/core/client/ai-butler/image/bg-ops.jpeg',settings:'/core/client/ai-butler/image/bg-settings.jpeg'};// 视频文件路径（请替换成实际mp4路径）\nconst homeVideoSrc='/core/client/ai-butler/video/bg-home.mp4';const WallpaperManager=_ref=>{let{selectedMenu,showGlassTransition}=_ref;const[currentWallpaper,setCurrentWallpaper]=useState(menuWallpapers.home);// 默认使用home壁纸\nconst[isVideoLoaded,setIsVideoLoaded]=useState(false);const[isVideoError,setIsVideoError]=useState(false);const[isImageLoading,setIsImageLoading]=useState(true);const[imageLoadError,setImageLoadError]=useState(false);useEffect(()=>{// 重置所有状态\nsetIsVideoLoaded(false);setIsVideoError(false);setImageLoadError(false);setIsImageLoading(true);if(selectedMenu==='home'){// 主页，重置壁纸为home图作为备用\nsetCurrentWallpaper(menuWallpapers.home);setIsImageLoading(false);// 主页不主动加载图片，立即置false\nreturn;}// 其他菜单，加载对应图片\nconst targetWallpaper=menuWallpapers[selectedMenu]||menuWallpapers.home;const img=new Image();img.onload=()=>{setCurrentWallpaper(targetWallpaper);setIsImageLoading(false);};img.onerror=()=>{console.error('壁纸加载失败:',targetWallpaper);// 尝试加载默认home壁纸\nconst homeImg=new Image();homeImg.onload=()=>{setCurrentWallpaper(menuWallpapers.home);setIsImageLoading(false);};homeImg.onerror=()=>{setImageLoadError(true);setIsImageLoading(false);};homeImg.src=menuWallpapers.home;};img.src=targetWallpaper;},[selectedMenu]);// 公共样式\nconst baseStyle={position:'fixed',top:0,left:0,width:'100%',height:'100%',zIndex:-1,pointerEvents:'none',transition:'opacity 0.5s ease-in-out'};// 视频专用样式，带objectFit\nconst videoStyle=_objectSpread(_objectSpread({},baseStyle),{},{objectFit:'cover',opacity:isVideoLoaded&&!isVideoError?1:0});// 图片专用样式\nconst imageStyle=_objectSpread(_objectSpread({},baseStyle),{},{backgroundImage:\"url(\".concat(currentWallpaper,\")\"),backgroundSize:'cover',backgroundPosition:'center',opacity:(selectedMenu!=='home'||isVideoError)&&!isImageLoading&&!imageLoadError?1:0});// 视频加载成功回调\nconst handleVideoCanPlay=()=>{setIsVideoLoaded(true);setIsVideoError(false);};// 视频加载失败回调\nconst handleVideoError=()=>{console.error('视频加载失败，切换为壁纸');setIsVideoError(true);setIsVideoLoaded(false);};// 如果是home菜单，优先显示视频，视频加载失败或没加载时显示壁纸\nif(selectedMenu==='home'){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"video\",{// 关键：切换时强制重新挂载视频节点，触发加载\nautoPlay:true,loop:true,muted:true,playsInline:true,preload:\"auto\",style:videoStyle,src:homeVideoSrc,\"aria-hidden\":\"true\",onCanPlay:handleVideoCanPlay,onError:handleVideoError},homeVideoSrc),(isVideoError||!isVideoLoaded)&&!isImageLoading&&!imageLoadError&&/*#__PURE__*/_jsx(\"div\",{className:\"app-wallpaper\",style:imageStyle,\"aria-hidden\":\"true\"})]});}// 其他菜单只显示图片背景\nreturn/*#__PURE__*/_jsxs(_Fragment,{children:[!isImageLoading&&!imageLoadError&&/*#__PURE__*/_jsx(\"div\",{className:\"app-wallpaper\",style:imageStyle,\"aria-hidden\":\"true\"}),imageLoadError&&/*#__PURE__*/_jsx(\"div\",{className:\"app-wallpaper\",style:_objectSpread(_objectSpread({},baseStyle),{},{backgroundColor:'#222',opacity:1}),\"aria-hidden\":\"true\"})]});};export default WallpaperManager;","map":{"version":3,"names":["React","useState","useEffect","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","menuWallpapers","home","butler","car","homeassistant","ops","settings","homeVideoSrc","WallpaperManager","_ref","selectedMenu","showGlassTransition","currentWallpaper","setCurrentWallpaper","isVideoLoaded","setIsVideoLoaded","isVideoError","setIsVideoError","isImageLoading","setIsImageLoading","imageLoadError","setImageLoadError","targetWallpaper","img","Image","onload","onerror","console","error","homeImg","src","baseStyle","position","top","left","width","height","zIndex","pointerEvents","transition","videoStyle","_objectSpread","objectFit","opacity","imageStyle","backgroundImage","concat","backgroundSize","backgroundPosition","handleVideoCanPlay","handleVideoError","children","autoPlay","loop","muted","playsInline","preload","style","onCanPlay","onError","className","backgroundColor"],"sources":["D:/XM/AI-Sphere-Butler/core/client/src/components/WallpaperManager.jsx"],"sourcesContent":["// components/WallpaperManager.jsx\r\nimport React, { useState, useEffect } from 'react';\r\n\r\nexport const menuWallpapers = {\r\n  home: '/core/client/ai-butler/image/bg-home.jpeg', // 这里仍留图片作为备用\r\n  butler: '/core/client/ai-butler/image/bg-butler.jpeg',\r\n  car: '/core/client/ai-butler/image/bg-car.jpeg',\r\n  homeassistant: '/core/client/ai-butler/image/bg-homeassistant.jpeg',\r\n  ops: '/core/client/ai-butler/image/bg-ops.jpeg',\r\n  settings: '/core/client/ai-butler/image/bg-settings.jpeg',\r\n};\r\n\r\n// 视频文件路径（请替换成实际mp4路径）\r\nconst homeVideoSrc = '/core/client/ai-butler/video/bg-home.mp4';\r\n\r\nconst WallpaperManager = ({ selectedMenu, showGlassTransition }) => {\r\n  const [currentWallpaper, setCurrentWallpaper] = useState(menuWallpapers.home); // 默认使用home壁纸\r\n  const [isVideoLoaded, setIsVideoLoaded] = useState(false);\r\n  const [isVideoError, setIsVideoError] = useState(false);\r\n  const [isImageLoading, setIsImageLoading] = useState(true);\r\n  const [imageLoadError, setImageLoadError] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // 重置所有状态\r\n    setIsVideoLoaded(false);\r\n    setIsVideoError(false);\r\n    setImageLoadError(false);\r\n    setIsImageLoading(true);\r\n\r\n    if (selectedMenu === 'home') {\r\n      // 主页，重置壁纸为home图作为备用\r\n      setCurrentWallpaper(menuWallpapers.home);\r\n      setIsImageLoading(false); // 主页不主动加载图片，立即置false\r\n      return;\r\n    }\r\n\r\n    // 其他菜单，加载对应图片\r\n    const targetWallpaper = menuWallpapers[selectedMenu] || menuWallpapers.home;\r\n    \r\n    const img = new Image();\r\n    img.onload = () => {\r\n      setCurrentWallpaper(targetWallpaper);\r\n      setIsImageLoading(false);\r\n    };\r\n    img.onerror = () => {\r\n      console.error('壁纸加载失败:', targetWallpaper);\r\n      // 尝试加载默认home壁纸\r\n      const homeImg = new Image();\r\n      homeImg.onload = () => {\r\n        setCurrentWallpaper(menuWallpapers.home);\r\n        setIsImageLoading(false);\r\n      };\r\n      homeImg.onerror = () => {\r\n        setImageLoadError(true);\r\n        setIsImageLoading(false);\r\n      };\r\n      homeImg.src = menuWallpapers.home;\r\n    };\r\n    img.src = targetWallpaper;\r\n  }, [selectedMenu]);\r\n\r\n  // 公共样式\r\n  const baseStyle = {\r\n    position: 'fixed',\r\n    top: 0,\r\n    left: 0,\r\n    width: '100%',\r\n    height: '100%',\r\n    zIndex: -1,\r\n    pointerEvents: 'none',\r\n    transition: 'opacity 0.5s ease-in-out',\r\n  };\r\n\r\n  // 视频专用样式，带objectFit\r\n  const videoStyle = {\r\n    ...baseStyle,\r\n    objectFit: 'cover',\r\n    opacity: isVideoLoaded && !isVideoError ? 1 : 0,\r\n  };\r\n\r\n  // 图片专用样式\r\n  const imageStyle = {\r\n    ...baseStyle,\r\n    backgroundImage: `url(${currentWallpaper})`,\r\n    backgroundSize: 'cover',\r\n    backgroundPosition: 'center',\r\n    opacity: (selectedMenu !== 'home' || isVideoError) && !isImageLoading && !imageLoadError ? 1 : 0,\r\n  };\r\n\r\n  // 视频加载成功回调\r\n  const handleVideoCanPlay = () => {\r\n    setIsVideoLoaded(true);\r\n    setIsVideoError(false);\r\n  };\r\n\r\n  // 视频加载失败回调\r\n  const handleVideoError = () => {\r\n    console.error('视频加载失败，切换为壁纸');\r\n    setIsVideoError(true);\r\n    setIsVideoLoaded(false);\r\n  };\r\n\r\n  // 如果是home菜单，优先显示视频，视频加载失败或没加载时显示壁纸\r\n  if (selectedMenu === 'home') {\r\n    return (\r\n      <>\r\n        <video\r\n          key={homeVideoSrc} // 关键：切换时强制重新挂载视频节点，触发加载\r\n          autoPlay\r\n          loop\r\n          muted\r\n          playsInline\r\n          preload=\"auto\"\r\n          style={videoStyle}\r\n          src={homeVideoSrc}\r\n          aria-hidden=\"true\"\r\n          onCanPlay={handleVideoCanPlay}\r\n          onError={handleVideoError}\r\n        />\r\n        {/* 视频加载失败或尚未加载时，显示壁纸作为后备 */}\r\n        {(isVideoError || !isVideoLoaded) && !isImageLoading && !imageLoadError && (\r\n          <div\r\n            className=\"app-wallpaper\"\r\n            style={imageStyle}\r\n            aria-hidden=\"true\"\r\n          />\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n\r\n  // 其他菜单只显示图片背景\r\n  return (\r\n    <>\r\n      {(!isImageLoading && !imageLoadError) && (\r\n        <div\r\n          className=\"app-wallpaper\"\r\n          style={imageStyle}\r\n          aria-hidden=\"true\"\r\n        />\r\n      )}\r\n      {imageLoadError && (\r\n        <div\r\n          className=\"app-wallpaper\"\r\n          style={{\r\n            ...baseStyle,\r\n            backgroundColor: '#222',\r\n            opacity: 1,\r\n          }}\r\n          aria-hidden=\"true\"\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default WallpaperManager;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}