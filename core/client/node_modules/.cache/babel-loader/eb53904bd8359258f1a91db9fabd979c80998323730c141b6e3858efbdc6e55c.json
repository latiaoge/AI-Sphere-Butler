{"ast":null,"code":"// src/components/SpeechRecognizer.jsx\nimport React,{useEffect,useRef,useState}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function SpeechRecognizer(_ref){let{onSendText}=_ref;const[listening,setListening]=useState(false);const[text,setText]=useState('');const recognitionRef=useRef(null);useEffect(()=>{if(!('webkitSpeechRecognition'in window)){alert('请使用支持语音识别的 Chrome 浏览器');return;}const recognition=new window.webkitSpeechRecognition();recognition.lang='zh-CN';recognition.continuous=true;recognition.interimResults=true;recognition.onstart=()=>setListening(true);recognition.onerror=e=>{console.error('语音识别错误',e);setListening(false);};recognition.onend=()=>{setListening(false);if(text.trim()){onSendText(text.trim());setText('');}};recognition.onresult=e=>{let interim='';for(let i=e.resultIndex;i<e.results.length;i++){const transcript=e.results[i][0].transcript;if(e.results[i].isFinal){setText(prev=>prev+transcript);}else{interim+=transcript;}}};recognitionRef.current=recognition;return()=>{recognition.stop();};},[onSendText,text]);function toggleListening(){if(listening)recognitionRef.current.stop();else{setText('');recognitionRef.current.start();}}return/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:20},children:[/*#__PURE__*/_jsx(\"button\",{onClick:toggleListening,children:listening?'停止识别':'开始识别'}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:8,padding:8,backgroundColor:'#fff',borderRadius:6,border:'1px solid #ccc',minHeight:40,fontSize:14,color:'#333'},children:text||/*#__PURE__*/_jsx(\"i\",{children:\"\\u8BC6\\u522B\\u7ED3\\u679C\\u663E\\u793A\\u4E8E\\u6B64\"})})]});}","map":{"version":3,"names":["React","useEffect","useRef","useState","jsx","_jsx","jsxs","_jsxs","SpeechRecognizer","_ref","onSendText","listening","setListening","text","setText","recognitionRef","window","alert","recognition","webkitSpeechRecognition","lang","continuous","interimResults","onstart","onerror","e","console","error","onend","trim","onresult","interim","i","resultIndex","results","length","transcript","isFinal","prev","current","stop","toggleListening","start","style","marginTop","children","onClick","padding","backgroundColor","borderRadius","border","minHeight","fontSize","color"],"sources":["D:/XM/AI-Sphere-Butler/core/client/src/components/SpeechRecognizer.jsx"],"sourcesContent":["// src/components/SpeechRecognizer.jsx\r\nimport React, { useEffect, useRef, useState } from 'react';\r\n\r\nexport default function SpeechRecognizer({ onSendText }) {\r\n  const [listening, setListening] = useState(false);\r\n  const [text, setText] = useState('');\r\n  const recognitionRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (!('webkitSpeechRecognition' in window)) {\r\n      alert('请使用支持语音识别的 Chrome 浏览器');\r\n      return;\r\n    }\r\n    const recognition = new window.webkitSpeechRecognition();\r\n    recognition.lang = 'zh-CN';\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n\r\n    recognition.onstart = () => setListening(true);\r\n    recognition.onerror = e => {\r\n      console.error('语音识别错误', e);\r\n      setListening(false);\r\n    };\r\n    recognition.onend = () => {\r\n      setListening(false);\r\n      if (text.trim()) {\r\n        onSendText(text.trim());\r\n        setText('');\r\n      }\r\n    };\r\n    recognition.onresult = e => {\r\n      let interim = '';\r\n      for (let i = e.resultIndex; i < e.results.length; i++) {\r\n        const transcript = e.results[i][0].transcript;\r\n        if (e.results[i].isFinal) {\r\n          setText(prev => prev + transcript);\r\n        } else {\r\n          interim += transcript;\r\n        }\r\n      }\r\n    };\r\n\r\n    recognitionRef.current = recognition;\r\n\r\n    return () => {\r\n      recognition.stop();\r\n    };\r\n  }, [onSendText, text]);\r\n\r\n  function toggleListening() {\r\n    if (listening) recognitionRef.current.stop();\r\n    else {\r\n      setText('');\r\n      recognitionRef.current.start();\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div style={{ marginTop: 20 }}>\r\n      <button onClick={toggleListening}>{listening ? '停止识别' : '开始识别'}</button>\r\n      <div\r\n        style={{\r\n          marginTop: 8,\r\n          padding: 8,\r\n          backgroundColor: '#fff',\r\n          borderRadius: 6,\r\n          border: '1px solid #ccc',\r\n          minHeight: 40,\r\n          fontSize: 14,\r\n          color: '#333',\r\n        }}\r\n      >\r\n        {text || <i>识别结果显示于此</i>}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}