{"ast":null,"code":"import React,{createContext,useState,useContext,useEffect}from'react';// 创建Context\nimport{jsx as _jsx}from\"react/jsx-runtime\";const ButlerContext=/*#__PURE__*/createContext({activeButlerId:null,setActiveButlerId:()=>{},butlers:[],addButler:()=>{}});// Provider组件\nexport function ButlerProvider(_ref){let{children}=_ref;const[butlers,setButlers]=useState([]);const[activeButlerId,setActiveButlerId]=useState(null);// 动态添加管家方法，支持替换\nfunction addButler(newButler){let replaceButlerId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;setButlers(prevButlers=>{let newButlers;if(replaceButlerId){newButlers=prevButlers.filter(b=>b.id!==replaceButlerId);newButlers.push(newButler);}else{const existsIndex=prevButlers.findIndex(b=>b.id===newButler.id);if(existsIndex!==-1){newButlers=[...prevButlers];newButlers[existsIndex]=newButler;}else{newButlers=[...prevButlers,newButler];}}return newButlers;});if(replaceButlerId){setActiveButlerId(newButler.id);}}// 从后端加载管家数据\nuseEffect(()=>{const fetchButlers=async()=>{try{const response=await fetch('/api/butlers');if(!response.ok)throw new Error(\"HTTP\\u9519\\u8BEF: \".concat(response.status));const data=await response.json();if(data.success){console.log('[ButlerProvider] 从后端加载管家数据成功:',data);setButlers(data.butlers||[]);setActiveButlerId(data.activeButlerId);}else{console.error('[ButlerProvider] 加载管家数据失败:',data.error);}}catch(err){console.error('[ButlerProvider] 加载管家数据异常:',err);}};fetchButlers();},[]);return/*#__PURE__*/_jsx(ButlerContext.Provider,{value:{activeButlerId,setActiveButlerId,butlers,addButler},children:children});}// 自定义hook\nexport function useButler(){return useContext(ButlerContext);}","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","jsx","_jsx","ButlerContext","activeButlerId","setActiveButlerId","butlers","addButler","ButlerProvider","_ref","children","setButlers","newButler","replaceButlerId","arguments","length","undefined","prevButlers","newButlers","filter","b","id","push","existsIndex","findIndex","fetchButlers","response","fetch","ok","Error","concat","status","data","json","success","console","log","error","err","Provider","value","useButler"],"sources":["D:/XM/AI-Sphere-Butler/core/client/src/components/ButlersContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\n\r\n// 创建Context\r\nconst ButlerContext = createContext({\r\n  activeButlerId: null,\r\n  setActiveButlerId: () => {},\r\n  butlers: [],\r\n  addButler: () => {},\r\n});\r\n\r\n// Provider组件\r\nexport function ButlerProvider({ children }) {\r\n  const [butlers, setButlers] = useState([]);\r\n  const [activeButlerId, setActiveButlerId] = useState(null);\r\n\r\n  // 动态添加管家方法，支持替换\r\n  function addButler(newButler, replaceButlerId = null) {\r\n    setButlers(prevButlers => {\r\n      let newButlers;\r\n      if (replaceButlerId) {\r\n        newButlers = prevButlers.filter(b => b.id !== replaceButlerId);\r\n        newButlers.push(newButler);\r\n      } else {\r\n        const existsIndex = prevButlers.findIndex(b => b.id === newButler.id);\r\n        if (existsIndex !== -1) {\r\n          newButlers = [...prevButlers];\r\n          newButlers[existsIndex] = newButler;\r\n        } else {\r\n          newButlers = [...prevButlers, newButler];\r\n        }\r\n      }\r\n      return newButlers;\r\n    });\r\n\r\n    if (replaceButlerId) {\r\n      setActiveButlerId(newButler.id);\r\n    }\r\n  }\r\n\r\n  // 从后端加载管家数据\r\n  useEffect(() => {\r\n    const fetchButlers = async () => {\r\n      try {\r\n        const response = await fetch('/api/butlers');\r\n        if (!response.ok) throw new Error(`HTTP错误: ${response.status}`);\r\n        \r\n        const data = await response.json();\r\n        if (data.success) {\r\n          console.log('[ButlerProvider] 从后端加载管家数据成功:', data);\r\n          setButlers(data.butlers || []);\r\n          setActiveButlerId(data.activeButlerId);\r\n        } else {\r\n          console.error('[ButlerProvider] 加载管家数据失败:', data.error);\r\n        }\r\n      } catch (err) {\r\n        console.error('[ButlerProvider] 加载管家数据异常:', err);\r\n      }\r\n    };\r\n\r\n    fetchButlers();\r\n  }, []);\r\n\r\n  return (\r\n    <ButlerContext.Provider value={{ activeButlerId, setActiveButlerId, butlers, addButler }}>\r\n      {children}\r\n    </ButlerContext.Provider>\r\n  );\r\n}\r\n\r\n// 自定义hook\r\nexport function useButler() {\r\n  return useContext(ButlerContext);\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}