{"ast":null,"code":"// D:\\XM\\AI-Sphere-Butler\\core\\client\\src\\components\\ButlerShowcase.jsx\nimport React,{useState,useRef,useEffect}from'react';import{useButler}from'./ButlersContext';import{useRecorderContext}from'../contexts/RecorderProvider';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const activateSoundSrc='/core/client/ai-butler/sounds/activate.mp3';// *** 修改开始：动态获取 BACKEND_URL ***\n// 1. 定义一个函数来获取当前的后端 URL\nconst getDynamicBackendUrl=()=>{let serverUrls={};try{const savedUrls=localStorage.getItem('serverUrls');if(savedUrls){serverUrls=JSON.parse(savedUrls);}}catch(e){console.error(\"ButlerShowcase: Failed to parse serverUrls from localStorage\",e);}// 优先使用 apiBaseUrl 配置项，如果没有则 fallback 到环境变量或默认值\n// 你可以根据实际配置项名称调整 'apiBaseUrl'\nreturn serverUrls.apiBaseUrl||process.env.REACT_APP_BACKEND_URL||'http://localhost:6010';};// 2. 初始化 BACKEND_URL 常量\nlet BACKEND_URL=getDynamicBackendUrl();console.log('[ButlerShowcase] Initial BACKEND_URL:',BACKEND_URL);// 3. 监听 storage 事件，如果配置更新，重新加载页面以应用新 URL\n//    (这是一种简单直接的方式，确保所有使用到 URL 的地方都用最新的)\n//    如果需要更精细的控制（不刷新页面），需要修改更多组件逻辑来响应变化。\nuseEffect(()=>{const handleStorageChange=e=>{if(e.key==='serverUrls'){console.log('[ButlerShowcase] serverUrls changed in localStorage, reloading page...');// 重新加载页面以确保新的 BACKEND_URL 生效\nwindow.location.reload();}};window.addEventListener('storage',handleStorageChange);return()=>window.removeEventListener('storage',handleStorageChange);},[]);// 空依赖数组，只在组件挂载时添加一次监听器\n// *** 修改结束 ***\nexport default function ButlerShowcase(){const{activeButlerId,butlers,addButler,setActiveButlerId}=useButler();const{activateButler}=useRecorderContext();const videoRefs=useRef({});const activateAudioRef=useRef(null);const[hoveredId,setHoveredId]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);// 管家创建相关状态\nconst[butlerName,setButlerName]=useState('');const[selectedFile,setSelectedFile]=useState(null);const[uploadProgress,setUploadProgress]=useState(0);const[statusMessage,setStatusMessage]=useState('');const[isProcessing,setIsProcessing]=useState(false);// 替换管家的管家ID状态\nconst[replaceButlerId,setReplaceButlerId]=useState('');// 页面初始化时从后端加载管家数据\nuseEffect(()=>{const fetchInitialButlers=async()=>{try{console.log('[ButlerShowcase] 从后端加载初始管家数据...');// *** 修改：使用动态 BACKEND_URL ***\nconst response=await fetch(\"\".concat(BACKEND_URL,\"/api/butlers\"));if(!response.ok)throw new Error(\"HTTP\\u9519\\u8BEF: \".concat(response.status));const data=await response.json();if(data.success){var _data$butlers;// 关键日志：打印后端返回的管家数量\nconsole.log('[ButlerShowcase] 后端返回管家总数:',((_data$butlers=data.butlers)===null||_data$butlers===void 0?void 0:_data$butlers.length)||0);console.log('[ButlerShowcase] 后端返回的管家列表:',data.butlers);if(data.butlers&&data.butlers.length>0&&data.activeButlerId){setActiveButlerId(data.activeButlerId);}}}catch(err){console.error('[ButlerShowcase] 加载初始管家数据失败:',err);}};fetchInitialButlers();},[setActiveButlerId]);// 全局状态更新时刷新视频\nuseEffect(()=>{console.log('[ButlerShowcase] 全局activeButlerId更新为:',activeButlerId);const activeVideo=videoRefs.current[activeButlerId];if(activeVideo){activeVideo.load();activeVideo.play().catch(e=>console.warn(\"\\u64AD\\u653E\\u89C6\\u9891 \".concat(activeButlerId,\" \\u5931\\u8D25\"),e));}},[activeButlerId]);// 初始化视频状态及激活亮灯动画控制\nuseEffect(()=>{butlers.forEach(_ref=>{let{id,src}=_ref;const video=videoRefs.current[id];if(!video)return;const isActive=id===activeButlerId;// 关键修复：生成完整的绝对路径（解决相对路径导致的404）\nlet videoSrcAbsolute;try{// 处理绝对路径和相对路径两种情况\nif(src.startsWith('http://')||src.startsWith('https://')){videoSrcAbsolute=src;}else{// *** 修改：使用动态 BACKEND_URL 拼接 ***\nvideoSrcAbsolute=new URL(src,BACKEND_URL).href;}console.log(\"[\\u89C6\\u9891\\u8DEF\\u5F84\\u4FEE\\u590D] \\u7BA1\\u5BB6ID: \".concat(id,\", \\u539F\\u59CB\\u8DEF\\u5F84: \").concat(src,\", \\u4FEE\\u6B63\\u540E\\u8DEF\\u5F84: \").concat(videoSrcAbsolute));}catch(err){console.error(\"[\\u89C6\\u9891\\u8DEF\\u5F84\\u9519\\u8BEF] \\u89E3\\u6790\\u5931\\u8D25: \".concat(src),err);videoSrcAbsolute=src;// 失败时使用原始路径\n}// 仅在路径变化时更新，避免重复加载\nif(video.src!==videoSrcAbsolute){video.src=videoSrcAbsolute;}// 原有状态逻辑\nif(isActive){video.style.filter='none';video.muted=false;}else{video.pause();video.currentTime=0;video.style.filter='grayscale(100%) brightness(65%)';}});},[activeButlerId,butlers]);// *** 修改：移除 BACKEND_URL 依赖，因为它现在是模块级常量 ***\n// 处理视频播放暂停并控制激活管家动画和亮灯，支持鼠标悬停亮灯动画\nuseEffect(()=>{butlers.forEach(_ref2=>{let{id}=_ref2;const isActive=id===activeButlerId;const isHovered=id===hoveredId;const video=videoRefs.current[id];if(!video)return;if(isActive||isHovered){if(video.paused){video.play().catch(()=>{});}video.style.filter='none';video.style.transition='filter 0.3s ease';}else{if(!video.paused){video.pause();video.currentTime=0;}video.style.filter='grayscale(100%) brightness(65%)';video.style.transition='filter 0.3s ease';}});},[hoveredId,activeButlerId,butlers]);// 双击切换管家处理（添加后端同步）\nasync function handleDoubleClick(id){if(id===activeButlerId){console.log('[ButlerShowcase] 已激活该管家，无需切换');return;}if(loading)return;setLoading(true);setError(null);console.log('[ButlerShowcase] 尝试切换到管家:',id);try{// 1. 同步后端激活状态\nconsole.log('[ButlerShowcase] 同步后端激活状态:',id);// *** 修改：使用动态 BACKEND_URL ***\nconst response=await fetch(\"\".concat(BACKEND_URL,\"/api/butlers/active\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({activeButlerId:id})});const result=await response.json();if(!result.success){throw new Error(\"\\u66F4\\u65B0\\u6FC0\\u6D3B\\u72B6\\u6001\\u5931\\u8D25: \".concat(result.error||'未知错误'));}// 2. 调用原有激活逻辑\nif(typeof activateButler!=='function'){throw new Error('activateButler未定义，请检查RecorderProvider');}await activateButler(id);// 3. 更新本地状态\nsetActiveButlerId(id);const audio=activateAudioRef.current;if(audio){audio.currentTime=0;audio.play().catch(()=>{});}}catch(err){console.error('[ButlerShowcase] 切换失败:',err);setError(err.message||'切换失败，请重试');}finally{setLoading(false);}}// 处理文件选择\nconst handleFileChange=e=>{const file=e.target.files[0];if(file){console.log('选中文件:',file.name,'大小:',file.size);if(file.type!=='video/mp4'||file.size===0){setStatusMessage('请选择有效的MP4格式视频文件');setSelectedFile(null);return;}setSelectedFile(file);setStatusMessage(\"\\u5DF2\\u9009\\u62E9\\u6587\\u4EF6: \".concat(file.name));}};const handleSubmit=async e=>{e.preventDefault();if(!butlerName.trim()){setStatusMessage('请输入管家名称');return;}if(!selectedFile){setStatusMessage('请选择视频文件');return;}setIsProcessing(true);setStatusMessage('正在上传并制作管家形象...');setUploadProgress(0);try{const formData=new FormData();formData.append('name',butlerName.trim());formData.append('video',selectedFile);if(replaceButlerId){formData.append('replace_butler_id',replaceButlerId);}// *** 修改：使用动态 BACKEND_URL ***\nconst uploadUrl=\"\".concat(BACKEND_URL.replace(/\\/$/,''),\"/api/make_human?make_now=true\");await new Promise((resolve,reject)=>{const xhr=new XMLHttpRequest();xhr.open('POST',uploadUrl,true);xhr.upload.onprogress=event=>{if(event.lengthComputable){const percentCompleted=Math.round(event.loaded*100/event.total);setUploadProgress(percentCompleted);}};xhr.onload=()=>{console.log('上传完成，状态码:',xhr.status);console.log('响应:',xhr.responseText);if(xhr.status>=200&&xhr.status<300){try{const result=JSON.parse(xhr.responseText);if(result.success){setStatusMessage(\"\\u5236\\u4F5C\\u6210\\u529F\\uFF01\\u7BA1\\u5BB6\\u540D\\u79F0: \".concat(butlerName));if(typeof addButler==='function'){const videoPreviewPathRaw=(result.video_preview_path||'').replace(/\\\\/g,'/').trim();let videoSrc=videoPreviewPathRaw;if(videoSrc&&!videoSrc.startsWith('/')){videoSrc='/'+videoSrc;}// 修正路径，去掉开头的多余 \"/web\"\nvideoSrc=videoSrc.replace(/^\\/core\\/client\\/web\\//,'/core/client/');if(!videoSrc){// *** 修改：使用动态 BACKEND_URL 构造默认路径 ***\nvideoSrc=\"/core/server/virtual_human/wav2lip/\".concat(butlerName.trim(),\".mp4\");}const newButler={id:result.butler_id||Date.now().toString(),name:butlerName.trim(),type:'video',src:videoSrc};console.log('[上传完成] 新管家数据:',newButler,'替换管家ID:',replaceButlerId);addButler(newButler,replaceButlerId);setActiveButlerId(newButler.id);// 上传成功后从后端刷新最新数据\nsetTimeout(async()=>{try{// *** 修改：使用动态 BACKEND_URL ***\nconst response=await fetch(\"\".concat(BACKEND_URL,\"/api/butlers\"));const data=await response.json();if(data.success&&data.activeButlerId){setActiveButlerId(data.activeButlerId);}}catch(err){console.error('[ButlerShowcase] 上传后刷新激活状态失败:',err);}},1000);}setTimeout(()=>{setButlerName('');setSelectedFile(null);setUploadProgress(0);setReplaceButlerId('');},3000);resolve();}else{setStatusMessage(\"\\u5236\\u4F5C\\u5931\\u8D25: \".concat(result.error||result.message||'未知错误'));reject(new Error(result.error||result.message||'未知错误'));}}catch(err){setStatusMessage('返回数据解析失败');reject(err);}}else{setStatusMessage(\"\\u4E0A\\u4F20\\u5931\\u8D25\\uFF0C\\u72B6\\u6001\\u7801: \".concat(xhr.status));reject(new Error(\"\\u4E0A\\u4F20\\u5931\\u8D25\\uFF0C\\u72B6\\u6001\\u7801: \".concat(xhr.status)));}};xhr.onerror=()=>{console.error('上传请求失败');setStatusMessage('上传请求失败，请检查网络连接');reject(new Error('上传请求失败'));};xhr.send(formData);});}catch(error){console.error('上传失败',error);if(!statusMessage.includes('失败')){setStatusMessage(\"\\u8BF7\\u6C42\\u5931\\u8D25: \".concat(error.message));}}finally{setIsProcessing(false);}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"audio\",{ref:activateAudioRef,src:activateSoundSrc,preload:\"auto\"}),error&&/*#__PURE__*/_jsx(\"div\",{style:{color:'red',textAlign:'center',padding:10,backgroundColor:'rgba(255,0,0,0.1)',borderRadius:4,marginBottom:20,maxWidth:600,marginLeft:'auto',marginRight:'auto'},children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"steward-gallery\",style:{fontFamily:'Arial, sans-serif',backgroundColor:'transparent',padding:40,minHeight:'100vh',userSelect:'none'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"display-case\",style:{position:'relative',maxWidth:1400,/* 扩大容器宽度，容纳更多管家 */margin:'0 auto',borderRadius:8,overflow:'visible',backgroundColor:'transparent',boxShadow:'none'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"case-top\",style:{height:20,backgroundColor:'transparent',boxShadow:'none'}}),/*#__PURE__*/_jsx(\"div\",{className:\"case-bottom\",style:{height:20,backgroundColor:'transparent',boxShadow:'none'}}),/*#__PURE__*/_jsx(\"div\",{className:\"stewards-container\",style:{display:'flex',justifyContent:'center',backgroundColor:'transparent',padding:'30px 0',gap:30,/* 关键修改：增加间距，避免重叠 */flexWrap:'wrap'/* 关键修改：自动换行，支持多管家 */},children:console.log('[渲染] 管家数量:',butlers.length)||butlers.map((_ref3,index)=>{let{id,name,type,src}=_ref3;const isActive=id===activeButlerId;const isHovered=id===hoveredId;return/*#__PURE__*/_jsxs(\"div\",{className:\"steward \".concat(isActive?'active':'',\" \").concat(isHovered?'hovered':''),onMouseEnter:()=>{console.log(\"[\\u60AC\\u505C] \\u7BA1\\u5BB6 \".concat(name,\" (\").concat(id,\")\"));setHoveredId(id);},onMouseLeave:()=>{setHoveredId(null);},onDoubleClick:()=>{if(!loading){console.log(\"[\\u53CC\\u51FB] \\u6FC0\\u6D3B\\u7BA1\\u5BB6 \".concat(name,\" (\").concat(id,\")\"));handleDoubleClick(id);}},style:{position:'relative',width:240,height:480,display:'flex',flexDirection:'column',alignItems:'center',cursor:loading&&id!==activeButlerId?'not-allowed':'pointer',transition:'transform 0.3s ease',transform:isHovered?'translateY(-10px)':'translateY(0)',userSelect:'none',marginRight:0,/* 关键修改：移除右侧margin，用gap控制间距 */zIndex:1,opacity:loading&&id!==activeButlerId?0.7:1,pointerEvents:'auto'// 保证事件总是能触发\n},title:isActive?\"\\u5F53\\u524D\\u6FC0\\u6D3B\\u7BA1\\u5BB6\\uFF1A\".concat(name):\"\\u53CC\\u51FB\\u5207\\u6362\\u5230\\u7BA1\\u5BB6 \".concat(name),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"glass-panel\",style:{width:180,height:340,borderRadius:28,position:'relative',padding:2,background:'linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.03) 100%)',boxShadow:isActive?'0 8px 50px rgba(0, 229, 255, 0.6), inset 0 0 80px rgba(255, 255, 255, 0.2)':'0 8px 50px rgba(0, 229, 255, 0.4), inset 0 0 80px rgba(255, 255, 255, 0.15)',backdropFilter:'blur(20px)',WebkitBackdropFilter:'blur(20px)',border:'3px solid rgba(255, 255, 255, 0.45)',overflow:'hidden',userSelect:'none',filter:isActive?'drop-shadow(0 0 35px rgba(0,229,255,1))':'grayscale(100%) brightness(70%)',transition:'all 0.3s ease',zIndex:1},children:[/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',inset:0,pointerEvents:'none',borderRadius:28,backgroundImage:'radial-gradient(rgba(255,255,255,0.15) 1.5px, transparent 1.5px)',backgroundSize:'7px 7px',mixBlendMode:'overlay',zIndex:5,opacity:0.22}}),/*#__PURE__*/_jsx(\"div\",{className:\"glossy-edge\",style:{position:'absolute',top:-40,left:-40,width:260,height:420,borderRadius:40,pointerEvents:'none',background:'radial-gradient(circle at 15% 30%, rgba(255,255,255,0.5), transparent 65%),'+'radial-gradient(circle at 85% 70%, rgba(255,255,255,0.35), transparent 70%)',filter:'blur(18px)',opacity:0.7,animation:'glossyFlow 5.5s linear infinite',zIndex:6}}),type==='image'?/*#__PURE__*/_jsx(\"img\",{src:src,alt:name,draggable:false,style:{width:'100%',height:'100%',objectFit:'cover',borderRadius:20,position:'relative',zIndex:10,boxShadow:isActive?'0 0 24px rgba(0, 229, 255, 1)':'none',transition:'box-shadow 0.3s ease',userSelect:'none'}}):/*#__PURE__*/_jsx(\"video\",{ref:el=>{if(el){videoRefs.current[id]=el;// 打印视频元素状态\nconsole.log(\"[\\u89C6\\u9891\\u7ED1\\u5B9A] \\u7BA1\\u5BB6 \".concat(name,\" (\").concat(id,\") \\u89C6\\u9891\\u5143\\u7D20\\u5DF2\\u7ED1\\u5B9A\"),el);}},src:src,autoPlay:false,loop:true,muted:true,playsInline:true,preload:\"auto\",onError:()=>{console.error(\"[\\u89C6\\u9891\\u9519\\u8BEF] \\u7BA1\\u5BB6 \".concat(name,\" (\").concat(id,\") \\u89C6\\u9891\\u52A0\\u8F7D\\u5931\\u8D25\\uFF0Csrc: \").concat(src));setStatusMessage(\"\\u7BA1\\u5BB6\\u3010\".concat(name,\"\\u3011\\u89C6\\u9891\\u52A0\\u8F7D\\u5931\\u8D25\\uFF0C\\u8BF7\\u68C0\\u67E5\\u89C6\\u9891\\u8DEF\\u5F84\\u6216\\u7F51\\u7EDC\\u3002\"));},onPlay:()=>{console.log(\"[\\u89C6\\u9891\\u64AD\\u653E] \\u7BA1\\u5BB6 \".concat(name,\" (\").concat(id,\") \\u89C6\\u9891\\u5F00\\u59CB\\u64AD\\u653E\"));},style:{width:'100%',height:'100%',objectFit:'cover',borderRadius:20,position:'relative',zIndex:10,userSelect:'none',pointerEvents:'none',// 让事件穿透父元素\nfilter:isActive||isHovered?'none':'grayscale(100%) brightness(70%)',transition:'filter 0.3s ease',boxShadow:isActive||isHovered?'0 0 24px rgba(0, 229, 255, 1)':'none'}},id)]}),/*#__PURE__*/_jsx(\"div\",{style:{width:120,height:6,borderRadius:3,backgroundColor:isActive||isHovered?'#00e5ff':'#666',boxShadow:isActive||isHovered?'0 0 12px #00e5ff':'none',marginBottom:6,transition:'background-color 0.3s, box-shadow 0.3s',zIndex:1}}),/*#__PURE__*/_jsx(\"div\",{className:\"indicator-light\",style:{width:20,height:20,borderRadius:'50%',backgroundColor:isActive||isHovered?'#00e5ff':'#555',boxShadow:isActive||isHovered?'0 0 20px #00e5ff':'none',marginTop:6,transition:'background-color 0.3s, box-shadow 0.3s',zIndex:1}}),/*#__PURE__*/_jsx(\"div\",{style:{color:isActive?'#0ff':'#ccc',fontWeight:'bold',textAlign:'center',userSelect:'none',textShadow:isActive?'0 0 8px #0ff':'none',whiteSpace:'nowrap',fontSize:18,marginTop:12,zIndex:1},children:name})]},id);})})]}),/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:800,margin:'50px auto 0',padding:25,borderRadius:12,background:'transparent',backdropFilter:'blur(10px)',WebkitBackdropFilter:'blur(10px)',border:'1px solid rgba(0, 229, 255, 0.3)',boxShadow:'0 4px 30px rgba(0, 229, 255, 0.1)'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{color:'#00e5ff',marginBottom:20,fontSize:22,textAlign:'center',textShadow:'0 0 10px rgba(0, 229, 255, 0.5)'},children:\"\\u521B\\u5EFA\\u65B0\\u7BA1\\u5BB6\\u5F62\\u8C61\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,style:{display:'flex',flexDirection:'column',gap:18},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'white',display:'block',marginBottom:8,fontSize:16},children:\"\\u7BA1\\u5BB6\\u540D\\u79F0:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:butlerName,onChange:e=>setButlerName(e.target.value),placeholder:\"\\u8BF7\\u8F93\\u5165\\u7BA1\\u5BB6\\u540D\\u79F0\",style:{width:'100%',padding:12,borderRadius:6,border:'1px solid rgba(0, 229, 255, 0.5)',backgroundColor:'rgba(255, 255, 255, 0.05)',color:'white',fontSize:16,outline:'none',transition:'border-color 0.3s'},disabled:isProcessing,\"aria-required\":\"true\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'white',display:'block',marginBottom:8,fontSize:16},children:\"\\u4E0A\\u4F20MP4\\u89C6\\u9891:\"}),/*#__PURE__*/_jsxs(\"div\",{style:{border:'2px dashed rgba(0, 229, 255, 0.5)',borderRadius:6,padding:20,textAlign:'center',cursor:isProcessing?'not-allowed':'pointer',transition:'border-color 0.3s',position:'relative'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"video/mp4\",onChange:handleFileChange,style:{position:'absolute',top:0,left:0,width:'100%',height:'100%',opacity:0,cursor:isProcessing?'not-allowed':'pointer'},disabled:isProcessing,\"aria-required\":\"true\"}),/*#__PURE__*/_jsxs(\"div\",{style:{pointerEvents:'none'},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-upload\",style:{fontSize:24,color:'#00e5ff',marginBottom:10}}),/*#__PURE__*/_jsx(\"p\",{style:{color:'white',margin:0},children:selectedFile?\"\\u5DF2\\u9009\\u62E9: \".concat(selectedFile.name):'点击或拖拽MP4格式视频文件到此处'}),/*#__PURE__*/_jsx(\"p\",{style:{color:'rgba(255, 255, 255, 0.6)',fontSize:14,marginTop:5},children:\"\\u89C6\\u9891\\u683C\\u5F0F: MP4, \\u5EFA\\u8BAE\\u5206\\u8FA8\\u7387: 720x1280\"})]})]})]}),butlers.length>=4&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'white',display:'block',marginBottom:8,fontSize:16},children:\"\\u7BA1\\u5BB6\\u6570\\u91CF\\u5DF2\\u6EE14\\u4E2A\\uFF0C\\u60A8\\u53EF\\u4EE5\\u70B9\\u51FB\\u9009\\u62E9\\u66FF\\u6362\\u73B0\\u6709\\u7BA1\\u5BB6:\"}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',gap:12,flexWrap:'wrap'},children:butlers.map(_ref4=>{let{id,name}=_ref4;return/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>{if(!isProcessing)setReplaceButlerId(id);},disabled:isProcessing,style:{flex:'1 1 120px',padding:'10px 14px',borderRadius:6,border:id===replaceButlerId?'2px solid #00e5ff':'1px solid rgba(0, 229, 255, 0.5)',backgroundColor:id===replaceButlerId?'rgba(0, 229, 255, 0.3)':'transparent',color:'white',fontWeight:id===replaceButlerId?'bold':'normal',cursor:isProcessing?'not-allowed':'pointer',transition:'all 0.3s',userSelect:'none'},title:\"\\u70B9\\u51FB\\u66FF\\u6362\\u7BA1\\u5BB6 \".concat(name),children:[name,\" (\",id,\")\"]},id);})}),/*#__PURE__*/_jsx(\"p\",{style:{color:'rgba(255, 255, 255, 0.6)',fontSize:14,marginTop:5},children:\"\\u9009\\u62E9\\u540E\\u4E0A\\u4F20\\u5C06\\u66FF\\u6362\\u6B64\\u7BA1\\u5BB6\\uFF0C\\u672A\\u9009\\u62E9\\u5219\\u65B0\\u589E\\u7BA1\\u5BB6\\uFF08\\u7BA1\\u5BB6\\u6570\\u672A\\u6EE1\\u65F6\\u6709\\u6548\\uFF09\"})]}),uploadProgress>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{color:'white',marginBottom:5,fontSize:16},children:[\"\\u4E0A\\u4F20\\u8FDB\\u5EA6: \",uploadProgress,\"%\"]}),/*#__PURE__*/_jsx(\"div\",{style:{height:8,backgroundColor:'rgba(255, 255, 255, 0.1)',borderRadius:4,overflow:'hidden'},children:/*#__PURE__*/_jsx(\"div\",{style:{width:\"\".concat(uploadProgress,\"%\"),height:'100%',backgroundColor:'#00e5ff',transition:'width 0.3s ease',borderRadius:4}})})]}),statusMessage&&/*#__PURE__*/_jsx(\"div\",{style:{padding:12,borderRadius:6,backgroundColor:isProcessing?'rgba(0, 229, 255, 0.15)':statusMessage.includes('成功')?'rgba(40, 167, 69, 0.15)':'rgba(220, 53, 69, 0.15)',color:isProcessing?'#00e5ff':statusMessage.includes('成功')?'#28a745':'#dc3545',fontSize:16,lineHeight:1.5},children:statusMessage}),/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",style:{padding:'14px 20px',backgroundColor:'transparent',color:'white',border:'none',borderRadius:6,fontSize:18,fontWeight:'bold',cursor:isProcessing?'not-allowed':'pointer',transition:'all 0.3s',boxShadow:'0 0 15px rgba(0, 229, 255, 0.5)',position:'relative',overflow:'hidden'},disabled:isProcessing,children:[isProcessing?/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center'},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-spinner fa-spin\",style:{marginRight:10}}),\"\\u6B63\\u5728\\u5236\\u4F5C...\"]}):'开始制作管家形象',/*#__PURE__*/_jsx(\"span\",{style:{position:'absolute',top:'50%',left:'50%',width:300,height:300,backgroundColor:'rgba(255, 255, 255, 0.2)',borderRadius:'50%',transform:'translate(-50%, -50%) scale(0)',transition:'transform 0.5s ease',pointerEvents:'none'},className:isProcessing?'':'button-hover-effect'})]})]})]})]}),/*#__PURE__*/_jsx(\"style\",{children:\"\\n        @keyframes glossyFlow {\\n          0% {\\n            background-position: 0% 0%, 100% 100%;\\n          }\\n          100% {\\n            background-position: 100% 100%, 0% 0%;\\n          }\\n        }\\n        /* \\u6309\\u94AE\\u60AC\\u505C\\u6548\\u679C\\u52A8\\u753B */\\n        .button-hover-effect:hover {\\n          transform: translate(-50%, -50%) scale(1);\\n          opacity: 0;\\n        }\\n      \"})]});}","map":{"version":3,"names":["React","useState","useRef","useEffect","useButler","useRecorderContext","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","activateSoundSrc","getDynamicBackendUrl","serverUrls","savedUrls","localStorage","getItem","JSON","parse","e","console","error","apiBaseUrl","process","env","REACT_APP_BACKEND_URL","BACKEND_URL","log","handleStorageChange","key","window","location","reload","addEventListener","removeEventListener","ButlerShowcase","activeButlerId","butlers","addButler","setActiveButlerId","activateButler","videoRefs","activateAudioRef","hoveredId","setHoveredId","loading","setLoading","setError","butlerName","setButlerName","selectedFile","setSelectedFile","uploadProgress","setUploadProgress","statusMessage","setStatusMessage","isProcessing","setIsProcessing","replaceButlerId","setReplaceButlerId","fetchInitialButlers","response","fetch","concat","ok","Error","status","data","json","success","_data$butlers","length","err","activeVideo","current","load","play","catch","warn","forEach","_ref","id","src","video","isActive","videoSrcAbsolute","startsWith","URL","href","style","filter","muted","pause","currentTime","_ref2","isHovered","paused","transition","handleDoubleClick","method","headers","body","stringify","result","audio","message","handleFileChange","file","target","files","name","size","type","handleSubmit","preventDefault","trim","formData","FormData","append","uploadUrl","replace","Promise","resolve","reject","xhr","XMLHttpRequest","open","upload","onprogress","event","lengthComputable","percentCompleted","Math","round","loaded","total","onload","responseText","videoPreviewPathRaw","video_preview_path","videoSrc","newButler","butler_id","Date","now","toString","setTimeout","onerror","send","includes","children","ref","preload","color","textAlign","padding","backgroundColor","borderRadius","marginBottom","maxWidth","marginLeft","marginRight","className","fontFamily","minHeight","userSelect","position","margin","overflow","boxShadow","height","display","justifyContent","gap","flexWrap","map","_ref3","index","onMouseEnter","onMouseLeave","onDoubleClick","width","flexDirection","alignItems","cursor","transform","zIndex","opacity","pointerEvents","title","background","backdropFilter","WebkitBackdropFilter","border","inset","backgroundImage","backgroundSize","mixBlendMode","top","left","animation","alt","draggable","objectFit","el","autoPlay","loop","playsInline","onError","onPlay","marginTop","fontWeight","textShadow","whiteSpace","fontSize","onSubmit","value","onChange","placeholder","outline","disabled","accept","_ref4","onClick","flex","lineHeight"],"sources":["D:/XM/AI-Sphere-Butler/core/client/src/components/ButlerShowcase.jsx"],"sourcesContent":["// D:\\XM\\AI-Sphere-Butler\\core\\client\\src\\components\\ButlerShowcase.jsx\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { useButler } from './ButlersContext';\r\nimport { useRecorderContext } from '../contexts/RecorderProvider';\r\nconst activateSoundSrc = '/core/client/ai-butler/sounds/activate.mp3';\r\n\r\n// *** 修改开始：动态获取 BACKEND_URL ***\r\n// 1. 定义一个函数来获取当前的后端 URL\r\nconst getDynamicBackendUrl = () => {\r\n  let serverUrls = {};\r\n  try {\r\n    const savedUrls = localStorage.getItem('serverUrls');\r\n    if (savedUrls) {\r\n      serverUrls = JSON.parse(savedUrls);\r\n    }\r\n  } catch (e) {\r\n    console.error(\"ButlerShowcase: Failed to parse serverUrls from localStorage\", e);\r\n  }\r\n  // 优先使用 apiBaseUrl 配置项，如果没有则 fallback 到环境变量或默认值\r\n  // 你可以根据实际配置项名称调整 'apiBaseUrl'\r\n  return serverUrls.apiBaseUrl || process.env.REACT_APP_BACKEND_URL || 'http://localhost:6010';\r\n};\r\n\r\n// 2. 初始化 BACKEND_URL 常量\r\nlet BACKEND_URL = getDynamicBackendUrl();\r\nconsole.log('[ButlerShowcase] Initial BACKEND_URL:', BACKEND_URL);\r\n\r\n// 3. 监听 storage 事件，如果配置更新，重新加载页面以应用新 URL\r\n//    (这是一种简单直接的方式，确保所有使用到 URL 的地方都用最新的)\r\n//    如果需要更精细的控制（不刷新页面），需要修改更多组件逻辑来响应变化。\r\nuseEffect(() => {\r\n  const handleStorageChange = (e) => {\r\n    if (e.key === 'serverUrls') {\r\n      console.log('[ButlerShowcase] serverUrls changed in localStorage, reloading page...');\r\n      // 重新加载页面以确保新的 BACKEND_URL 生效\r\n      window.location.reload();\r\n    }\r\n  };\r\n\r\n  window.addEventListener('storage', handleStorageChange);\r\n  return () => window.removeEventListener('storage', handleStorageChange);\r\n}, []); // 空依赖数组，只在组件挂载时添加一次监听器\r\n\r\n// *** 修改结束 ***\r\n\r\nexport default function ButlerShowcase() {\r\n  const { activeButlerId, butlers, addButler, setActiveButlerId } = useButler();\r\n  const { activateButler } = useRecorderContext();\r\n  const videoRefs = useRef({});\r\n  const activateAudioRef = useRef(null);\r\n  const [hoveredId, setHoveredId] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  // 管家创建相关状态\r\n  const [butlerName, setButlerName] = useState('');\r\n  const [selectedFile, setSelectedFile] = useState(null);\r\n  const [uploadProgress, setUploadProgress] = useState(0);\r\n  const [statusMessage, setStatusMessage] = useState('');\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  // 替换管家的管家ID状态\r\n  const [replaceButlerId, setReplaceButlerId] = useState('');\r\n  // 页面初始化时从后端加载管家数据\r\n  useEffect(() => {\r\n    const fetchInitialButlers = async () => {\r\n      try {\r\n        console.log('[ButlerShowcase] 从后端加载初始管家数据...');\r\n        // *** 修改：使用动态 BACKEND_URL ***\r\n        const response = await fetch(`${BACKEND_URL}/api/butlers`);\r\n        if (!response.ok) throw new Error(`HTTP错误: ${response.status}`);\r\n        const data = await response.json();\r\n        if (data.success) {\r\n          // 关键日志：打印后端返回的管家数量\r\n          console.log('[ButlerShowcase] 后端返回管家总数:', data.butlers?.length || 0);\r\n          console.log('[ButlerShowcase] 后端返回的管家列表:', data.butlers);\r\n          if (data.butlers && data.butlers.length > 0 && data.activeButlerId) {\r\n            setActiveButlerId(data.activeButlerId);\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.error('[ButlerShowcase] 加载初始管家数据失败:', err);\r\n      }\r\n    };\r\n    fetchInitialButlers();\r\n  }, [setActiveButlerId]);\r\n  // 全局状态更新时刷新视频\r\n  useEffect(() => {\r\n    console.log('[ButlerShowcase] 全局activeButlerId更新为:', activeButlerId);\r\n    const activeVideo = videoRefs.current[activeButlerId];\r\n    if (activeVideo) {\r\n      activeVideo.load();\r\n      activeVideo.play().catch(e =>\r\n        console.warn(`播放视频 ${activeButlerId} 失败`, e)\r\n      );\r\n    }\r\n  }, [activeButlerId]);\r\n  // 初始化视频状态及激活亮灯动画控制\r\n  useEffect(() => {\r\n    butlers.forEach(({ id, src }) => {\r\n      const video = videoRefs.current[id];\r\n      if (!video) return;\r\n      const isActive = id === activeButlerId;\r\n      // 关键修复：生成完整的绝对路径（解决相对路径导致的404）\r\n      let videoSrcAbsolute;\r\n      try {\r\n        // 处理绝对路径和相对路径两种情况\r\n        if (src.startsWith('http://') || src.startsWith('https://')) {\r\n          videoSrcAbsolute = src;\r\n        } else {\r\n          // *** 修改：使用动态 BACKEND_URL 拼接 ***\r\n          videoSrcAbsolute = new URL(src, BACKEND_URL).href;\r\n        }\r\n        console.log(`[视频路径修复] 管家ID: ${id}, 原始路径: ${src}, 修正后路径: ${videoSrcAbsolute}`);\r\n      } catch (err) {\r\n        console.error(`[视频路径错误] 解析失败: ${src}`, err);\r\n        videoSrcAbsolute = src; // 失败时使用原始路径\r\n      }\r\n      // 仅在路径变化时更新，避免重复加载\r\n      if (video.src !== videoSrcAbsolute) {\r\n        video.src = videoSrcAbsolute;\r\n      }\r\n      // 原有状态逻辑\r\n      if (isActive) {\r\n        video.style.filter = 'none';\r\n        video.muted = false;\r\n      } else {\r\n        video.pause();\r\n        video.currentTime = 0;\r\n        video.style.filter = 'grayscale(100%) brightness(65%)';\r\n      }\r\n    });\r\n  }, [activeButlerId, butlers]); // *** 修改：移除 BACKEND_URL 依赖，因为它现在是模块级常量 ***\r\n  // 处理视频播放暂停并控制激活管家动画和亮灯，支持鼠标悬停亮灯动画\r\n  useEffect(() => {\r\n    butlers.forEach(({ id }) => {\r\n      const isActive = id === activeButlerId;\r\n      const isHovered = id === hoveredId;\r\n      const video = videoRefs.current[id];\r\n      if (!video) return;\r\n      if (isActive || isHovered) {\r\n        if (video.paused) {\r\n          video.play().catch(() => { });\r\n        }\r\n        video.style.filter = 'none';\r\n        video.style.transition = 'filter 0.3s ease';\r\n      } else {\r\n        if (!video.paused) {\r\n          video.pause();\r\n          video.currentTime = 0;\r\n        }\r\n        video.style.filter = 'grayscale(100%) brightness(65%)';\r\n        video.style.transition = 'filter 0.3s ease';\r\n      }\r\n    });\r\n  }, [hoveredId, activeButlerId, butlers]);\r\n  // 双击切换管家处理（添加后端同步）\r\n  async function handleDoubleClick(id) {\r\n    if (id === activeButlerId) {\r\n      console.log('[ButlerShowcase] 已激活该管家，无需切换');\r\n      return;\r\n    }\r\n    if (loading) return;\r\n    setLoading(true);\r\n    setError(null);\r\n    console.log('[ButlerShowcase] 尝试切换到管家:', id);\r\n    try {\r\n      // 1. 同步后端激活状态\r\n      console.log('[ButlerShowcase] 同步后端激活状态:', id);\r\n      // *** 修改：使用动态 BACKEND_URL ***\r\n      const response = await fetch(`${BACKEND_URL}/api/butlers/active`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ activeButlerId: id })\r\n      });\r\n      const result = await response.json();\r\n      if (!result.success) {\r\n        throw new Error(`更新激活状态失败: ${result.error || '未知错误'}`);\r\n      }\r\n      // 2. 调用原有激活逻辑\r\n      if (typeof activateButler !== 'function') {\r\n        throw new Error('activateButler未定义，请检查RecorderProvider');\r\n      }\r\n      await activateButler(id);\r\n      // 3. 更新本地状态\r\n      setActiveButlerId(id);\r\n      const audio = activateAudioRef.current;\r\n      if (audio) {\r\n        audio.currentTime = 0;\r\n        audio.play().catch(() => { });\r\n      }\r\n    } catch (err) {\r\n      console.error('[ButlerShowcase] 切换失败:', err);\r\n      setError(err.message || '切换失败，请重试');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n  // 处理文件选择\r\n  const handleFileChange = (e) => {\r\n    const file = e.target.files[0];\r\n    if (file) {\r\n      console.log('选中文件:', file.name, '大小:', file.size);\r\n      if (file.type !== 'video/mp4' || file.size === 0) {\r\n        setStatusMessage('请选择有效的MP4格式视频文件');\r\n        setSelectedFile(null);\r\n        return;\r\n      }\r\n      setSelectedFile(file);\r\n      setStatusMessage(`已选择文件: ${file.name}`);\r\n    }\r\n  };\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!butlerName.trim()) {\r\n      setStatusMessage('请输入管家名称');\r\n      return;\r\n    }\r\n    if (!selectedFile) {\r\n      setStatusMessage('请选择视频文件');\r\n      return;\r\n    }\r\n    setIsProcessing(true);\r\n    setStatusMessage('正在上传并制作管家形象...');\r\n    setUploadProgress(0);\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('name', butlerName.trim());\r\n      formData.append('video', selectedFile);\r\n      if (replaceButlerId) {\r\n        formData.append('replace_butler_id', replaceButlerId);\r\n      }\r\n      // *** 修改：使用动态 BACKEND_URL ***\r\n      const uploadUrl = `${BACKEND_URL.replace(/\\/$/, '')}/api/make_human?make_now=true`;\r\n      await new Promise((resolve, reject) => {\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open('POST', uploadUrl, true);\r\n        xhr.upload.onprogress = (event) => {\r\n          if (event.lengthComputable) {\r\n            const percentCompleted = Math.round((event.loaded * 100) / event.total);\r\n            setUploadProgress(percentCompleted);\r\n          }\r\n        };\r\n        xhr.onload = () => {\r\n          console.log('上传完成，状态码:', xhr.status);\r\n          console.log('响应:', xhr.responseText);\r\n          if (xhr.status >= 200 && xhr.status < 300) {\r\n            try {\r\n              const result = JSON.parse(xhr.responseText);\r\n              if (result.success) {\r\n                setStatusMessage(`制作成功！管家名称: ${butlerName}`);\r\n                if (typeof addButler === 'function') {\r\n                  const videoPreviewPathRaw = (result.video_preview_path || '').replace(/\\\\/g, '/').trim();\r\n                  let videoSrc = videoPreviewPathRaw;\r\n                  if (videoSrc && !videoSrc.startsWith('/')) {\r\n                    videoSrc = '/' + videoSrc;\r\n                  }\r\n                  // 修正路径，去掉开头的多余 \"/web\"\r\n                  videoSrc = videoSrc.replace(/^\\/core\\/client\\/web\\//, '/core/client/');\r\n                  if (!videoSrc) {\r\n                    // *** 修改：使用动态 BACKEND_URL 构造默认路径 ***\r\n                    videoSrc = `/core/server/virtual_human/wav2lip/${butlerName.trim()}.mp4`;\r\n                  }\r\n                  const newButler = {\r\n                    id: result.butler_id || Date.now().toString(),\r\n                    name: butlerName.trim(),\r\n                    type: 'video',\r\n                    src: videoSrc,\r\n                  };\r\n                  console.log('[上传完成] 新管家数据:', newButler, '替换管家ID:', replaceButlerId);\r\n                  addButler(newButler, replaceButlerId);\r\n                  setActiveButlerId(newButler.id);\r\n                  // 上传成功后从后端刷新最新数据\r\n                  setTimeout(async () => {\r\n                    try {\r\n                      // *** 修改：使用动态 BACKEND_URL ***\r\n                      const response = await fetch(`${BACKEND_URL}/api/butlers`);\r\n                      const data = await response.json();\r\n                      if (data.success && data.activeButlerId) {\r\n                        setActiveButlerId(data.activeButlerId);\r\n                      }\r\n                    } catch (err) {\r\n                      console.error('[ButlerShowcase] 上传后刷新激活状态失败:', err);\r\n                    }\r\n                  }, 1000);\r\n                }\r\n                setTimeout(() => {\r\n                  setButlerName('');\r\n                  setSelectedFile(null);\r\n                  setUploadProgress(0);\r\n                  setReplaceButlerId('');\r\n                }, 3000);\r\n                resolve();\r\n              } else {\r\n                setStatusMessage(`制作失败: ${result.error || result.message || '未知错误'}`);\r\n                reject(new Error(result.error || result.message || '未知错误'));\r\n              }\r\n            } catch (err) {\r\n              setStatusMessage('返回数据解析失败');\r\n              reject(err);\r\n            }\r\n          } else {\r\n            setStatusMessage(`上传失败，状态码: ${xhr.status}`);\r\n            reject(new Error(`上传失败，状态码: ${xhr.status}`));\r\n          }\r\n        };\r\n        xhr.onerror = () => {\r\n          console.error('上传请求失败');\r\n          setStatusMessage('上传请求失败，请检查网络连接');\r\n          reject(new Error('上传请求失败'));\r\n        };\r\n        xhr.send(formData);\r\n      });\r\n    } catch (error) {\r\n      console.error('上传失败', error);\r\n      if (!statusMessage.includes('失败')) {\r\n        setStatusMessage(`请求失败: ${error.message}`);\r\n      }\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n  return (\r\n    <>\r\n      <audio ref={activateAudioRef} src={activateSoundSrc} preload=\"auto\" />\r\n      {/* 错误提示 */}\r\n      {error && (\r\n        <div style={{\r\n          color: 'red',\r\n          textAlign: 'center',\r\n          padding: 10,\r\n          backgroundColor: 'rgba(255,0,0,0.1)',\r\n          borderRadius: 4,\r\n          marginBottom: 20,\r\n          maxWidth: 600,\r\n          marginLeft: 'auto',\r\n          marginRight: 'auto',\r\n        }}>\r\n          {error}\r\n        </div>\r\n      )}\r\n      <div\r\n        className=\"steward-gallery\"\r\n        style={{\r\n          fontFamily: 'Arial, sans-serif',\r\n          backgroundColor: 'transparent',\r\n          padding: 40,\r\n          minHeight: '100vh',\r\n          userSelect: 'none',\r\n        }}\r\n      >\r\n        <div\r\n          className=\"display-case\"\r\n          style={{\r\n            position: 'relative',\r\n            maxWidth: 1400, /* 扩大容器宽度，容纳更多管家 */\r\n            margin: '0 auto',\r\n            borderRadius: 8,\r\n            overflow: 'visible',\r\n            backgroundColor: 'transparent',\r\n            boxShadow: 'none',\r\n          }}\r\n        >\r\n          <div\r\n            className=\"case-top\"\r\n            style={{ height: 20, backgroundColor: 'transparent', boxShadow: 'none' }}\r\n          />\r\n          <div\r\n            className=\"case-bottom\"\r\n            style={{ height: 20, backgroundColor: 'transparent', boxShadow: 'none' }}\r\n          />\r\n          <div\r\n            className=\"stewards-container\"\r\n            style={{\r\n              display: 'flex',\r\n              justifyContent: 'center',\r\n              backgroundColor: 'transparent',\r\n              padding: '30px 0',\r\n              gap: 30, /* 关键修改：增加间距，避免重叠 */\r\n              flexWrap: 'wrap', /* 关键修改：自动换行，支持多管家 */\r\n            }}\r\n          >\r\n            {/* 关键修改：打印当前渲染的管家数量 */}\r\n            {console.log('[渲染] 管家数量:', butlers.length) || butlers.map(({ id, name, type, src }, index) => {\r\n              const isActive = id === activeButlerId;\r\n              const isHovered = id === hoveredId;\r\n              return (\r\n                <div\r\n                  key={id}\r\n                  className={`steward ${isActive ? 'active' : ''} ${isHovered ? 'hovered' : ''}`}\r\n                  onMouseEnter={() => {\r\n                    console.log(`[悬停] 管家 ${name} (${id})`);\r\n                    setHoveredId(id);\r\n                  }}\r\n                  onMouseLeave={() => {\r\n                    setHoveredId(null);\r\n                  }}\r\n                  onDoubleClick={() => {\r\n                    if (!loading) {\r\n                      console.log(`[双击] 激活管家 ${name} (${id})`);\r\n                      handleDoubleClick(id);\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    position: 'relative',\r\n                    width: 240,\r\n                    height: 480,\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    alignItems: 'center',\r\n                    cursor: loading && id !== activeButlerId ? 'not-allowed' : 'pointer',\r\n                    transition: 'transform 0.3s ease',\r\n                    transform: isHovered ? 'translateY(-10px)' : 'translateY(0)',\r\n                    userSelect: 'none',\r\n                    marginRight: 0, /* 关键修改：移除右侧margin，用gap控制间距 */\r\n                    zIndex: 1,\r\n                    opacity: loading && id !== activeButlerId ? 0.7 : 1,\r\n                    pointerEvents: 'auto',  // 保证事件总是能触发\r\n                  }}\r\n                  title={isActive ? `当前激活管家：${name}` : `双击切换到管家 ${name}`}\r\n                >\r\n                  <div\r\n                    className=\"glass-panel\"\r\n                    style={{\r\n                      width: 180,\r\n                      height: 340,\r\n                      borderRadius: 28,\r\n                      position: 'relative',\r\n                      padding: 2,\r\n                      background:\r\n                        'linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.03) 100%)',\r\n                      boxShadow: isActive\r\n                        ? '0 8px 50px rgba(0, 229, 255, 0.6), inset 0 0 80px rgba(255, 255, 255, 0.2)'\r\n                        : '0 8px 50px rgba(0, 229, 255, 0.4), inset 0 0 80px rgba(255, 255, 255, 0.15)',\r\n                      backdropFilter: 'blur(20px)',\r\n                      WebkitBackdropFilter: 'blur(20px)',\r\n                      border: '3px solid rgba(255, 255, 255, 0.45)',\r\n                      overflow: 'hidden',\r\n                      userSelect: 'none',\r\n                      filter: isActive\r\n                        ? 'drop-shadow(0 0 35px rgba(0,229,255,1))'\r\n                        : 'grayscale(100%) brightness(70%)',\r\n                      transition: 'all 0.3s ease',\r\n                      zIndex: 1,\r\n                    }}\r\n                  >\r\n                    <div\r\n                      style={{\r\n                        position: 'absolute',\r\n                        inset: 0,\r\n                        pointerEvents: 'none',\r\n                        borderRadius: 28,\r\n                        backgroundImage:\r\n                          'radial-gradient(rgba(255,255,255,0.15) 1.5px, transparent 1.5px)',\r\n                        backgroundSize: '7px 7px',\r\n                        mixBlendMode: 'overlay',\r\n                        zIndex: 5,\r\n                        opacity: 0.22,\r\n                      }}\r\n                    />\r\n                    <div\r\n                      className=\"glossy-edge\"\r\n                      style={{\r\n                        position: 'absolute',\r\n                        top: -40,\r\n                        left: -40,\r\n                        width: 260,\r\n                        height: 420,\r\n                        borderRadius: 40,\r\n                        pointerEvents: 'none',\r\n                        background:\r\n                          'radial-gradient(circle at 15% 30%, rgba(255,255,255,0.5), transparent 65%),' +\r\n                          'radial-gradient(circle at 85% 70%, rgba(255,255,255,0.35), transparent 70%)',\r\n                        filter: 'blur(18px)',\r\n                        opacity: 0.7,\r\n                        animation: 'glossyFlow 5.5s linear infinite',\r\n                        zIndex: 6,\r\n                      }}\r\n                    />\r\n                    {type === 'image' ? (\r\n                      <img\r\n                        src={src}\r\n                        alt={name}\r\n                        draggable={false}\r\n                        style={{\r\n                          width: '100%',\r\n                          height: '100%',\r\n                          objectFit: 'cover',\r\n                          borderRadius: 20,\r\n                          position: 'relative',\r\n                          zIndex: 10,\r\n                          boxShadow: isActive\r\n                            ? '0 0 24px rgba(0, 229, 255, 1)'\r\n                            : 'none',\r\n                          transition: 'box-shadow 0.3s ease',\r\n                          userSelect: 'none',\r\n                        }}\r\n                      />\r\n                    ) : (\r\n                      <video\r\n                        key={id}\r\n                        ref={(el) => {\r\n                          if (el) {\r\n                            videoRefs.current[id] = el;\r\n                            // 打印视频元素状态\r\n                            console.log(`[视频绑定] 管家 ${name} (${id}) 视频元素已绑定`, el);\r\n                          }\r\n                        }}\r\n                        src={src}\r\n                        autoPlay={false}\r\n                        loop\r\n                        muted\r\n                        playsInline\r\n                        preload=\"auto\"\r\n                        onError={() => {\r\n                          console.error(`[视频错误] 管家 ${name} (${id}) 视频加载失败，src: ${src}`);\r\n                          setStatusMessage(`管家【${name}】视频加载失败，请检查视频路径或网络。`);\r\n                        }}\r\n                        onPlay={() => {\r\n                          console.log(`[视频播放] 管家 ${name} (${id}) 视频开始播放`);\r\n                        }}\r\n                        style={{\r\n                          width: '100%',\r\n                          height: '100%',\r\n                          objectFit: 'cover',\r\n                          borderRadius: 20,\r\n                          position: 'relative',\r\n                          zIndex: 10,\r\n                          userSelect: 'none',\r\n                          pointerEvents: 'none', // 让事件穿透父元素\r\n                          filter: isActive || isHovered\r\n                            ? 'none'\r\n                            : 'grayscale(100%) brightness(70%)',\r\n                          transition: 'filter 0.3s ease',\r\n                          boxShadow: isActive || isHovered\r\n                            ? '0 0 24px rgba(0, 229, 255, 1)'\r\n                            : 'none',\r\n                        }}\r\n                      />\r\n                    )}\r\n                  </div>\r\n                  <div\r\n                    style={{\r\n                      width: 120,\r\n                      height: 6,\r\n                      borderRadius: 3,\r\n                      backgroundColor:\r\n                        isActive || isHovered ? '#00e5ff' : '#666',\r\n                      boxShadow:\r\n                        isActive || isHovered\r\n                          ? '0 0 12px #00e5ff'\r\n                          : 'none',\r\n                      marginBottom: 6,\r\n                      transition: 'background-color 0.3s, box-shadow 0.3s',\r\n                      zIndex: 1,\r\n                    }}\r\n                  />\r\n                  <div\r\n                    className=\"indicator-light\"\r\n                    style={{\r\n                      width: 20,\r\n                      height: 20,\r\n                      borderRadius: '50%',\r\n                      backgroundColor:\r\n                        isActive || isHovered ? '#00e5ff' : '#555',\r\n                      boxShadow:\r\n                        isActive || isHovered\r\n                          ? '0 0 20px #00e5ff'\r\n                          : 'none',\r\n                      marginTop: 6,\r\n                      transition: 'background-color 0.3s, box-shadow 0.3s',\r\n                      zIndex: 1,\r\n                    }}\r\n                  />\r\n                  <div\r\n                    style={{\r\n                      color: isActive ? '#0ff' : '#ccc',\r\n                      fontWeight: 'bold',\r\n                      textAlign: 'center',\r\n                      userSelect: 'none',\r\n                      textShadow: isActive ? '0 0 8px #0ff' : 'none',\r\n                      whiteSpace: 'nowrap',\r\n                      fontSize: 18,\r\n                      marginTop: 12,\r\n                      zIndex: 1,\r\n                    }}\r\n                  >\r\n                    {name}\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n        {/* 管家形象制作表单 */}\r\n        <div style={{\r\n          maxWidth: 800,\r\n          margin: '50px auto 0',\r\n          padding: 25,\r\n          borderRadius: 12,\r\n          background: 'transparent',\r\n          backdropFilter: 'blur(10px)',\r\n          WebkitBackdropFilter: 'blur(10px)',\r\n          border: '1px solid rgba(0, 229, 255, 0.3)',\r\n          boxShadow: '0 4px 30px rgba(0, 229, 255, 0.1)',\r\n        }}>\r\n          <h3 style={{\r\n            color: '#00e5ff',\r\n            marginBottom: 20,\r\n            fontSize: 22,\r\n            textAlign: 'center',\r\n            textShadow: '0 0 10px rgba(0, 229, 255, 0.5)'\r\n          }}>创建新管家形象</h3>\r\n          <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: 18 }}>\r\n            <div>\r\n              <label style={{ color: 'white', display: 'block', marginBottom: 8, fontSize: 16 }}>\r\n                管家名称:\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={butlerName}\r\n                onChange={(e) => setButlerName(e.target.value)}\r\n                placeholder=\"请输入管家名称\"\r\n                style={{\r\n                  width: '100%',\r\n                  padding: 12,\r\n                  borderRadius: 6,\r\n                  border: '1px solid rgba(0, 229, 255, 0.5)',\r\n                  backgroundColor: 'rgba(255, 255, 255, 0.05)',\r\n                  color: 'white',\r\n                  fontSize: 16,\r\n                  outline: 'none',\r\n                  transition: 'border-color 0.3s',\r\n                }}\r\n                disabled={isProcessing}\r\n                aria-required=\"true\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label style={{ color: 'white', display: 'block', marginBottom: 8, fontSize: 16 }}>\r\n                上传MP4视频:\r\n              </label>\r\n              <div style={{\r\n                border: '2px dashed rgba(0, 229, 255, 0.5)',\r\n                borderRadius: 6,\r\n                padding: 20,\r\n                textAlign: 'center',\r\n                cursor: isProcessing ? 'not-allowed' : 'pointer',\r\n                transition: 'border-color 0.3s',\r\n                position: 'relative',\r\n              }}>\r\n                <input\r\n                  type=\"file\"\r\n                  accept=\"video/mp4\"\r\n                  onChange={handleFileChange}\r\n                  style={{\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: 0,\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    opacity: 0,\r\n                    cursor: isProcessing ? 'not-allowed' : 'pointer'\r\n                  }}\r\n                  disabled={isProcessing}\r\n                  aria-required=\"true\"\r\n                />\r\n                <div style={{ pointerEvents: 'none' }}>\r\n                  <i className=\"fa fa-upload\" style={{ fontSize: 24, color: '#00e5ff', marginBottom: 10 }} />\r\n                  <p style={{ color: 'white', margin: 0 }}>\r\n                    {selectedFile\r\n                      ? `已选择: ${selectedFile.name}`\r\n                      : '点击或拖拽MP4格式视频文件到此处'}\r\n                  </p>\r\n                  <p style={{ color: 'rgba(255, 255, 255, 0.6)', fontSize: 14, marginTop: 5 }}>\r\n                    视频格式: MP4, 建议分辨率: 720x1280\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            {/* 替换已有管家选择 */}\r\n            {butlers.length >= 4 && (\r\n              <div>\r\n                <label style={{ color: 'white', display: 'block', marginBottom: 8, fontSize: 16 }}>\r\n                  管家数量已满4个，您可以点击选择替换现有管家:\r\n                </label>\r\n                <div style={{\r\n                  display: 'flex',\r\n                  gap: 12,\r\n                  flexWrap: 'wrap',\r\n                }}>\r\n                  {butlers.map(({ id, name }) => (\r\n                    <button\r\n                      key={id}\r\n                      type=\"button\"\r\n                      onClick={() => { if (!isProcessing) setReplaceButlerId(id); }}\r\n                      disabled={isProcessing}\r\n                      style={{\r\n                        flex: '1 1 120px',\r\n                        padding: '10px 14px',\r\n                        borderRadius: 6,\r\n                        border: id === replaceButlerId ? '2px solid #00e5ff' : '1px solid rgba(0, 229, 255, 0.5)',\r\n                        backgroundColor: id === replaceButlerId ? 'rgba(0, 229, 255, 0.3)' : 'transparent',\r\n                        color: 'white',\r\n                        fontWeight: id === replaceButlerId ? 'bold' : 'normal',\r\n                        cursor: isProcessing ? 'not-allowed' : 'pointer',\r\n                        transition: 'all 0.3s',\r\n                        userSelect: 'none',\r\n                      }}\r\n                      title={`点击替换管家 ${name}`}\r\n                    >\r\n                      {name} ({id})\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n                <p style={{ color: 'rgba(255, 255, 255, 0.6)', fontSize: 14, marginTop: 5 }}>\r\n                  选择后上传将替换此管家，未选择则新增管家（管家数未满时有效）\r\n                </p>\r\n              </div>\r\n            )}\r\n            {/* 上传进度条 */}\r\n            {uploadProgress > 0 && (\r\n              <div>\r\n                <div style={{ color: 'white', marginBottom: 5, fontSize: 16 }}>\r\n                  上传进度: {uploadProgress}%\r\n                </div>\r\n                <div style={{\r\n                  height: 8,\r\n                  backgroundColor: 'rgba(255, 255, 255, 0.1)',\r\n                  borderRadius: 4,\r\n                  overflow: 'hidden'\r\n                }}>\r\n                  <div\r\n                    style={{\r\n                      width: `${uploadProgress}%`,\r\n                      height: '100%',\r\n                      backgroundColor: '#00e5ff',\r\n                      transition: 'width 0.3s ease',\r\n                      borderRadius: 4,\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            )}\r\n            {/* 状态消息 */}\r\n            {statusMessage && (\r\n              <div style={{\r\n                padding: 12,\r\n                borderRadius: 6,\r\n                backgroundColor: isProcessing\r\n                  ? 'rgba(0, 229, 255, 0.15)'\r\n                  : statusMessage.includes('成功')\r\n                    ? 'rgba(40, 167, 69, 0.15)'\r\n                    : 'rgba(220, 53, 69, 0.15)',\r\n                color: isProcessing ? '#00e5ff' : statusMessage.includes('成功') ? '#28a745' : '#dc3545',\r\n                fontSize: 16,\r\n                lineHeight: 1.5,\r\n              }}>\r\n                {statusMessage}\r\n              </div>\r\n            )}\r\n            {/* 提交按钮 */}\r\n            <button\r\n              type=\"submit\"\r\n              style={{\r\n                padding: '14px 20px',\r\n                backgroundColor: 'transparent',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: 6,\r\n                fontSize: 18,\r\n                fontWeight: 'bold',\r\n                cursor: isProcessing ? 'not-allowed' : 'pointer',\r\n                transition: 'all 0.3s',\r\n                boxShadow: '0 0 15px rgba(0, 229, 255, 0.5)',\r\n                position: 'relative',\r\n                overflow: 'hidden',\r\n              }}\r\n              disabled={isProcessing}\r\n            >\r\n              {isProcessing\r\n                ? <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                  <i className=\"fa fa-spinner fa-spin\" style={{ marginRight: 10 }} />\r\n                  正在制作...\r\n                </div>\r\n                : '开始制作管家形象'}\r\n              <span style={{\r\n                position: 'absolute',\r\n                top: '50%',\r\n                left: '50%',\r\n                width: 300,\r\n                height: 300,\r\n                backgroundColor: 'rgba(255, 255, 255, 0.2)',\r\n                borderRadius: '50%',\r\n                transform: 'translate(-50%, -50%) scale(0)',\r\n                transition: 'transform 0.5s ease',\r\n                pointerEvents: 'none',\r\n              }}\r\n                className={isProcessing ? '' : 'button-hover-effect'}\r\n              />\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n      <style>{`\r\n        @keyframes glossyFlow {\r\n          0% {\r\n            background-position: 0% 0%, 100% 100%;\r\n          }\r\n          100% {\r\n            background-position: 100% 100%, 0% 0%;\r\n          }\r\n        }\r\n        /* 按钮悬停效果动画 */\r\n        .button-hover-effect:hover {\r\n          transform: translate(-50%, -50%) scale(1);\r\n          opacity: 0;\r\n        }\r\n      `}</style>\r\n    </>\r\n  );\r\n}"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,MAAM,CAAEC,SAAS,KAAQ,OAAO,CAC1D,OAASC,SAAS,KAAQ,kBAAkB,CAC5C,OAASC,kBAAkB,KAAQ,8BAA8B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAClE,KAAM,CAAAC,gBAAgB,CAAG,4CAA4C,CAErE;AACA;AACA,KAAM,CAAAC,oBAAoB,CAAGA,CAAA,GAAM,CACjC,GAAI,CAAAC,UAAU,CAAG,CAAC,CAAC,CACnB,GAAI,CACF,KAAM,CAAAC,SAAS,CAAGC,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,CACpD,GAAIF,SAAS,CAAE,CACbD,UAAU,CAAGI,IAAI,CAACC,KAAK,CAACJ,SAAS,CAAC,CACpC,CACF,CAAE,MAAOK,CAAC,CAAE,CACVC,OAAO,CAACC,KAAK,CAAC,8DAA8D,CAAEF,CAAC,CAAC,CAClF,CACA;AACA;AACA,MAAO,CAAAN,UAAU,CAACS,UAAU,EAAIC,OAAO,CAACC,GAAG,CAACC,qBAAqB,EAAI,uBAAuB,CAC9F,CAAC,CAED;AACA,GAAI,CAAAC,WAAW,CAAGd,oBAAoB,CAAC,CAAC,CACxCQ,OAAO,CAACO,GAAG,CAAC,uCAAuC,CAAED,WAAW,CAAC,CAEjE;AACA;AACA;AACAxB,SAAS,CAAC,IAAM,CACd,KAAM,CAAA0B,mBAAmB,CAAIT,CAAC,EAAK,CACjC,GAAIA,CAAC,CAACU,GAAG,GAAK,YAAY,CAAE,CAC1BT,OAAO,CAACO,GAAG,CAAC,wEAAwE,CAAC,CACrF;AACAG,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC,CAC1B,CACF,CAAC,CAEDF,MAAM,CAACG,gBAAgB,CAAC,SAAS,CAAEL,mBAAmB,CAAC,CACvD,MAAO,IAAME,MAAM,CAACI,mBAAmB,CAAC,SAAS,CAAEN,mBAAmB,CAAC,CACzE,CAAC,CAAE,EAAE,CAAC,CAAE;AAER;AAEA,cAAe,SAAS,CAAAO,cAAcA,CAAA,CAAG,CACvC,KAAM,CAAEC,cAAc,CAAEC,OAAO,CAAEC,SAAS,CAAEC,iBAAkB,CAAC,CAAGpC,SAAS,CAAC,CAAC,CAC7E,KAAM,CAAEqC,cAAe,CAAC,CAAGpC,kBAAkB,CAAC,CAAC,CAC/C,KAAM,CAAAqC,SAAS,CAAGxC,MAAM,CAAC,CAAC,CAAC,CAAC,CAC5B,KAAM,CAAAyC,gBAAgB,CAAGzC,MAAM,CAAC,IAAI,CAAC,CACrC,KAAM,CAAC0C,SAAS,CAAEC,YAAY,CAAC,CAAG5C,QAAQ,CAAC,IAAI,CAAC,CAChD,KAAM,CAAC6C,OAAO,CAAEC,UAAU,CAAC,CAAG9C,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACqB,KAAK,CAAE0B,QAAQ,CAAC,CAAG/C,QAAQ,CAAC,IAAI,CAAC,CACxC;AACA,KAAM,CAACgD,UAAU,CAAEC,aAAa,CAAC,CAAGjD,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAACkD,YAAY,CAAEC,eAAe,CAAC,CAAGnD,QAAQ,CAAC,IAAI,CAAC,CACtD,KAAM,CAACoD,cAAc,CAAEC,iBAAiB,CAAC,CAAGrD,QAAQ,CAAC,CAAC,CAAC,CACvD,KAAM,CAACsD,aAAa,CAAEC,gBAAgB,CAAC,CAAGvD,QAAQ,CAAC,EAAE,CAAC,CACtD,KAAM,CAACwD,YAAY,CAAEC,eAAe,CAAC,CAAGzD,QAAQ,CAAC,KAAK,CAAC,CACvD;AACA,KAAM,CAAC0D,eAAe,CAAEC,kBAAkB,CAAC,CAAG3D,QAAQ,CAAC,EAAE,CAAC,CAC1D;AACAE,SAAS,CAAC,IAAM,CACd,KAAM,CAAA0D,mBAAmB,CAAG,KAAAA,CAAA,GAAY,CACtC,GAAI,CACFxC,OAAO,CAACO,GAAG,CAAC,iCAAiC,CAAC,CAC9C;AACA,KAAM,CAAAkC,QAAQ,CAAG,KAAM,CAAAC,KAAK,IAAAC,MAAA,CAAIrC,WAAW,gBAAc,CAAC,CAC1D,GAAI,CAACmC,QAAQ,CAACG,EAAE,CAAE,KAAM,IAAI,CAAAC,KAAK,sBAAAF,MAAA,CAAYF,QAAQ,CAACK,MAAM,CAAE,CAAC,CAC/D,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAN,QAAQ,CAACO,IAAI,CAAC,CAAC,CAClC,GAAID,IAAI,CAACE,OAAO,CAAE,KAAAC,aAAA,CAChB;AACAlD,OAAO,CAACO,GAAG,CAAC,4BAA4B,CAAE,EAAA2C,aAAA,CAAAH,IAAI,CAAC9B,OAAO,UAAAiC,aAAA,iBAAZA,aAAA,CAAcC,MAAM,GAAI,CAAC,CAAC,CACpEnD,OAAO,CAACO,GAAG,CAAC,6BAA6B,CAAEwC,IAAI,CAAC9B,OAAO,CAAC,CACxD,GAAI8B,IAAI,CAAC9B,OAAO,EAAI8B,IAAI,CAAC9B,OAAO,CAACkC,MAAM,CAAG,CAAC,EAAIJ,IAAI,CAAC/B,cAAc,CAAE,CAClEG,iBAAiB,CAAC4B,IAAI,CAAC/B,cAAc,CAAC,CACxC,CACF,CACF,CAAE,MAAOoC,GAAG,CAAE,CACZpD,OAAO,CAACC,KAAK,CAAC,8BAA8B,CAAEmD,GAAG,CAAC,CACpD,CACF,CAAC,CACDZ,mBAAmB,CAAC,CAAC,CACvB,CAAC,CAAE,CAACrB,iBAAiB,CAAC,CAAC,CACvB;AACArC,SAAS,CAAC,IAAM,CACdkB,OAAO,CAACO,GAAG,CAAC,uCAAuC,CAAES,cAAc,CAAC,CACpE,KAAM,CAAAqC,WAAW,CAAGhC,SAAS,CAACiC,OAAO,CAACtC,cAAc,CAAC,CACrD,GAAIqC,WAAW,CAAE,CACfA,WAAW,CAACE,IAAI,CAAC,CAAC,CAClBF,WAAW,CAACG,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC1D,CAAC,EACxBC,OAAO,CAAC0D,IAAI,6BAAAf,MAAA,CAAS3B,cAAc,kBAAOjB,CAAC,CAC7C,CAAC,CACH,CACF,CAAC,CAAE,CAACiB,cAAc,CAAC,CAAC,CACpB;AACAlC,SAAS,CAAC,IAAM,CACdmC,OAAO,CAAC0C,OAAO,CAACC,IAAA,EAAiB,IAAhB,CAAEC,EAAE,CAAEC,GAAI,CAAC,CAAAF,IAAA,CAC1B,KAAM,CAAAG,KAAK,CAAG1C,SAAS,CAACiC,OAAO,CAACO,EAAE,CAAC,CACnC,GAAI,CAACE,KAAK,CAAE,OACZ,KAAM,CAAAC,QAAQ,CAAGH,EAAE,GAAK7C,cAAc,CACtC;AACA,GAAI,CAAAiD,gBAAgB,CACpB,GAAI,CACF;AACA,GAAIH,GAAG,CAACI,UAAU,CAAC,SAAS,CAAC,EAAIJ,GAAG,CAACI,UAAU,CAAC,UAAU,CAAC,CAAE,CAC3DD,gBAAgB,CAAGH,GAAG,CACxB,CAAC,IAAM,CACL;AACAG,gBAAgB,CAAG,GAAI,CAAAE,GAAG,CAACL,GAAG,CAAExD,WAAW,CAAC,CAAC8D,IAAI,CACnD,CACApE,OAAO,CAACO,GAAG,2DAAAoC,MAAA,CAAmBkB,EAAE,iCAAAlB,MAAA,CAAWmB,GAAG,uCAAAnB,MAAA,CAAYsB,gBAAgB,CAAE,CAAC,CAC/E,CAAE,MAAOb,GAAG,CAAE,CACZpD,OAAO,CAACC,KAAK,qEAAA0C,MAAA,CAAmBmB,GAAG,EAAIV,GAAG,CAAC,CAC3Ca,gBAAgB,CAAGH,GAAG,CAAE;AAC1B,CACA;AACA,GAAIC,KAAK,CAACD,GAAG,GAAKG,gBAAgB,CAAE,CAClCF,KAAK,CAACD,GAAG,CAAGG,gBAAgB,CAC9B,CACA;AACA,GAAID,QAAQ,CAAE,CACZD,KAAK,CAACM,KAAK,CAACC,MAAM,CAAG,MAAM,CAC3BP,KAAK,CAACQ,KAAK,CAAG,KAAK,CACrB,CAAC,IAAM,CACLR,KAAK,CAACS,KAAK,CAAC,CAAC,CACbT,KAAK,CAACU,WAAW,CAAG,CAAC,CACrBV,KAAK,CAACM,KAAK,CAACC,MAAM,CAAG,iCAAiC,CACxD,CACF,CAAC,CAAC,CACJ,CAAC,CAAE,CAACtD,cAAc,CAAEC,OAAO,CAAC,CAAC,CAAE;AAC/B;AACAnC,SAAS,CAAC,IAAM,CACdmC,OAAO,CAAC0C,OAAO,CAACe,KAAA,EAAY,IAAX,CAAEb,EAAG,CAAC,CAAAa,KAAA,CACrB,KAAM,CAAAV,QAAQ,CAAGH,EAAE,GAAK7C,cAAc,CACtC,KAAM,CAAA2D,SAAS,CAAGd,EAAE,GAAKtC,SAAS,CAClC,KAAM,CAAAwC,KAAK,CAAG1C,SAAS,CAACiC,OAAO,CAACO,EAAE,CAAC,CACnC,GAAI,CAACE,KAAK,CAAE,OACZ,GAAIC,QAAQ,EAAIW,SAAS,CAAE,CACzB,GAAIZ,KAAK,CAACa,MAAM,CAAE,CAChBb,KAAK,CAACP,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,IAAM,CAAE,CAAC,CAAC,CAC/B,CACAM,KAAK,CAACM,KAAK,CAACC,MAAM,CAAG,MAAM,CAC3BP,KAAK,CAACM,KAAK,CAACQ,UAAU,CAAG,kBAAkB,CAC7C,CAAC,IAAM,CACL,GAAI,CAACd,KAAK,CAACa,MAAM,CAAE,CACjBb,KAAK,CAACS,KAAK,CAAC,CAAC,CACbT,KAAK,CAACU,WAAW,CAAG,CAAC,CACvB,CACAV,KAAK,CAACM,KAAK,CAACC,MAAM,CAAG,iCAAiC,CACtDP,KAAK,CAACM,KAAK,CAACQ,UAAU,CAAG,kBAAkB,CAC7C,CACF,CAAC,CAAC,CACJ,CAAC,CAAE,CAACtD,SAAS,CAAEP,cAAc,CAAEC,OAAO,CAAC,CAAC,CACxC;AACA,cAAe,CAAA6D,iBAAiBA,CAACjB,EAAE,CAAE,CACnC,GAAIA,EAAE,GAAK7C,cAAc,CAAE,CACzBhB,OAAO,CAACO,GAAG,CAAC,8BAA8B,CAAC,CAC3C,OACF,CACA,GAAIkB,OAAO,CAAE,OACbC,UAAU,CAAC,IAAI,CAAC,CAChBC,QAAQ,CAAC,IAAI,CAAC,CACd3B,OAAO,CAACO,GAAG,CAAC,2BAA2B,CAAEsD,EAAE,CAAC,CAC5C,GAAI,CACF;AACA7D,OAAO,CAACO,GAAG,CAAC,4BAA4B,CAAEsD,EAAE,CAAC,CAC7C;AACA,KAAM,CAAApB,QAAQ,CAAG,KAAM,CAAAC,KAAK,IAAAC,MAAA,CAAIrC,WAAW,wBAAuB,CAChEyE,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAC/CC,IAAI,CAAEpF,IAAI,CAACqF,SAAS,CAAC,CAAElE,cAAc,CAAE6C,EAAG,CAAC,CAC7C,CAAC,CAAC,CACF,KAAM,CAAAsB,MAAM,CAAG,KAAM,CAAA1C,QAAQ,CAACO,IAAI,CAAC,CAAC,CACpC,GAAI,CAACmC,MAAM,CAAClC,OAAO,CAAE,CACnB,KAAM,IAAI,CAAAJ,KAAK,sDAAAF,MAAA,CAAcwC,MAAM,CAAClF,KAAK,EAAI,MAAM,CAAE,CAAC,CACxD,CACA;AACA,GAAI,MAAO,CAAAmB,cAAc,GAAK,UAAU,CAAE,CACxC,KAAM,IAAI,CAAAyB,KAAK,CAAC,uCAAuC,CAAC,CAC1D,CACA,KAAM,CAAAzB,cAAc,CAACyC,EAAE,CAAC,CACxB;AACA1C,iBAAiB,CAAC0C,EAAE,CAAC,CACrB,KAAM,CAAAuB,KAAK,CAAG9D,gBAAgB,CAACgC,OAAO,CACtC,GAAI8B,KAAK,CAAE,CACTA,KAAK,CAACX,WAAW,CAAG,CAAC,CACrBW,KAAK,CAAC5B,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,IAAM,CAAE,CAAC,CAAC,CAC/B,CACF,CAAE,MAAOL,GAAG,CAAE,CACZpD,OAAO,CAACC,KAAK,CAAC,wBAAwB,CAAEmD,GAAG,CAAC,CAC5CzB,QAAQ,CAACyB,GAAG,CAACiC,OAAO,EAAI,UAAU,CAAC,CACrC,CAAC,OAAS,CACR3D,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CACA;AACA,KAAM,CAAA4D,gBAAgB,CAAIvF,CAAC,EAAK,CAC9B,KAAM,CAAAwF,IAAI,CAAGxF,CAAC,CAACyF,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC,CAC9B,GAAIF,IAAI,CAAE,CACRvF,OAAO,CAACO,GAAG,CAAC,OAAO,CAAEgF,IAAI,CAACG,IAAI,CAAE,KAAK,CAAEH,IAAI,CAACI,IAAI,CAAC,CACjD,GAAIJ,IAAI,CAACK,IAAI,GAAK,WAAW,EAAIL,IAAI,CAACI,IAAI,GAAK,CAAC,CAAE,CAChDxD,gBAAgB,CAAC,iBAAiB,CAAC,CACnCJ,eAAe,CAAC,IAAI,CAAC,CACrB,OACF,CACAA,eAAe,CAACwD,IAAI,CAAC,CACrBpD,gBAAgB,oCAAAQ,MAAA,CAAW4C,IAAI,CAACG,IAAI,CAAE,CAAC,CACzC,CACF,CAAC,CACD,KAAM,CAAAG,YAAY,CAAG,KAAO,CAAA9F,CAAC,EAAK,CAChCA,CAAC,CAAC+F,cAAc,CAAC,CAAC,CAClB,GAAI,CAAClE,UAAU,CAACmE,IAAI,CAAC,CAAC,CAAE,CACtB5D,gBAAgB,CAAC,SAAS,CAAC,CAC3B,OACF,CACA,GAAI,CAACL,YAAY,CAAE,CACjBK,gBAAgB,CAAC,SAAS,CAAC,CAC3B,OACF,CACAE,eAAe,CAAC,IAAI,CAAC,CACrBF,gBAAgB,CAAC,gBAAgB,CAAC,CAClCF,iBAAiB,CAAC,CAAC,CAAC,CACpB,GAAI,CACF,KAAM,CAAA+D,QAAQ,CAAG,GAAI,CAAAC,QAAQ,CAAC,CAAC,CAC/BD,QAAQ,CAACE,MAAM,CAAC,MAAM,CAAEtE,UAAU,CAACmE,IAAI,CAAC,CAAC,CAAC,CAC1CC,QAAQ,CAACE,MAAM,CAAC,OAAO,CAAEpE,YAAY,CAAC,CACtC,GAAIQ,eAAe,CAAE,CACnB0D,QAAQ,CAACE,MAAM,CAAC,mBAAmB,CAAE5D,eAAe,CAAC,CACvD,CACA;AACA,KAAM,CAAA6D,SAAS,IAAAxD,MAAA,CAAMrC,WAAW,CAAC8F,OAAO,CAAC,KAAK,CAAE,EAAE,CAAC,iCAA+B,CAClF,KAAM,IAAI,CAAAC,OAAO,CAAC,CAACC,OAAO,CAAEC,MAAM,GAAK,CACrC,KAAM,CAAAC,GAAG,CAAG,GAAI,CAAAC,cAAc,CAAC,CAAC,CAChCD,GAAG,CAACE,IAAI,CAAC,MAAM,CAAEP,SAAS,CAAE,IAAI,CAAC,CACjCK,GAAG,CAACG,MAAM,CAACC,UAAU,CAAIC,KAAK,EAAK,CACjC,GAAIA,KAAK,CAACC,gBAAgB,CAAE,CAC1B,KAAM,CAAAC,gBAAgB,CAAGC,IAAI,CAACC,KAAK,CAAEJ,KAAK,CAACK,MAAM,CAAG,GAAG,CAAIL,KAAK,CAACM,KAAK,CAAC,CACvElF,iBAAiB,CAAC8E,gBAAgB,CAAC,CACrC,CACF,CAAC,CACDP,GAAG,CAACY,MAAM,CAAG,IAAM,CACjBpH,OAAO,CAACO,GAAG,CAAC,WAAW,CAAEiG,GAAG,CAAC1D,MAAM,CAAC,CACpC9C,OAAO,CAACO,GAAG,CAAC,KAAK,CAAEiG,GAAG,CAACa,YAAY,CAAC,CACpC,GAAIb,GAAG,CAAC1D,MAAM,EAAI,GAAG,EAAI0D,GAAG,CAAC1D,MAAM,CAAG,GAAG,CAAE,CACzC,GAAI,CACF,KAAM,CAAAqC,MAAM,CAAGtF,IAAI,CAACC,KAAK,CAAC0G,GAAG,CAACa,YAAY,CAAC,CAC3C,GAAIlC,MAAM,CAAClC,OAAO,CAAE,CAClBd,gBAAgB,4DAAAQ,MAAA,CAAef,UAAU,CAAE,CAAC,CAC5C,GAAI,MAAO,CAAAV,SAAS,GAAK,UAAU,CAAE,CACnC,KAAM,CAAAoG,mBAAmB,CAAG,CAACnC,MAAM,CAACoC,kBAAkB,EAAI,EAAE,EAAEnB,OAAO,CAAC,KAAK,CAAE,GAAG,CAAC,CAACL,IAAI,CAAC,CAAC,CACxF,GAAI,CAAAyB,QAAQ,CAAGF,mBAAmB,CAClC,GAAIE,QAAQ,EAAI,CAACA,QAAQ,CAACtD,UAAU,CAAC,GAAG,CAAC,CAAE,CACzCsD,QAAQ,CAAG,GAAG,CAAGA,QAAQ,CAC3B,CACA;AACAA,QAAQ,CAAGA,QAAQ,CAACpB,OAAO,CAAC,wBAAwB,CAAE,eAAe,CAAC,CACtE,GAAI,CAACoB,QAAQ,CAAE,CACb;AACAA,QAAQ,uCAAA7E,MAAA,CAAyCf,UAAU,CAACmE,IAAI,CAAC,CAAC,QAAM,CAC1E,CACA,KAAM,CAAA0B,SAAS,CAAG,CAChB5D,EAAE,CAAEsB,MAAM,CAACuC,SAAS,EAAIC,IAAI,CAACC,GAAG,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAC7CnC,IAAI,CAAE9D,UAAU,CAACmE,IAAI,CAAC,CAAC,CACvBH,IAAI,CAAE,OAAO,CACb9B,GAAG,CAAE0D,QACP,CAAC,CACDxH,OAAO,CAACO,GAAG,CAAC,eAAe,CAAEkH,SAAS,CAAE,SAAS,CAAEnF,eAAe,CAAC,CACnEpB,SAAS,CAACuG,SAAS,CAAEnF,eAAe,CAAC,CACrCnB,iBAAiB,CAACsG,SAAS,CAAC5D,EAAE,CAAC,CAC/B;AACAiE,UAAU,CAAC,SAAY,CACrB,GAAI,CACF;AACA,KAAM,CAAArF,QAAQ,CAAG,KAAM,CAAAC,KAAK,IAAAC,MAAA,CAAIrC,WAAW,gBAAc,CAAC,CAC1D,KAAM,CAAAyC,IAAI,CAAG,KAAM,CAAAN,QAAQ,CAACO,IAAI,CAAC,CAAC,CAClC,GAAID,IAAI,CAACE,OAAO,EAAIF,IAAI,CAAC/B,cAAc,CAAE,CACvCG,iBAAiB,CAAC4B,IAAI,CAAC/B,cAAc,CAAC,CACxC,CACF,CAAE,MAAOoC,GAAG,CAAE,CACZpD,OAAO,CAACC,KAAK,CAAC,+BAA+B,CAAEmD,GAAG,CAAC,CACrD,CACF,CAAC,CAAE,IAAI,CAAC,CACV,CACA0E,UAAU,CAAC,IAAM,CACfjG,aAAa,CAAC,EAAE,CAAC,CACjBE,eAAe,CAAC,IAAI,CAAC,CACrBE,iBAAiB,CAAC,CAAC,CAAC,CACpBM,kBAAkB,CAAC,EAAE,CAAC,CACxB,CAAC,CAAE,IAAI,CAAC,CACR+D,OAAO,CAAC,CAAC,CACX,CAAC,IAAM,CACLnE,gBAAgB,8BAAAQ,MAAA,CAAUwC,MAAM,CAAClF,KAAK,EAAIkF,MAAM,CAACE,OAAO,EAAI,MAAM,CAAE,CAAC,CACrEkB,MAAM,CAAC,GAAI,CAAA1D,KAAK,CAACsC,MAAM,CAAClF,KAAK,EAAIkF,MAAM,CAACE,OAAO,EAAI,MAAM,CAAC,CAAC,CAC7D,CACF,CAAE,MAAOjC,GAAG,CAAE,CACZjB,gBAAgB,CAAC,UAAU,CAAC,CAC5BoE,MAAM,CAACnD,GAAG,CAAC,CACb,CACF,CAAC,IAAM,CACLjB,gBAAgB,sDAAAQ,MAAA,CAAc6D,GAAG,CAAC1D,MAAM,CAAE,CAAC,CAC3CyD,MAAM,CAAC,GAAI,CAAA1D,KAAK,sDAAAF,MAAA,CAAc6D,GAAG,CAAC1D,MAAM,CAAE,CAAC,CAAC,CAC9C,CACF,CAAC,CACD0D,GAAG,CAACuB,OAAO,CAAG,IAAM,CAClB/H,OAAO,CAACC,KAAK,CAAC,QAAQ,CAAC,CACvBkC,gBAAgB,CAAC,gBAAgB,CAAC,CAClCoE,MAAM,CAAC,GAAI,CAAA1D,KAAK,CAAC,QAAQ,CAAC,CAAC,CAC7B,CAAC,CACD2D,GAAG,CAACwB,IAAI,CAAChC,QAAQ,CAAC,CACpB,CAAC,CAAC,CACJ,CAAE,MAAO/F,KAAK,CAAE,CACdD,OAAO,CAACC,KAAK,CAAC,MAAM,CAAEA,KAAK,CAAC,CAC5B,GAAI,CAACiC,aAAa,CAAC+F,QAAQ,CAAC,IAAI,CAAC,CAAE,CACjC9F,gBAAgB,8BAAAQ,MAAA,CAAU1C,KAAK,CAACoF,OAAO,CAAE,CAAC,CAC5C,CACF,CAAC,OAAS,CACRhD,eAAe,CAAC,KAAK,CAAC,CACxB,CACF,CAAC,CACD,mBACEjD,KAAA,CAAAE,SAAA,EAAA4I,QAAA,eACEhJ,IAAA,UAAOiJ,GAAG,CAAE7G,gBAAiB,CAACwC,GAAG,CAAEvE,gBAAiB,CAAC6I,OAAO,CAAC,MAAM,CAAE,CAAC,CAErEnI,KAAK,eACJf,IAAA,QAAKmF,KAAK,CAAE,CACVgE,KAAK,CAAE,KAAK,CACZC,SAAS,CAAE,QAAQ,CACnBC,OAAO,CAAE,EAAE,CACXC,eAAe,CAAE,mBAAmB,CACpCC,YAAY,CAAE,CAAC,CACfC,YAAY,CAAE,EAAE,CAChBC,QAAQ,CAAE,GAAG,CACbC,UAAU,CAAE,MAAM,CAClBC,WAAW,CAAE,MACf,CAAE,CAAAX,QAAA,CACCjI,KAAK,CACH,CACN,cACDb,KAAA,QACE0J,SAAS,CAAC,iBAAiB,CAC3BzE,KAAK,CAAE,CACL0E,UAAU,CAAE,mBAAmB,CAC/BP,eAAe,CAAE,aAAa,CAC9BD,OAAO,CAAE,EAAE,CACXS,SAAS,CAAE,OAAO,CAClBC,UAAU,CAAE,MACd,CAAE,CAAAf,QAAA,eAEF9I,KAAA,QACE0J,SAAS,CAAC,cAAc,CACxBzE,KAAK,CAAE,CACL6E,QAAQ,CAAE,UAAU,CACpBP,QAAQ,CAAE,IAAI,CAAE,mBAChBQ,MAAM,CAAE,QAAQ,CAChBV,YAAY,CAAE,CAAC,CACfW,QAAQ,CAAE,SAAS,CACnBZ,eAAe,CAAE,aAAa,CAC9Ba,SAAS,CAAE,MACb,CAAE,CAAAnB,QAAA,eAEFhJ,IAAA,QACE4J,SAAS,CAAC,UAAU,CACpBzE,KAAK,CAAE,CAAEiF,MAAM,CAAE,EAAE,CAAEd,eAAe,CAAE,aAAa,CAAEa,SAAS,CAAE,MAAO,CAAE,CAC1E,CAAC,cACFnK,IAAA,QACE4J,SAAS,CAAC,aAAa,CACvBzE,KAAK,CAAE,CAAEiF,MAAM,CAAE,EAAE,CAAEd,eAAe,CAAE,aAAa,CAAEa,SAAS,CAAE,MAAO,CAAE,CAC1E,CAAC,cACFnK,IAAA,QACE4J,SAAS,CAAC,oBAAoB,CAC9BzE,KAAK,CAAE,CACLkF,OAAO,CAAE,MAAM,CACfC,cAAc,CAAE,QAAQ,CACxBhB,eAAe,CAAE,aAAa,CAC9BD,OAAO,CAAE,QAAQ,CACjBkB,GAAG,CAAE,EAAE,CAAE,oBACTC,QAAQ,CAAE,MAAQ,qBACpB,CAAE,CAAAxB,QAAA,CAGDlI,OAAO,CAACO,GAAG,CAAC,YAAY,CAAEU,OAAO,CAACkC,MAAM,CAAC,EAAIlC,OAAO,CAAC0I,GAAG,CAAC,CAAAC,KAAA,CAA0BC,KAAK,GAAK,IAAnC,CAAEhG,EAAE,CAAE6B,IAAI,CAAEE,IAAI,CAAE9B,GAAI,CAAC,CAAA8F,KAAA,CAChF,KAAM,CAAA5F,QAAQ,CAAGH,EAAE,GAAK7C,cAAc,CACtC,KAAM,CAAA2D,SAAS,CAAGd,EAAE,GAAKtC,SAAS,CAClC,mBACEnC,KAAA,QAEE0J,SAAS,YAAAnG,MAAA,CAAaqB,QAAQ,CAAG,QAAQ,CAAG,EAAE,MAAArB,MAAA,CAAIgC,SAAS,CAAG,SAAS,CAAG,EAAE,CAAG,CAC/EmF,YAAY,CAAEA,CAAA,GAAM,CAClB9J,OAAO,CAACO,GAAG,gCAAAoC,MAAA,CAAY+C,IAAI,OAAA/C,MAAA,CAAKkB,EAAE,KAAG,CAAC,CACtCrC,YAAY,CAACqC,EAAE,CAAC,CAClB,CAAE,CACFkG,YAAY,CAAEA,CAAA,GAAM,CAClBvI,YAAY,CAAC,IAAI,CAAC,CACpB,CAAE,CACFwI,aAAa,CAAEA,CAAA,GAAM,CACnB,GAAI,CAACvI,OAAO,CAAE,CACZzB,OAAO,CAACO,GAAG,4CAAAoC,MAAA,CAAc+C,IAAI,OAAA/C,MAAA,CAAKkB,EAAE,KAAG,CAAC,CACxCiB,iBAAiB,CAACjB,EAAE,CAAC,CACvB,CACF,CAAE,CACFQ,KAAK,CAAE,CACL6E,QAAQ,CAAE,UAAU,CACpBe,KAAK,CAAE,GAAG,CACVX,MAAM,CAAE,GAAG,CACXC,OAAO,CAAE,MAAM,CACfW,aAAa,CAAE,QAAQ,CACvBC,UAAU,CAAE,QAAQ,CACpBC,MAAM,CAAE3I,OAAO,EAAIoC,EAAE,GAAK7C,cAAc,CAAG,aAAa,CAAG,SAAS,CACpE6D,UAAU,CAAE,qBAAqB,CACjCwF,SAAS,CAAE1F,SAAS,CAAG,mBAAmB,CAAG,eAAe,CAC5DsE,UAAU,CAAE,MAAM,CAClBJ,WAAW,CAAE,CAAC,CAAE,8BAChByB,MAAM,CAAE,CAAC,CACTC,OAAO,CAAE9I,OAAO,EAAIoC,EAAE,GAAK7C,cAAc,CAAG,GAAG,CAAG,CAAC,CACnDwJ,aAAa,CAAE,MAAS;AAC1B,CAAE,CACFC,KAAK,CAAEzG,QAAQ,8CAAArB,MAAA,CAAa+C,IAAI,gDAAA/C,MAAA,CAAgB+C,IAAI,CAAG,CAAAwC,QAAA,eAEvD9I,KAAA,QACE0J,SAAS,CAAC,aAAa,CACvBzE,KAAK,CAAE,CACL4F,KAAK,CAAE,GAAG,CACVX,MAAM,CAAE,GAAG,CACXb,YAAY,CAAE,EAAE,CAChBS,QAAQ,CAAE,UAAU,CACpBX,OAAO,CAAE,CAAC,CACVmC,UAAU,CACR,iFAAiF,CACnFrB,SAAS,CAAErF,QAAQ,CACf,4EAA4E,CAC5E,6EAA6E,CACjF2G,cAAc,CAAE,YAAY,CAC5BC,oBAAoB,CAAE,YAAY,CAClCC,MAAM,CAAE,qCAAqC,CAC7CzB,QAAQ,CAAE,QAAQ,CAClBH,UAAU,CAAE,MAAM,CAClB3E,MAAM,CAAEN,QAAQ,CACZ,yCAAyC,CACzC,iCAAiC,CACrCa,UAAU,CAAE,eAAe,CAC3ByF,MAAM,CAAE,CACV,CAAE,CAAApC,QAAA,eAEFhJ,IAAA,QACEmF,KAAK,CAAE,CACL6E,QAAQ,CAAE,UAAU,CACpB4B,KAAK,CAAE,CAAC,CACRN,aAAa,CAAE,MAAM,CACrB/B,YAAY,CAAE,EAAE,CAChBsC,eAAe,CACb,kEAAkE,CACpEC,cAAc,CAAE,SAAS,CACzBC,YAAY,CAAE,SAAS,CACvBX,MAAM,CAAE,CAAC,CACTC,OAAO,CAAE,IACX,CAAE,CACH,CAAC,cACFrL,IAAA,QACE4J,SAAS,CAAC,aAAa,CACvBzE,KAAK,CAAE,CACL6E,QAAQ,CAAE,UAAU,CACpBgC,GAAG,CAAE,CAAC,EAAE,CACRC,IAAI,CAAE,CAAC,EAAE,CACTlB,KAAK,CAAE,GAAG,CACVX,MAAM,CAAE,GAAG,CACXb,YAAY,CAAE,EAAE,CAChB+B,aAAa,CAAE,MAAM,CACrBE,UAAU,CACR,6EAA6E,CAC7E,6EAA6E,CAC/EpG,MAAM,CAAE,YAAY,CACpBiG,OAAO,CAAE,GAAG,CACZa,SAAS,CAAE,iCAAiC,CAC5Cd,MAAM,CAAE,CACV,CAAE,CACH,CAAC,CACD1E,IAAI,GAAK,OAAO,cACf1G,IAAA,QACE4E,GAAG,CAAEA,GAAI,CACTuH,GAAG,CAAE3F,IAAK,CACV4F,SAAS,CAAE,KAAM,CACjBjH,KAAK,CAAE,CACL4F,KAAK,CAAE,MAAM,CACbX,MAAM,CAAE,MAAM,CACdiC,SAAS,CAAE,OAAO,CAClB9C,YAAY,CAAE,EAAE,CAChBS,QAAQ,CAAE,UAAU,CACpBoB,MAAM,CAAE,EAAE,CACVjB,SAAS,CAAErF,QAAQ,CACf,+BAA+B,CAC/B,MAAM,CACVa,UAAU,CAAE,sBAAsB,CAClCoE,UAAU,CAAE,MACd,CAAE,CACH,CAAC,cAEF/J,IAAA,UAEEiJ,GAAG,CAAGqD,EAAE,EAAK,CACX,GAAIA,EAAE,CAAE,CACNnK,SAAS,CAACiC,OAAO,CAACO,EAAE,CAAC,CAAG2H,EAAE,CAC1B;AACAxL,OAAO,CAACO,GAAG,4CAAAoC,MAAA,CAAc+C,IAAI,OAAA/C,MAAA,CAAKkB,EAAE,iDAAa2H,EAAE,CAAC,CACtD,CACF,CAAE,CACF1H,GAAG,CAAEA,GAAI,CACT2H,QAAQ,CAAE,KAAM,CAChBC,IAAI,MACJnH,KAAK,MACLoH,WAAW,MACXvD,OAAO,CAAC,MAAM,CACdwD,OAAO,CAAEA,CAAA,GAAM,CACb5L,OAAO,CAACC,KAAK,4CAAA0C,MAAA,CAAc+C,IAAI,OAAA/C,MAAA,CAAKkB,EAAE,sDAAAlB,MAAA,CAAiBmB,GAAG,CAAE,CAAC,CAC7D3B,gBAAgB,sBAAAQ,MAAA,CAAO+C,IAAI,sHAAqB,CAAC,CACnD,CAAE,CACFmG,MAAM,CAAEA,CAAA,GAAM,CACZ7L,OAAO,CAACO,GAAG,4CAAAoC,MAAA,CAAc+C,IAAI,OAAA/C,MAAA,CAAKkB,EAAE,0CAAU,CAAC,CACjD,CAAE,CACFQ,KAAK,CAAE,CACL4F,KAAK,CAAE,MAAM,CACbX,MAAM,CAAE,MAAM,CACdiC,SAAS,CAAE,OAAO,CAClB9C,YAAY,CAAE,EAAE,CAChBS,QAAQ,CAAE,UAAU,CACpBoB,MAAM,CAAE,EAAE,CACVrB,UAAU,CAAE,MAAM,CAClBuB,aAAa,CAAE,MAAM,CAAE;AACvBlG,MAAM,CAAEN,QAAQ,EAAIW,SAAS,CACzB,MAAM,CACN,iCAAiC,CACrCE,UAAU,CAAE,kBAAkB,CAC9BwE,SAAS,CAAErF,QAAQ,EAAIW,SAAS,CAC5B,+BAA+B,CAC/B,MACN,CAAE,EArCGd,EAsCN,CACF,EACE,CAAC,cACN3E,IAAA,QACEmF,KAAK,CAAE,CACL4F,KAAK,CAAE,GAAG,CACVX,MAAM,CAAE,CAAC,CACTb,YAAY,CAAE,CAAC,CACfD,eAAe,CACbxE,QAAQ,EAAIW,SAAS,CAAG,SAAS,CAAG,MAAM,CAC5C0E,SAAS,CACPrF,QAAQ,EAAIW,SAAS,CACjB,kBAAkB,CAClB,MAAM,CACZ+D,YAAY,CAAE,CAAC,CACf7D,UAAU,CAAE,wCAAwC,CACpDyF,MAAM,CAAE,CACV,CAAE,CACH,CAAC,cACFpL,IAAA,QACE4J,SAAS,CAAC,iBAAiB,CAC3BzE,KAAK,CAAE,CACL4F,KAAK,CAAE,EAAE,CACTX,MAAM,CAAE,EAAE,CACVb,YAAY,CAAE,KAAK,CACnBD,eAAe,CACbxE,QAAQ,EAAIW,SAAS,CAAG,SAAS,CAAG,MAAM,CAC5C0E,SAAS,CACPrF,QAAQ,EAAIW,SAAS,CACjB,kBAAkB,CAClB,MAAM,CACZmH,SAAS,CAAE,CAAC,CACZjH,UAAU,CAAE,wCAAwC,CACpDyF,MAAM,CAAE,CACV,CAAE,CACH,CAAC,cACFpL,IAAA,QACEmF,KAAK,CAAE,CACLgE,KAAK,CAAErE,QAAQ,CAAG,MAAM,CAAG,MAAM,CACjC+H,UAAU,CAAE,MAAM,CAClBzD,SAAS,CAAE,QAAQ,CACnBW,UAAU,CAAE,MAAM,CAClB+C,UAAU,CAAEhI,QAAQ,CAAG,cAAc,CAAG,MAAM,CAC9CiI,UAAU,CAAE,QAAQ,CACpBC,QAAQ,CAAE,EAAE,CACZJ,SAAS,CAAE,EAAE,CACbxB,MAAM,CAAE,CACV,CAAE,CAAApC,QAAA,CAEDxC,IAAI,CACF,CAAC,GAxMD7B,EAyMF,CAAC,CAEV,CAAC,CAAC,CACC,CAAC,EACH,CAAC,cAENzE,KAAA,QAAKiF,KAAK,CAAE,CACVsE,QAAQ,CAAE,GAAG,CACbQ,MAAM,CAAE,aAAa,CACrBZ,OAAO,CAAE,EAAE,CACXE,YAAY,CAAE,EAAE,CAChBiC,UAAU,CAAE,aAAa,CACzBC,cAAc,CAAE,YAAY,CAC5BC,oBAAoB,CAAE,YAAY,CAClCC,MAAM,CAAE,kCAAkC,CAC1CxB,SAAS,CAAE,mCACb,CAAE,CAAAnB,QAAA,eACAhJ,IAAA,OAAImF,KAAK,CAAE,CACTgE,KAAK,CAAE,SAAS,CAChBK,YAAY,CAAE,EAAE,CAChBwD,QAAQ,CAAE,EAAE,CACZ5D,SAAS,CAAE,QAAQ,CACnB0D,UAAU,CAAE,iCACd,CAAE,CAAA9D,QAAA,CAAC,4CAAO,CAAI,CAAC,cACf9I,KAAA,SAAM+M,QAAQ,CAAEtG,YAAa,CAACxB,KAAK,CAAE,CAAEkF,OAAO,CAAE,MAAM,CAAEW,aAAa,CAAE,QAAQ,CAAET,GAAG,CAAE,EAAG,CAAE,CAAAvB,QAAA,eACzF9I,KAAA,QAAA8I,QAAA,eACEhJ,IAAA,UAAOmF,KAAK,CAAE,CAAEgE,KAAK,CAAE,OAAO,CAAEkB,OAAO,CAAE,OAAO,CAAEb,YAAY,CAAE,CAAC,CAAEwD,QAAQ,CAAE,EAAG,CAAE,CAAAhE,QAAA,CAAC,2BAEnF,CAAO,CAAC,cACRhJ,IAAA,UACE0G,IAAI,CAAC,MAAM,CACXwG,KAAK,CAAExK,UAAW,CAClByK,QAAQ,CAAGtM,CAAC,EAAK8B,aAAa,CAAC9B,CAAC,CAACyF,MAAM,CAAC4G,KAAK,CAAE,CAC/CE,WAAW,CAAC,4CAAS,CACrBjI,KAAK,CAAE,CACL4F,KAAK,CAAE,MAAM,CACb1B,OAAO,CAAE,EAAE,CACXE,YAAY,CAAE,CAAC,CACfoC,MAAM,CAAE,kCAAkC,CAC1CrC,eAAe,CAAE,2BAA2B,CAC5CH,KAAK,CAAE,OAAO,CACd6D,QAAQ,CAAE,EAAE,CACZK,OAAO,CAAE,MAAM,CACf1H,UAAU,CAAE,mBACd,CAAE,CACF2H,QAAQ,CAAEpK,YAAa,CACvB,gBAAc,MAAM,CACrB,CAAC,EACC,CAAC,cACNhD,KAAA,QAAA8I,QAAA,eACEhJ,IAAA,UAAOmF,KAAK,CAAE,CAAEgE,KAAK,CAAE,OAAO,CAAEkB,OAAO,CAAE,OAAO,CAAEb,YAAY,CAAE,CAAC,CAAEwD,QAAQ,CAAE,EAAG,CAAE,CAAAhE,QAAA,CAAC,8BAEnF,CAAO,CAAC,cACR9I,KAAA,QAAKiF,KAAK,CAAE,CACVwG,MAAM,CAAE,mCAAmC,CAC3CpC,YAAY,CAAE,CAAC,CACfF,OAAO,CAAE,EAAE,CACXD,SAAS,CAAE,QAAQ,CACnB8B,MAAM,CAAEhI,YAAY,CAAG,aAAa,CAAG,SAAS,CAChDyC,UAAU,CAAE,mBAAmB,CAC/BqE,QAAQ,CAAE,UACZ,CAAE,CAAAhB,QAAA,eACAhJ,IAAA,UACE0G,IAAI,CAAC,MAAM,CACX6G,MAAM,CAAC,WAAW,CAClBJ,QAAQ,CAAE/G,gBAAiB,CAC3BjB,KAAK,CAAE,CACL6E,QAAQ,CAAE,UAAU,CACpBgC,GAAG,CAAE,CAAC,CACNC,IAAI,CAAE,CAAC,CACPlB,KAAK,CAAE,MAAM,CACbX,MAAM,CAAE,MAAM,CACdiB,OAAO,CAAE,CAAC,CACVH,MAAM,CAAEhI,YAAY,CAAG,aAAa,CAAG,SACzC,CAAE,CACFoK,QAAQ,CAAEpK,YAAa,CACvB,gBAAc,MAAM,CACrB,CAAC,cACFhD,KAAA,QAAKiF,KAAK,CAAE,CAAEmG,aAAa,CAAE,MAAO,CAAE,CAAAtC,QAAA,eACpChJ,IAAA,MAAG4J,SAAS,CAAC,cAAc,CAACzE,KAAK,CAAE,CAAE6H,QAAQ,CAAE,EAAE,CAAE7D,KAAK,CAAE,SAAS,CAAEK,YAAY,CAAE,EAAG,CAAE,CAAE,CAAC,cAC3FxJ,IAAA,MAAGmF,KAAK,CAAE,CAAEgE,KAAK,CAAE,OAAO,CAAEc,MAAM,CAAE,CAAE,CAAE,CAAAjB,QAAA,CACrCpG,YAAY,wBAAAa,MAAA,CACDb,YAAY,CAAC4D,IAAI,EACzB,mBAAmB,CACtB,CAAC,cACJxG,IAAA,MAAGmF,KAAK,CAAE,CAAEgE,KAAK,CAAE,0BAA0B,CAAE6D,QAAQ,CAAE,EAAE,CAAEJ,SAAS,CAAE,CAAE,CAAE,CAAA5D,QAAA,CAAC,yEAE7E,CAAG,CAAC,EACD,CAAC,EACH,CAAC,EACH,CAAC,CAELjH,OAAO,CAACkC,MAAM,EAAI,CAAC,eAClB/D,KAAA,QAAA8I,QAAA,eACEhJ,IAAA,UAAOmF,KAAK,CAAE,CAAEgE,KAAK,CAAE,OAAO,CAAEkB,OAAO,CAAE,OAAO,CAAEb,YAAY,CAAE,CAAC,CAAEwD,QAAQ,CAAE,EAAG,CAAE,CAAAhE,QAAA,CAAC,kIAEnF,CAAO,CAAC,cACRhJ,IAAA,QAAKmF,KAAK,CAAE,CACVkF,OAAO,CAAE,MAAM,CACfE,GAAG,CAAE,EAAE,CACPC,QAAQ,CAAE,MACZ,CAAE,CAAAxB,QAAA,CACCjH,OAAO,CAAC0I,GAAG,CAAC+C,KAAA,MAAC,CAAE7I,EAAE,CAAE6B,IAAK,CAAC,CAAAgH,KAAA,oBACxBtN,KAAA,WAEEwG,IAAI,CAAC,QAAQ,CACb+G,OAAO,CAAEA,CAAA,GAAM,CAAE,GAAI,CAACvK,YAAY,CAAEG,kBAAkB,CAACsB,EAAE,CAAC,CAAE,CAAE,CAC9D2I,QAAQ,CAAEpK,YAAa,CACvBiC,KAAK,CAAE,CACLuI,IAAI,CAAE,WAAW,CACjBrE,OAAO,CAAE,WAAW,CACpBE,YAAY,CAAE,CAAC,CACfoC,MAAM,CAAEhH,EAAE,GAAKvB,eAAe,CAAG,mBAAmB,CAAG,kCAAkC,CACzFkG,eAAe,CAAE3E,EAAE,GAAKvB,eAAe,CAAG,wBAAwB,CAAG,aAAa,CAClF+F,KAAK,CAAE,OAAO,CACd0D,UAAU,CAAElI,EAAE,GAAKvB,eAAe,CAAG,MAAM,CAAG,QAAQ,CACtD8H,MAAM,CAAEhI,YAAY,CAAG,aAAa,CAAG,SAAS,CAChDyC,UAAU,CAAE,UAAU,CACtBoE,UAAU,CAAE,MACd,CAAE,CACFwB,KAAK,yCAAA9H,MAAA,CAAY+C,IAAI,CAAG,CAAAwC,QAAA,EAEvBxC,IAAI,CAAC,IAAE,CAAC7B,EAAE,CAAC,GACd,GAnBOA,EAmBC,CAAC,EACV,CAAC,CACC,CAAC,cACN3E,IAAA,MAAGmF,KAAK,CAAE,CAAEgE,KAAK,CAAE,0BAA0B,CAAE6D,QAAQ,CAAE,EAAE,CAAEJ,SAAS,CAAE,CAAE,CAAE,CAAA5D,QAAA,CAAC,sLAE7E,CAAG,CAAC,EACD,CACN,CAEAlG,cAAc,CAAG,CAAC,eACjB5C,KAAA,QAAA8I,QAAA,eACE9I,KAAA,QAAKiF,KAAK,CAAE,CAAEgE,KAAK,CAAE,OAAO,CAAEK,YAAY,CAAE,CAAC,CAAEwD,QAAQ,CAAE,EAAG,CAAE,CAAAhE,QAAA,EAAC,4BACvD,CAAClG,cAAc,CAAC,GACxB,EAAK,CAAC,cACN9C,IAAA,QAAKmF,KAAK,CAAE,CACViF,MAAM,CAAE,CAAC,CACTd,eAAe,CAAE,0BAA0B,CAC3CC,YAAY,CAAE,CAAC,CACfW,QAAQ,CAAE,QACZ,CAAE,CAAAlB,QAAA,cACAhJ,IAAA,QACEmF,KAAK,CAAE,CACL4F,KAAK,IAAAtH,MAAA,CAAKX,cAAc,KAAG,CAC3BsH,MAAM,CAAE,MAAM,CACdd,eAAe,CAAE,SAAS,CAC1B3D,UAAU,CAAE,iBAAiB,CAC7B4D,YAAY,CAAE,CAChB,CAAE,CACH,CAAC,CACC,CAAC,EACH,CACN,CAEAvG,aAAa,eACZhD,IAAA,QAAKmF,KAAK,CAAE,CACVkE,OAAO,CAAE,EAAE,CACXE,YAAY,CAAE,CAAC,CACfD,eAAe,CAAEpG,YAAY,CACzB,yBAAyB,CACzBF,aAAa,CAAC+F,QAAQ,CAAC,IAAI,CAAC,CAC1B,yBAAyB,CACzB,yBAAyB,CAC/BI,KAAK,CAAEjG,YAAY,CAAG,SAAS,CAAGF,aAAa,CAAC+F,QAAQ,CAAC,IAAI,CAAC,CAAG,SAAS,CAAG,SAAS,CACtFiE,QAAQ,CAAE,EAAE,CACZW,UAAU,CAAE,GACd,CAAE,CAAA3E,QAAA,CACChG,aAAa,CACX,CACN,cAED9C,KAAA,WACEwG,IAAI,CAAC,QAAQ,CACbvB,KAAK,CAAE,CACLkE,OAAO,CAAE,WAAW,CACpBC,eAAe,CAAE,aAAa,CAC9BH,KAAK,CAAE,OAAO,CACdwC,MAAM,CAAE,MAAM,CACdpC,YAAY,CAAE,CAAC,CACfyD,QAAQ,CAAE,EAAE,CACZH,UAAU,CAAE,MAAM,CAClB3B,MAAM,CAAEhI,YAAY,CAAG,aAAa,CAAG,SAAS,CAChDyC,UAAU,CAAE,UAAU,CACtBwE,SAAS,CAAE,iCAAiC,CAC5CH,QAAQ,CAAE,UAAU,CACpBE,QAAQ,CAAE,QACZ,CAAE,CACFoD,QAAQ,CAAEpK,YAAa,CAAA8F,QAAA,EAEtB9F,YAAY,cACThD,KAAA,QAAKiF,KAAK,CAAE,CAAEkF,OAAO,CAAE,MAAM,CAAEY,UAAU,CAAE,QAAQ,CAAEX,cAAc,CAAE,QAAS,CAAE,CAAAtB,QAAA,eAChFhJ,IAAA,MAAG4J,SAAS,CAAC,uBAAuB,CAACzE,KAAK,CAAE,CAAEwE,WAAW,CAAE,EAAG,CAAE,CAAE,CAAC,8BAErE,EAAK,CAAC,CACJ,UAAU,cACd3J,IAAA,SAAMmF,KAAK,CAAE,CACX6E,QAAQ,CAAE,UAAU,CACpBgC,GAAG,CAAE,KAAK,CACVC,IAAI,CAAE,KAAK,CACXlB,KAAK,CAAE,GAAG,CACVX,MAAM,CAAE,GAAG,CACXd,eAAe,CAAE,0BAA0B,CAC3CC,YAAY,CAAE,KAAK,CACnB4B,SAAS,CAAE,gCAAgC,CAC3CxF,UAAU,CAAE,qBAAqB,CACjC2F,aAAa,CAAE,MACjB,CAAE,CACA1B,SAAS,CAAE1G,YAAY,CAAG,EAAE,CAAG,qBAAsB,CACtD,CAAC,EACI,CAAC,EACL,CAAC,EACJ,CAAC,EACH,CAAC,cACNlD,IAAA,UAAAgJ,QAAA,0ZAcS,CAAC,EACV,CAAC,CAEP","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}