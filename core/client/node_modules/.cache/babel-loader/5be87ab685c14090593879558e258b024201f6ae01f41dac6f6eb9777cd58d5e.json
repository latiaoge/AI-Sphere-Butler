{"ast":null,"code":"import React,{useEffect,useState,useRef}from'react';import cameraSwitchIcon from'../assets/icons/camera-switch.png';import styles from'./CameraControl.module.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function CameraControl(){const videoRef=useRef(null);const[stream,setStream]=useState(null);const[devices,setDevices]=useState([]);const[selectedDeviceId,setSelectedDeviceId]=useState('');useEffect(()=>{async function fetchDevices(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices){alert('浏览器不支持设备枚举');return;}const allDevices=await navigator.mediaDevices.enumerateDevices();const videoDevices=allDevices.filter(d=>d.kind==='videoinput');setDevices(videoDevices);if(videoDevices.length>0)setSelectedDeviceId(videoDevices[0].deviceId);}fetchDevices();},[]);useEffect(()=>{if(!selectedDeviceId)return;async function startCamera(){if(stream){stream.getTracks().forEach(t=>t.stop());}try{const s=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:selectedDeviceId}},audio:false});setStream(s);if(videoRef.current){videoRef.current.srcObject=s;}}catch(e){alert('打开摄像头失败: '+e.message);}}startCamera();return()=>{if(stream){stream.getTracks().forEach(t=>t.stop());}};},[selectedDeviceId]);return/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:20},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Camera Control\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedDeviceId,onChange:e=>setSelectedDeviceId(e.target.value),style:{marginBottom:10,padding:4},children:devices.map(device=>/*#__PURE__*/_jsx(\"option\",{value:device.deviceId,children:device.label||\"Camera \".concat(device.deviceId)},device.deviceId))}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,playsInline:true,muted:true,style:{width:320,height:240,backgroundColor:'#000'}})})]});}","map":{"version":3,"names":["React","useEffect","useState","useRef","cameraSwitchIcon","styles","jsx","_jsx","jsxs","_jsxs","CameraControl","videoRef","stream","setStream","devices","setDevices","selectedDeviceId","setSelectedDeviceId","fetchDevices","navigator","mediaDevices","enumerateDevices","alert","allDevices","videoDevices","filter","d","kind","length","deviceId","startCamera","getTracks","forEach","t","stop","s","getUserMedia","video","exact","audio","current","srcObject","e","message","style","marginBottom","children","value","onChange","target","padding","map","device","label","concat","ref","autoPlay","playsInline","muted","width","height","backgroundColor"],"sources":["D:/XM/AI-Sphere-Butler/core/client/src/components/CameraControl.jsx"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\r\nimport cameraSwitchIcon from '../assets/icons/camera-switch.png';\r\nimport styles from './CameraControl.module.css';\r\n\r\nexport default function CameraControl() {\r\n  const videoRef = useRef(null);\r\n  const [stream, setStream] = useState(null);\r\n  const [devices, setDevices] = useState([]);\r\n  const [selectedDeviceId, setSelectedDeviceId] = useState('');\r\n\r\n  useEffect(() => {\r\n    async function fetchDevices() {\r\n      if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {\r\n        alert('浏览器不支持设备枚举');\r\n        return;\r\n      }\r\n      const allDevices = await navigator.mediaDevices.enumerateDevices();\r\n      const videoDevices = allDevices.filter((d) => d.kind === 'videoinput');\r\n      setDevices(videoDevices);\r\n      if (videoDevices.length > 0) setSelectedDeviceId(videoDevices[0].deviceId);\r\n    }\r\n    fetchDevices();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!selectedDeviceId) return;\r\n\r\n    async function startCamera() {\r\n      if (stream) {\r\n        stream.getTracks().forEach((t) => t.stop());\r\n      }\r\n      try {\r\n        const s = await navigator.mediaDevices.getUserMedia({\r\n          video: { deviceId: { exact: selectedDeviceId } },\r\n          audio: false,\r\n        });\r\n        setStream(s);\r\n        if (videoRef.current) {\r\n          videoRef.current.srcObject = s;\r\n        }\r\n      } catch (e) {\r\n        alert('打开摄像头失败: ' + e.message);\r\n      }\r\n    }\r\n    startCamera();\r\n\r\n    return () => {\r\n      if (stream) {\r\n        stream.getTracks().forEach((t) => t.stop());\r\n      }\r\n    };\r\n  }, [selectedDeviceId]);\r\n\r\n  return (\r\n    <div style={{ marginBottom: 20 }}>\r\n      <h3>Camera Control</h3>\r\n      <select\r\n        value={selectedDeviceId}\r\n        onChange={(e) => setSelectedDeviceId(e.target.value)}\r\n        style={{ marginBottom: 10, padding: 4 }}\r\n      >\r\n        {devices.map((device) => (\r\n          <option key={device.deviceId} value={device.deviceId}>\r\n            {device.label || `Camera ${device.deviceId}`}\r\n          </option>\r\n        ))}\r\n      </select>\r\n      <div>\r\n        <video\r\n          ref={videoRef}\r\n          autoPlay\r\n          playsInline\r\n          muted\r\n          style={{ width: 320, height: 240, backgroundColor: '#000' }}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}